!function(){function C(){return window.sa.context}function S(t){return t*Math.PI/180}function E(t){let{x:i=0,y:e=0,width:h,height:s}=t;return i-=.5*h,e-=.5*s,h<0&&(i+=h,h*=-1),s<0&&(e+=s,s*=-1),{x:i,y:e,width:h,height:s}}function h(t=()=>{},i){t.Aa&&i.preventDefault(),t(i)}function i(t){var i=d[t.code],e=r[i];n[i]=!0,h(e,t)}function e(t){var i=d[t.code],e=o[i];n[i]=!1,h(e,t)}function M(t){return[].concat(t).some(t=>n[t])}function R(t,i,{Ha:e="keydown",preventDefault:h=!0}={}){let s="keydown"==e?r:o;i.Aa=h,[].concat(t).map(t=>s[t]=i)}function l(t,{Ha:i="keydown"}={}){let e="keydown"==i?r:o;[].concat(t).map(t=>delete e[t])}function a(t,i){return new URL(t,i).href}function t(s){return window.xa||(window.xa={Qa:a,Oa:P}),new Promise((t,i)=>{let e,h;if(P[s])return t(P[s]);(e=new Image).onload=()=>{h=a(s,window.location.href),P[h]=P[s]=e,t(e)},e.onerror=()=>{i()},e.src=s})}function O({name:t="",x:i=-100,y:e=-100,dx:h=0,dy:s=0,T:a=0,H:r=0,width:o=10,height:n=10,L:l=1,M:c=1,rotation:d=0,anchor:g={x:.5,y:.5},g:f=1/0,color:m="white",Y:p,update:u,A:v,j:y,image:x}={}){var w={Y(t={}){Object.assign(this,t),this.ua&&this.ua()},advance(){this.x+=this.dx,this.y+=this.dy,this.dx+=this.T,this.dy+=this.H},C(){this.advance(),this.frame++,this.g--},update(){this.X?this.X():this.C()},Ba(){var t=this.context;t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),this.L&&this.M&&t.scale(this.L,this.M),t.translate(-this.width*g.x,-this.width*g.y),this.j()},A(){var t=this.context;t.save(),this.W?(t.translate(this.x,this.y),this.W()):(this.Ba(),t.restore())},za(){var t=this.context;if(this.ca)return this.ca();t.fillStyle=this.color||"white",t.fillRect(0,0,this.width,this.height)},j(){this.ca?this.ca():this.za()},Z(){return 0<this.g},...arguments[0]};return w.Y({name:t,x:i,y:e,dx:h,dy:s,T:a,H:r,width:o,height:n,L:l,M:c,rotation:d,anchor:g,g:f,color:m,frame:0,context:C(),ua:p,X:u,W:v,ca:y,image:x}),w}function I(t,i){g[t]=g[t]||[],g[t].push(i)}function A(t,...i){(g[t]||[]).map(t=>t(...i))}function T(t={}){const e="pink orange white purple red cyan green yellow pink orange".split(" ");return O({name:"enemy",x:-80,y:-80,image:P["spritesheet.png"],na:P["spritesheet16.png"],m:4,s:0,u:0,frame:0,L:.1,M:.1,h:2,pa:2,l:!0,I:!1,parent:t.parent,da:t.da||0,v:!1,ka:30,la:40,D:0,...t,U(t){this.h-=t,this.u=1,this.h<=0&&!this.I&&this.o(),k(2.3,void 0,330,void 0,.06,.17,2,3.7,void 0,void 0,void 0,void 0,.05,.4,2,.5,.13,.89,.05,.17)},o(){this.B&&this.B.$++,this.parent&&this.parent.Da++,this.I=this.l=!0,this.g=10},update(){var t=this.path.getPointAtLength(this.frame),i=this.path.getPointAtLength(this.frame+1);this.x=Math.floor(t.x),this.y=Math.floor(t.y),this.parent&&(this.x=this.parent.x+Math.cos(this.frame/this.parent.la+this.da)*this.parent.ka,this.y=this.parent.y+Math.sin(this.frame/this.parent.la+this.da)*this.parent.ka),4<this.u&&(this.u=0),this.rotate&&(this.rotation=S(90)+Math.atan2(i.y-t.y,i.x-t.x)),this.rotate||(this.rotation=S(180)),this.frame>=this.path.getTotalLength()&&(this.frame=0,!this.loop)&&(this.B&&this.B.$++,this.g=0),t=Math.min(Math.max(0,this.frame/50),1),this.frame<50&&(t=this.frame/50),this.frame>this.path.getTotalLength()-50&&(t=(this.path.getTotalLength()-this.frame)/50),50==this.frame&&(this.l=!1),this.L=this.M=t,2!==this.D&&.995<Math.random()&&A("enemy-fire",this,this.D),2!==this.D||20!=this.s&&40!=this.s&&60!=this.s||A("enemy-fire",this,this.D),300<this.s&&(this.s=0),0<this.u&&this.u++,50<this.frame&&this.s++,this.v&&10<this.s&&this.s<70?this.l=!1:this.v&&(this.l=!0),2===this.D&&(this.s<10||70<this.s)&&this.C(),2!==this.D&&this.C(),this.g<=0&&this.I&&A("explosion",this.x,this.y,this.v?60:20,this.v?10:5,e[this.m])},j(){var t,i=this.context;1<this.frame&&!this.v&&i.drawImage(this.image,8*this.m,0,8,8,0,0,8,8),1<this.frame&&this.v&&i.drawImage(this.na,16*this.m,0,16,16,0,0,16,16),1<this.frame&&this.v&&(t=20*this.h/this.pa,i.save(),i.translate(this.width/2,this.height/2),i.rotate(-this.rotation),i.fillStyle="white",i.fillRect(-12,-16,24,6),i.fillStyle="black",i.fillRect(-11,-15,22,4),i.fillStyle="green",this.h<this.pa/4&&(i.fillStyle="red"),i.fillRect(-10,-14,t,2),i.restore()),this.u&&(i.globalCompositeOperation="source-atop",i.fillStyle="white",i.fillRect(0,0,this.v?16:8,this.v?16:8),i.globalCompositeOperation="source-over")}})}function w(t){var[t,i,e,h]=t;return{frame:t,Na:i,pause:e,G:h}}function b(t){var[t,i,e,h,s]=t;return{frame:t,x:i,speed:e,type:h,value:s}}function H(t,y){const x=[];return t.forEach(t=>{var i,e,[h,s,a,r,o,n,l,c,d,g="",f=[],m=[],p=[],u=[],v=[]]=t,n=(t=x.push,0<p.length?n:n+Math.floor(y/4));(i=20!==a)&&(i=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","path"),i.appendChild(e),e.setAttribute("d",g),e.setAttribute("fill","none"),e.setAttribute("stroke","black"),e.setAttribute("stroke-width","2"),e.setAttribute("id","path"),i=e),t.call(x,{frame:h,Pa:s,m:a,rotate:r,h:o,total:n,interval:l,loop:c,D:d,path:i,Ea:f.map(w),Ia:m.map(b),count:0,ea:!1,$:0,children:p,Ma:u,Fa:v})}),{wa:x}}function L({create:t,F:i=10}){return{i:[t({x:-100,y:-100})],F:i,size:0,ya:t,get(t={}){if(this.size==this.i.length){if(this.size==this.F)return;for(var i=0;i<this.size&&this.i.length<this.F;i++)this.i.push(this.ya())}return i=this.i[this.size],this.size++,i.Y(t),i},update(){let i,e=!1;for(let t=this.size;t--;)(i=this.i[t]).update(),i.Z()||(e=!0,this.size--);e&&this.i.sort((t,i)=>i.Z()-t.Z())},A(){for(let t=this.size;t--;)this.i[t].A()},K(){return this.i.slice(0,this.size)}}}function N({i:t=[],update:i,A:e}){var h={...arguments[0],Y(t={}){Object.assign(this,t)},update(){this.X?this.X():this.i.forEach(t=>t.update())},A(){this.W&&this.W(),this.i.forEach(t=>t.A())}};return h.Y({i:t,context:C(),X:i,W:e}),h}function G({x:t=0,y:i=0,text:e="",color:a="white",align:r="left",lineHeight:o=8,scale:h=1}){const n=C(),s=8*e.split("\n").reduce((t,i)=>t.length>i.length?t:i).length;return O({x:t,y:i,width:s,height:8,anchor:{x:0,y:0},text:e,L:h,M:h,j(){const s=P["font.png"],t=this.text.split("\n");n.save(),t.forEach(e=>{n.save(),"center"===r&&n.translate(8*-e.length/2,0),"right"===r&&n.translate(8*-e.length,0);for(let i=0;i<e.length;i++){var h=e.charCodeAt(i);let t=64===h?41:58===h?40:33===h?39:63===h?38:44===h?37:46===h?36:32===h?-1:48<=h&&h<=57?h-22:65<=h&&h<=90?h-65:0;-1!==t&&(h=8*i,n.drawImage(s,8*t,0,8,8,h,0,8,8),n.globalCompositeOperation="source-atop",n.fillStyle=a||"white",n.fillRect(h,0,8,8),n.globalCompositeOperation="source-over")}n.restore(),n.translate(0,o)}),n.restore()}})}function s(t,i){var e=[],h=i.x+i.width/2,s=i.y+i.height/2;return i=t.y<s,s=t.y+t.height>=s,t.x<h&&(i&&e.push(0),s)&&e.push(2),t.x+t.width>=h&&(i&&e.push(1),s)&&e.push(3),e}function B(){function i(t){const i=2*Math.random()+.1,e=96*i;s.get({id:"star",x:Math.random()*h.canvas.width,y:t,dx:0,dy:i,width:1,height:1,g:240/i,update(){this.advance(),this.y>h.canvas.height&&(this.g=0)},j(){var t=this.context;t.fillStyle=`rgb(${e}, ${e}, ${e})`,t.fillRect(0,0,this.width,this.height)}})}const h=C(),s=L({create:O,F:300});for(let t=0;t<h.canvas.height;t+=2)i(t);return{update(){i(-1),s.update()},A(){s.A()}}}function j(){return O({name:"dialog",x:8,y:248,image:P["spritesheet.png"],va:[10,11,12,13,14],text:G({text:"",x:16,y:8,align:"left"}),P:0,G:[],V:0,ia:0,frame:0,anchor:{x:0,y:0},ra:!1,oa:!1,qa:!1,Ka(){this.P=this.G[this.V].length},start(t){R(["space"],()=>this.Ka()),this.qa=!1,setTimeout(()=>{this.oa=!0,this.G=["",...t.G],this.frame=0},2e3),this.dy=-2},stop(){l(["space"]),this.qa=!0,this.text.text="        ",this.oa=!1,setTimeout(()=>{this.G=[],this.frame=this.P=this.V=0},1e3),this.dy=2},update(){var t;this.y<200&&(this.dy=0,this.y=200),248<this.y&&(this.dy=0,this.y=248),0!=this.G.length&&(this.ra=!1," "!==(t=this.G[this.V]+"      ")[this.P]&&(this.ra=!0),0==this.frame%5&&(this.P++," "!==t[this.P])&&k(1.5,void 0,261,.01,.02,.08,1,1.5,-.5,void 0,void 0,-.5,void 0,void 0,void 0,void 0,.9,.05),this.V<this.G.length&&(this.text.text=t.slice(0,this.P)),this.frame++,this.P>=t.length&&(this.V++,this.P=this.frame=0),this.V>=this.G.length&&!this.qa&&this.stop(),this.ra&&0==this.frame%5&&this.ia++,this.ia>=this.va.length&&(this.ia=0),this.C())},j(){var t=this.context,i=this.image;t.fillStyle="white",t.fillRect(-2,-2,12,12),t.drawImage(i,8*this.va[this.ia],0,8,8,0,0,8,8),t.translate(16,0),this.text.j()}})}function V(){return O({x:0,y:0,dx:0,dy:0,width:2,height:2,g:400,frame:0,o(){this.g=0,this.y=this.x=-100},update(){this.C(),(240<this.y||this.y<0||256<this.x||this.x<0)&&(this.g=0)},j(){var t=this.context;t.fillStyle="red",t.fillRect(0,0,this.width,this.width)}})}function $(){return O({name:"asteroid",x:0,y:-16,image:P["spritesheet.png"],na:P["spritesheet16.png"],m:2,frame:0,L:1,M:1,width:16,height:16,angle:0,speed:1,rotation:0,rotate:!1,g:0,ma:!1,h:20,U(){this.ma=!0,this.h--,setTimeout(()=>{this.ma=!1},200)},o(){A("explosion",this.x,this.y,20,10,"white"),this.g=0,this.B&&this.B.$++},update(){this.rotation+=.1,this.h<=0&&this.o(),this.C(),(260<this.y||this.x<-16||266<this.x)&&(this.g=0,this.B)&&this.B.$++},j(){var t=this.context;t.drawImage(this.na,32,0,16,16,0,0,16,16),this.ma&&(t.globalCompositeOperation="source-atop",t.fillStyle="white",t.fillRect(0,0,16,16),t.globalCompositeOperation="source-over")}})}function m(){function i(t,o,n=!0){t.wa.forEach(t=>{var e,i,h=o-t.frame,s=t.frame+t.total*t.interval;o>=t.frame&&o<s&&t.count<t.total&&0==h%t.interval&&(h=1<l/c?Math.floor(l/c*t.h*.2):0,20===t.m?m.get({x:t.Ma[t.count],y:-8,dx:t.Fa[t.count],dy:1,m:2,g:1/0,h:t.h+h,B:t}):(h=f.get({x:-100,y:-100,path:t.path,rotate:t.rotate,loop:t.loop,g:1/0,l:!0,I:!1,h:t.h+h,pa:t.h+h,frame:0,m:t.m,parent:null,v:!1,D:t.D,s:0,B:t}),s=t.children||[],e=h,0!==s.length&&(e.Da=0,e.ka=30,e.la=100,e.v=!0,e.width=16,e.height=16,s.forEach(i=>{for(let t=0;t<i[3];t++)f.get({m:i[0],rotate:i[1],g:1/0,l:!0,I:!1,h:i[2]+Math.floor(l/4),frame:0,v:!1,parent:e,loop:e.loop,path:e.path,da:S(360/i[3]*t),D:i[4],B:e.B})}))),t.ea=!1,t.count+=1);{h=t.Ia;var a=o;const r=[["powerup-fire","green",5],["powerup-shield","yellow",18]];h.forEach(t=>{if(void 0!==t.frame&&a===t.frame){const i=r[t.type];p.get({name:i[0],x:t.x,y:-8,width:8,height:8,color:i[1],dy:t.speed,image:P["font.png"],value:t.value,g:1/0,o(){d.O+=this.value,0===t.type&&k(1.6,void 0,291,.01,.21,.35,void 0,2.2,void 0,void 0,-136,.09,.03,void 0,void 0,.2,.2,.7,.28),1===t.type&&k(.5,void 0,375,.03,.07,.08,1,2.7,void 0,void 0,302,.05,.05,void 0,void 0,void 0,void 0,.93,.01,void 0,607),this.g=0},update(){this.C(),240<this.y&&(this.g=0)},j(){var t=this.context;this.frame%20<10&&(t.fillStyle=this.color,t.fillRect(-3,-3,this.width+6,this.height+6),t.fillStyle="black",t.fillRect(-2,-2,this.width+4,this.height+4)),t.fillStyle=this.color,t.fillRect(-1,-1,this.width+2,this.height+2),t.drawImage(this.image,8*i[2],0,8,8,0,0,8,8)}})}})}n&&(s=t.Ea,i=o,s.forEach(t=>{void 0!==i&&i===t.frame&&g.start(t)})),t.ea||t.count!==t.total||t.$!==t.total||(t.ea=!0)})}function e(h,t){h.Z()&&!h.l&&t.forEach(t=>{var i,e;(i=(i="enemy"!==h.name||"enemy"!==t.name)&&(t.Z()&&!h.l&&!t.l))&&(i=E(t),e=E(h),i=i.x<e.x+e.width&&i.x+i.width>e.x&&i.y<e.y+e.height&&i.y+i.height>e.y),i&&(t.name.includes("powerup-")||t.v||"ship-bullet"===h.name||t.o(),"ship"==h.name&&"enemy"==t.name?h.U(50):"ship"==h.name&&"asteroid"==t.name?(h.o(),t.o()):"ship"==h.name&&"powerup-fire"==t.name?(h.Ga(t.value),t.o()):"ship"==h.name&&"powerup-shield"==t.name?(h.Ja(t.value),t.o()):"ship"==h.name?h.U(10):"ship-bullet"==h.name&&"asteroid"==t.name&&(h.g=0,t.U(1)),"enemy"==h.name)&&(h.U(1),d.O+=10)})}R(["esc"],()=>{A("change-scene","menu")});let l=1,c=1;const d=function(){const t=C();return O({name:"ship",x:t.canvas.width/2,y:t.canvas.height+16,image:P["spritesheet.png"],m:1,s:0,J:0,u:0,l:!0,I:!1,ha:!0,h:100,aa:3,O:0,U(t){this.l||(this.h-=t,this.u=1,this.h<=0&&this.o(),k(2.3,void 0,330,void 0,.06,.17,2,3.7,void 0,void 0,void 0,void 0,.05,.4,2,.5,.13,.89,.05,.17))},o(){this.I||(this.I=this.l=!0,this.aa--,this.g=5,this.aa<=0&&A("game-over"))},La(){this.x=t.canvas.width/2,this.y=t.canvas.height+32,this.M=this.L=2,this.h=100,this.J=0,this.l=!0,this.I=!1,this.ha=!0,this.g=1/0,this.dy=this.H=this.frame=0},Ga(){this.J++,3<this.J&&(this.J=3)},Ja(){this.h=100},update(){this.H=this.T=0,this.dx*=.96,this.dy*=.96,this.m=1,M(["d","arrowright"])&&this.dx<5&&(this.T=.2,this.m=2),M(["a","arrowleft"])&&-5<this.dx&&(this.T=-.2,this.m=0),M("space")&&0==this.s%(15/(1<this.J?2:1))&&(0==this.J?A("ship-fire",this.x-1):1==this.J?(A("ship-fire",this.x-2,1),A("ship-fire",this.x+2,1)):2==this.J?(A("ship-fire",this.x-3,1),setTimeout(()=>A("ship-fire",this.x-1,2),200),A("ship-fire",this.x+3,1)):3==this.J&&(A("ship-fire",this.x-2,1),setTimeout(()=>A("ship-fire",this.x+2,1),300),setTimeout(()=>A("ship-fire",this.x-4,2),200),setTimeout(()=>A("ship-fire",this.x+4,2),100))),this.ha||(M(["s","arrowdown"])&&this.dy<5&&(this.H=.2),M(["w","arrowup"])&&-5<this.dy&&(this.H=-.2)),this.frame<100&&(this.H=-.03,this.L=this.M=2-this.frame/100),this.aa<=0&&(this.T=0,this.H=0,this.dx=0,this.dy=0),4<this.u&&(this.u=0),this.C(),this.x>t.canvas.width&&(this.x=t.canvas.width),this.x<0&&(this.x=0),0<this.aa&&!this.ha&&this.y>t.canvas.height&&(this.y=t.canvas.height),this.y<0&&(this.y=0),this.h<=0&&this.o(),this.g<=0&&(A("explosion",this.x,this.y,30,6,"white"),this.La()),100==this.frame&&(this.l=!1,this.ha=!1),this.s++,0<this.u&&this.u++},j(){var t=this.context;t.drawImage(this.image,8*this.m,0,8,8,0,0,8,8),this.frame<100&&this.l&&this.frame%20<10&&(t.globalCompositeOperation="source-atop",t.fillStyle="white",t.fillRect(0,0,8,8),t.globalCompositeOperation="source-over"),this.u&&(t.globalCompositeOperation="source-atop",t.fillStyle="white",t.fillRect(0,0,8,8),t.globalCompositeOperation="source-over");let i=1;this.H<0&&(i=this.frame%10<5?2:3),t.fillStyle="#FFaa33",t.fillRect(3,7,2,i),t.fillStyle="#FF6633",t.fillRect(this.frame%10<5?3:4,7+i,1,i)}})}(),t=B(),g=j(),h=L({create:O,F:100}),r=L({create:V,F:100}),f=L({create:T,F:100}),m=L({create:$,F:10}),o=L({create:O,F:300}),p=L({create:O,F:10}),s=G({x:8,y:8,text:"SCORE 0"}),a=G({x:224,y:8,text:"@@@",color:"red"}),n=G({x:8,y:224,text:"",color:"yellow"}),u=G({x:128,y:120,text:"LEVEL "+l,color:"lightgreen",align:"center"}),v=O({x:192,y:8,width:24,height:8,anchor:{x:0,y:0},j(){var t=this.context,i=0<=d.h?d.h/5:0;t.strokeStyle="white",t.strokeRect(0,0,this.width,this.height),t.fillStyle="green",d.h<25&&(t.fillStyle="red"),t.fillRect(2,2,i,this.height-4)}}),y=(I("ship-fire",(t,i=0)=>{h.get({name:"ship-bullet",x:t,y:d.y-4,dx:(1-2*Math.random())/(4-i),dy:-5,width:2,height:3,g:80,o(){this.g=0,this.y=this.x=-100},j(){var t=this.context;t.fillStyle="white",t.fillRect(0,0,this.width,1),t.fillStyle="yellow",t.fillRect(0,1,this.width,1),t.fillStyle="red",t.fillRect(0,2,this.width,1)}}),k(.9,void 0,413,void 0,.05,.01,1,3.8,-3,-13.4,void 0,void 0,void 0,void 0,void 0,void 0,.11,.65,.07,void 0,237)}),I("enemy-fire",({x:t,y:i},e=0)=>{var h=d.x-4-t,s=d.y-i,a=+Math.hypot(h,s);if(2===e)for(e=0;e<12;e++)h=+Math.cos(S(30*e)),s=+Math.sin(S(30*e)),r.get({name:"enemy-bullet",x:t,y:i,dx:h,dy:s,frame:0,g:400});else r.get({name:"enemy-bullet",x:t+4,y:i+4,dx:0==e?0:h/a,dy:0==e?1.5:s/a,frame:0,g:400});k(.3,void 0,222,.02,.04,.09,3,.3,11,10,void 0,void 0,void 0,void 0,15,void 0,void 0,.53,.17)}),I("explosion",(h,s,i=50,a=3,r="white")=>{for(let t=0;t<i;t++){let t=360*Math.random(),i=a,e=Math.random()*i+i;o.get({name:"particle",x:h,y:s,dx:Math.cos(S(t))*e/10,dy:Math.sin(S(t))*e/10,width:1,height:1,g:30*i,color:r,update(){var t=256/30*i*(this.g/30);"white"==r&&(this.color=`rgb(${t},${t},${t})`),"red"==r&&(this.color=`rgb(${t},0,0)`),this.C()},j(){var t=this.context;t.fillStyle=this.color,t.fillRect(0,0,this.width,this.height)}}),o.get({name:"particle",x:h,y:s,dx:Math.cos(S(t))*e/20,dy:Math.sin(S(t))*e/20,width:2,height:2,g:10*i/2,update(){var t=256/(i/2)*(this.g/10);this.color=`rgb(${t},${t},${t})`,this.C()},j(){var t=this.context;t.fillStyle=this.color,t.beginPath(),t.arc(0,0,2,0,2*Math.PI),t.fill()}})}k(void 0,void 0,45,.03,.21,.6,4,.9,2,-3,void 0,void 0,void 0,.2,void 0,.9,void 0,.45,.26)}),I("game-over",()=>{setTimeout(()=>A("change-scene","game-over",{O:d.O}),2e3)}),new F),x=new F,w=new F;return N({i:[t,d,p,h,r,m,f,o,s,a,v,g],level:H(D[c-1],1),frame:0,update(){var t;g.oa?g.update():(i(this.level,this.frame,l==c),u.update(),y.clear(),y.add(d,m.K(),f.K(),r.K(),p.K()),e(d,y.get(d)),x.clear(),f.K().forEach(t=>{x.add(t,h.K()),e(t,x.get(t))}),w.clear(),h.K().forEach(t=>{w.add(t,m.K()),e(t,w.get(t))}),0===(t=this.level.wa.filter(t=>!t.ea).length)&&0===f.K().length&&(l++,++c>K&&(c=1),this.level=H(D[c-1],l),this.frame=0,u.text="LEVEL "+l,k(void 0,void 0,264,.07,.29,.06,1,3.7,void 0,-30,-148,.07,.08,void 0,void 0,void 0,void 0,.76,.22,void 0,-1240)),s.text="SCORE "+d.O,a.text="@@@".slice(0,d.aa),n.text=(this.frame+"").padStart(8,"0")+" "+(t+"").padStart(2,"0"),this.frame++,this.i.forEach(t=>t.update()))},A(){this.frame<100&&u.A()}})}function c(){R(["enter"],()=>{A("change-scene","game")});var t=localStorage.getItem("hiscore")||0;return N({i:[B(),G({text:"MICRO SHOOTER",x:128,y:48,align:"center",scale:2,color:"red"}),G({text:"JS13K 2024 EDITION",x:128,y:96,align:"center"}),G({text:"HIGH SCORE "+t,x:128,y:120,align:"center",color:"yellow"}),G({text:"PRESS ENTER TO START",x:128,y:144,align:"center",color:"lightgreen"}),G({text:"ARROWS TO MOVE\nSPACE TO SHOOT",x:128,y:192,align:"center"})]})}function p(){var t=C();t.filter="url(#remove-alpha)"===t.filter?"none":"url(#remove-alpha)"}let r={},o={},n={},d={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"},P={},g={},J=new AudioContext,k=(t=1,i=.05,e=220,h=0,s=0,a=.1,r=0,o=1,n=0,l=0,c=0,d=0,g=0,j=0,f=0,P=0,m=0,p=1,u=0,v=0,y=0)=>{let x=Math,w=2*x.PI,k=n*=500*w/44100/44100,C=e*=(1-i+2*i*x.random(i=[]))*w/44100,S=0,D=0,E=0,M=1,F=0,V=0,R=0,O=y<0?-1:1;var I=w*O*y*2/44100,A=x.cos(I),T=x.sin,$=-2*A/(I=1+(b=T(I)/4)),b=(1-b)/I,H=(1+O*A)/2/I,A=-(O+A)/I;let L=0,N=0,G=0,B=0;for(l*=500*w/44100**3,f*=w/44100,c*=w/44100,d*=44100,g=44100*g|0,t*=.3,O=(h=44100*h+9)+(u*=44100)+(s*=44100)+(a*=44100)+(m*=44100)|0;E<O;i[E++]=R*t)++V%(100*P|0)||(R=r?1<r?2<r?3<r?T(S**3):x.max(x.min(x.tan(S),1),-1):1-(2*S/w%2+2)%2:1-4*x.abs(x.round(S/w)-S/w):T(S),R=(g?1-v+v*T(w*E/g):1)*(R<0?-1:1)*x.abs(R)**o*(E<h?E/h:E<h+u?1-(E-h)/u*(1-p):E<h+u+s?p:E<O-m?(O-E-m)/a*p:0),R=m?R/2+(m>E?0:(E<O-m?1:(O-E)/m)*i[E-m|0]/2/t):R,y&&(R=B=H*L+A*(L=N)+H*(N=R)-b*G-$*(G=B))),I=(e+=n+=l)*x.cos(f*D++),S+=I+I*j*T(E**5),M&&++M>d&&(e+=c,C+=c,M=0),!g||++F%g||(e=C,n=k,M=M||1);(t=J.createBuffer(1,O,44100)).getChannelData(0).set(i),(e=J.createBufferSource()).buffer=t,e.connect(J.destination),e.start()};const D=[[[100,!1,20,!1,10,10,130,!1,0,"",[],[],[],[40,200,120,180,60,220,180,40,120,60],[1,-1,0,-1,1,-1,0,1,0,1]],[1300,!1,4,!1,1,2,330,!1,0,"M1 1s162 189 172 199c11 10 30 35 59 24 29-12 9-54 0-65L120 37S99 11 71 15c-27 3-46 47-46 47S4 106 4 126s-3 67 11 77c15 10 55 41 79 9L247 1",[],[[410,120,1,0,10],[730,200,1,1,10]]],[1500,!0,5,!0,2,3,60,!1,0,"M223-33v238c0 42-61 41-61 0V41c0-44-64-44-64 0v164c0 43-71 33-71 0V-27",[],[]]],[[100,!0,5,!0,2,3,60,!1,0,"M287 12.5L-21 60.5L272 106.5L-21 137.5L272 185.5L-18.5 237.5",[],[]],[400,!1,0,!1,10,1,50,!0,2,"M131 57s-56 130 0 129c57 0 99-32 69-67s-33-85-69-75-71 38-71 75c1 37 25 52 64 51 39 0 61-22 60-51-1-30-21-46-47-47-25-1-56 17-56 47 0 29 12 32 43 29s39-11 39-29-6-25-26-25-32 4-36 25c-3 20 9 18 23 11 13-7 17-11 17-11",[[99,0,!0,["SOMETHING BIG IS COMING"]]],[[200,120,.5,0,10],[400,200,.5,1,10],[1600,200,.5,0,10],[2900,120,.5,0,10]],[[8,!1,1,16,0]]],[1e3,!1,0,!1,5,1,50,!0,2,"M244 12H22c-14 0-11 9 0 9h214c17 0 17 10 0 10H22C4 31 8 43 22 43h214c20 0 19 15 0 15H22C6 58 6 71 22 71h244",[],[],[[5,!1,1,4,1]]]],[[100,!1,4,!1,1,2,330,!1,0,"M1 1s162 189 172 199c11 10 30 35 59 24 29-12 9-54 0-65L120 37S99 11 71 15c-27 3-46 47-46 47S4 106 4 126s-3 67 11 77c15 10 55 41 79 9L247 1",[],[[410,120,1,0,10],[730,200,1,1,10]]],[400,!0,5,!0,2,3,60,!1,0,"M113.696 117.212C128.254 117.212 156.71 108.752 154.725 91.832C152.74 74.9117 136.196 52.5529 113.696 52.5529C91.1957 52.5529 64.7252 64.0345 54.7988 79.7461C44.8723 95.4577 38.9165 134.737 54.7988 152.261C70.6811 169.786 80.6075 172.807 105.755 172.203C130.902 171.599 155.387 160.117 170.607 149.24C185.828 138.363 203.034 112.378 202.372 91.832C201.71 71.286 207.004 45.9058 189.798 28.3813C172.593 10.8567 149.431 -0.625112 98.4751 1.18777C47.5194 3.00065 40.9017 23.5468 30.3135 38.0498C19.7253 52.5529 2.51948 78.5374 1.19596 112.378C-0.127568 146.219 5.16655 173.412 19.7253 189.728C34.2841 206.044 72.0046 225.381 98.4751 225.985C124.946 226.59 177.887 208.461 194.431 194.562C210.975 180.663 232.813 157.7 238.107 128.09C243.401 98.4791 244.725 70.6818 232.813 52.5529C220.901 34.424 207.666 18.7631 165.313 10.9072C122.96 3.05134 87.8869 18.1082 70.6811 31.4026C53.4752 44.697 19.7253 83.3718 19.7253 112.378C19.7253 141.384 25.6812 165.556 54.7988 186.102C83.9163 206.648 148.107 193.353 167.96 180.663C187.813 167.973 214.284 149.24 218.916 117.212C223.548 85.1847 199.725 59.2001 173.916 46.5099C148.107 33.8198 105.755 33.2155 83.9163 46.5099C62.0781 59.8043 40.24 93.0406 56.7841 128.09C73.3281 163.139 99.1369 163.139 115.681 156.492C132.225 149.844 167.96 141.384 173.916 112.378C179.872 83.3718 177.887 66.4517 142.151 59.2001C106.416 51.9485 79.284 62.2217 79.284 93.6449C79.284 125.068 98.4751 117.212 98.4751 117.212",[],[]],[600,!0,6,!0,4,3,200,!1,0,"M241 228V23c0-29-40-29-40 0v186c0 36-30 25-37 0S140 7 116 7 82 168 77 206c-5 37-38 29-38 0V33C39-11 1-7 1 33v195",[],[]],[800,!0,7,!1,4,3,20,!1,0,"M235 1H13c-14 0-11 9 0 9h214c17 0 17 10 0 10H13c-18 0-14 12 0 12h214c20 0 19 15 0 15H13c-16 0-16 13 0 13h244",[],[]]],[[200,!1,0,!1,20,1,50,!0,2,"M131 57s-56 130 0 129c57 0 99-32 69-67s-33-85-69-75-71 38-71 75c1 37 25 52 64 51 39 0 61-22 60-51-1-30-21-46-47-47-25-1-56 17-56 47 0 29 12 32 43 29s39-11 39-29-6-25-26-25-32 4-36 25c-3 20 9 18 23 11 13-7 17-11 17-11",[[50,0,!0,["REMEMBER","THE BIG SHIP CAN ONLY BE HIT","WHEN SHOOTING"]]],[[200,120,.5,0,10],[400,200,.5,1,10],[1600,200,.5,0,10],[2900,120,.5,0,10]],[[8,!0,2,8,1]]]]],K=D.length;class F{constructor({fa:t=3,ga:i=25,N:e}={}){this.fa=t,this.ga=i,t=C().canvas,this.N=e||{x:0,y:0,width:t.width,height:t.height},this.ba=!1,this.ja=0,this.S=[],this.R=[]}clear(){this.R.map(t=>{t.clear()}),this.ba=!1,this.S.length=0}get(i){let e=new Set;return this.R.length&&this.ba?(s(i,this.N).map(t=>{this.R[t].get(i).map(t=>e.add(t))}),Array.from(e)):this.S.filter(t=>t!==i)}add(...t){t.flat().map(t=>{this.ba?this.ta(t):(this.S.push(t),this.S.length>this.ga&&this.ja<this.fa&&(this.Ca(),this.S.map(t=>this.ta(t)),this.S.length=0))})}ta(i){s(i,this.N).map(t=>{this.R[t].add(i)})}Ca(){if(this.ba=!0,!this.R.length)for(var t=this.N.width/2|0,i=this.N.height/2|0,e=0;e<4;e++)this.R[e]=new F({N:{x:this.N.x+(1==e%2?t:0),y:this.N.y+(2<=e?i:0),width:t,height:i},fa:this.fa,ga:this.ga}),this.R[e].ja=this.ja+1}}f=document.getElementById("c").getContext("2d"),window.sa=window.sa||{};var f=window.sa.context=f;f.imageSmoothingEnabled=!1,f.setTransform(1,0,0,1,0,0),f.filter="url(#remove-alpha)";{let t;for(t=0;t<26;t++)d["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)d["Digit"+t]=d["Numpad"+t]=""+t;window.addEventListener("keydown",i),window.addEventListener("keyup",e)}(async()=>{await t("font.png"),await t("spritesheet.png"),await t("spritesheet16.png"),R("e",p),I("change-scene",(t,i)=>{var e,h,s,a,r,o;l(["enter","esc"]),e=["change-scene"],g=Object.keys(g).reduce((t,i)=>(e.includes(i)&&(t[i]=g[i]),t),{}),"game"===t&&(n=m()),"menu"===t&&(n=c()),"game-over"===t&&(n=(t=(t=i).O,i=localStorage.getItem("hiscore")||0,R(["enter"],()=>{A("change-scene","menu")}),h=B(),s=G({text:"GAME OVER",x:128,y:48,align:"center",scale:2,color:"red"}),a=G({text:"SCORE "+t,x:128,y:96,align:"center"}),r=G({text:"PRESS ENTER TO CONTINUE",x:128,y:144,align:"center",color:"lightgreen"}),o=j(),h=N({i:[h,s,a,r,o]}),s=["GOOD BYE CAPTAIN @        ","THE ENEMY HAS WON","BUT... HEY!     ","THIS IS JUST A GAME"],i<t?s.push("YOU HAVE A NEW HIGH SCORE!"):s.push("TRY TO BEAT YOUR HIGH SCORE!"),o.start({G:s}),i<t&&(localStorage.setItem("hiscore",t),t=G({text:"NEW HIGH SCORE "+t,x:128,y:120,align:"center",color:"yellow"}),h.i.push(t)),h))});let n=c();!function({update:t,A:i}){function e(){if(requestAnimationFrame(e),a=performance.now(),r=a-s,s=a,!(1e3<r)){for(h+=r;h>=1e3/60;)t(1/60),h-=1e3/60;o.clearRect(0,0,o.canvas.width,o.canvas.height),i()}}let h=0,s,a,r;const o=C();return{start(){s=performance.now(),requestAnimationFrame(e)}}}({update(){n.update()},A(){n.A()}}).start()})()}();
!function(){function C(){return window.ca.context}function w(t){let{x:i=0,y:e=0,width:h,height:s}=t;return i-=.5*h,e-=.5*s,h<0&&(i+=h,h*=-1),s<0&&(e+=s,s*=-1),{x:i,y:e,width:h,height:s}}function h(t=()=>{},i){t.ka&&i.preventDefault(),t(i)}function i(t){var i=g[t.code],e=c[i];f[i]=!0,h(e,t)}function e(t){var i=g[t.code],e=d[i];f[i]=!1,h(e,t)}function y(t){return[].concat(t).some(t=>f[t])}function x(t,i,{oa:e="keydown",preventDefault:h=!0}={}){let s="keydown"==e?c:d;i.ka=h,[].concat(t).map(t=>s[t]=i)}function a(t,i){return new URL(t,i).href}function t(s){return window.ha||(window.ha={xa:a,ua:L}),new Promise((t,i)=>{let e,h;if(L[s])return t(L[s]);(e=new Image).onload=()=>{h=a(s,window.location.href),L[h]=L[s]=e,t(e)},e.onerror=()=>{i()},e.src=s})}function S({name:t="",x:i=-100,y:e=-100,dx:h=0,dy:s=0,N:a=0,H:o=0,width:r=10,height:n=10,D:l=1,F:c=1,rotation:d=0,anchor:f={x:.5,y:.5},g=1/0,color:u="white",O:m,update:v,l:p,m:w,image:y}={}){var x={O(t={}){Object.assign(this,t),this.ea&&this.ea()},advance(){this.x+=this.dx,this.y+=this.dy,this.dx+=this.N,this.dy+=this.H},M(){this.advance(),this.frame++,this.g--},update(){this.L?this.L():this.M()},la(){var t=this.context;t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),this.D&&this.F&&t.scale(this.D,this.F),t.translate(-this.width*f.x,-this.width*f.y),this.m()},l(){var t=this.context;t.save(),this.K?(t.translate(this.x,this.y),this.K()):(this.la(),t.restore())},ja(){var t=this.context;if(this.T)return this.T();t.fillStyle=this.color||"white",t.fillRect(0,0,this.width,this.height)},m(){this.T?this.T():this.ja()},P(){return 0<this.g},...arguments[0]};return x.O({name:t,x:i,y:e,dx:h,dy:s,N:a,H:o,width:r,height:n,D:l,F:c,rotation:d,anchor:f,g:g,color:u,frame:0,context:C(),ea:m,L:v,K:p,T:w,image:y}),x}function E(t,i){u[t]=u[t]||[],u[t].push(i)}function M(t,...i){(u[t]||[]).map(t=>t(...i))}function A(t){const e=[null,null,null,"purple","red","cyan","green","yellow","pink","orange"];return S({name:"enemy",x:-80,y:-80,image:L["spritesheet.png"],s:4,V:0,j:0,frame:0,D:.1,F:.1,i:2,o:!0,C:!1,...t,W(t){this.i-=t,this.j=1,this.i<=0&&!this.C&&this.u(),P(2.3,void 0,330,void 0,.06,.17,2,3.7,void 0,void 0,void 0,void 0,.05,.4,2,.5,.13,.89,.05,.17)},u(){this.fa.aa++,this.C=this.o=!0,this.g=10},update(){var t=this.path.getPointAtLength(this.frame),i=this.path.getPointAtLength(this.frame+1);this.x=Math.floor(t.x),this.y=Math.floor(t.y),4<this.j&&(this.j=0),this.rotate&&(this.rotation=90*Math.PI/180+Math.atan2(i.y-t.y,i.x-t.x)),this.rotate||(this.rotation=180*Math.PI/180),this.frame>=this.path.getTotalLength()&&(this.frame=0,!this.loop)&&(this.fa.aa++,this.g=0),t=Math.min(Math.max(0,this.frame/50),1),this.frame<50&&(t=this.frame/50),this.frame>this.path.getTotalLength()-50&&(t=(this.path.getTotalLength()-this.frame)/50),50==this.frame&&(this.o=!1),this.D=this.F=t,.995<Math.random()&&M("enemy-fire",this,this.rotate?1:0),0<this.j&&this.j++,this.V++,this.M(),this.g<=0&&this.C&&M("explosion",this.x,this.y,20,5,e[this.s])},m(){var t=this.context;1<this.frame&&t.drawImage(this.image,8*this.s,0,8,8,0,0,8,8),this.j&&(t.globalCompositeOperation="source-atop",t.fillStyle="white",t.fillRect(0,0,8,8),t.globalCompositeOperation="source-over")}})}function O(t,i){return s(m,i)}function v(t){var[t,i,e,h]=t;return{frame:t,sa:i,pause:e,wa:h}}function p(t){var[t,i,e,h,s]=t;return{frame:t,x:i,speed:e,type:h,value:s}}function s(t,u){const m=[];return t.forEach(t=>{var[i,e,h,s,a,o,r,n,l,c,d]=t,a=(t=m.push,a+Math.floor(u/4)),f=document.createElementNS("http://www.w3.org/2000/svg","svg"),g=document.createElementNS("http://www.w3.org/2000/svg","path");f.appendChild(g),g.setAttribute("d",l),g.setAttribute("fill","none"),g.setAttribute("stroke","black"),g.setAttribute("stroke-width","2"),g.setAttribute("id","path"),t.call(m,{frame:i,va:e,s:h,rotate:s,total:a,interval:5<o-u?o-u:5,loop:r,mode:n,path:g,ta:c.map(v),pa:d.map(p),count:0,U:!1,aa:0})}),{ga:m}}function R({create:t,A:i=10}){return{h:[t({x:-100,y:-100})],A:i,size:0,ia:t,get(t={}){if(this.size==this.h.length){if(this.size==this.A)return;for(var i=0;i<this.size&&this.h.length<this.A;i++)this.h.push(this.ia())}return i=this.h[this.size],this.size++,i.O(t),i},update(){let i,e=!1;for(let t=this.size;t--;)(i=this.h[t]).update(),i.P()||(e=!0,this.size--);e&&this.h.sort((t,i)=>i.P()-t.P())},l(){for(let t=this.size;t--;)this.h[t].l()},J(){return this.h.slice(0,this.size)}}}function b({h:t=[],update:i,l:e}){var h={...arguments[0],O(t={}){Object.assign(this,t)},update(){this.L&&this.L(),this.h.forEach(t=>t.update())},l(){this.K&&this.K(),this.h.forEach(t=>t.l())}};return h.O({h:t,context:C(),L:i,K:e}),h}function I({x:t=0,y:i=0,text:e="",color:a="white",align:o="left",lineHeight:r=8,scale:h=1}){const n=C(),s=8*e.split("\n").reduce((t,i)=>t.length>i.length?t:i).length;return S({x:t,y:i,width:s,height:8,anchor:{x:0,y:0},text:e,D:h,F:h,m(){const s=L["font.png"],t=this.text.split("\n");n.save(),t.forEach(e=>{n.save(),"center"===o&&n.translate(8*-e.length/2,0),"right"===o&&n.translate(8*-e.length,0);for(let i=0;i<e.length;i++){var h=e.charCodeAt(i);let t=64===h?41:58===h?40:33===h?39:63===h?38:44===h?37:46===h?36:32===h?-1:48<=h&&h<=57?h-22:65<=h&&h<=90?h-65:0;-1!==t&&(h=8*i,n.drawImage(s,8*t,0,8,8,h,0,8,8),n.globalCompositeOperation="source-atop",n.fillStyle=a||"white",n.fillRect(h,0,8,8),n.globalCompositeOperation="source-over")}n.restore(),n.translate(0,r)}),n.restore()}})}function o(t,i){var e=[],h=i.x+i.width/2,s=i.y+i.height/2;return i=t.y<s,s=t.y+t.height>=s,t.x<h&&(i&&e.push(0),s)&&e.push(2),t.x+t.width>=h&&(i&&e.push(1),s)&&e.push(3),e}function T(){function i(t){const i=2*Math.random()+.1,e=96*i;s.get({id:"star",x:Math.random()*h.canvas.width,y:t,dx:0,dy:i,width:1,height:1,g:240/i,update(){this.advance(),this.y>h.canvas.height&&(this.g=0)},m(){var t=this.context;t.fillStyle=`rgb(${e}, ${e}, ${e})`,t.fillRect(0,0,this.width,this.height)}})}const h=C(),s=R({create:S,A:300});for(let t=0;t<h.canvas.height;t+=2)i(t);return{update(){i(-1),s.update()},l(){s.l()}}}function r(){function i(t,a){t.ga.forEach(t=>{var i=a-t.frame,e=t.frame+t.total*t.interval;a>=t.frame&&a<e&&t.count<t.total&&0==i%t.interval&&(t.U=!1,t.count+=1,l.get({x:-100,y:-100,path:t.path,rotate:t.rotate,loop:t.loop,g:1/0,o:!0,C:!1,i:([5,6].includes(t.s)?4:2)*Math.floor(o/4),frame:0,s:t.s,fa:t}));{e=t.pa;var h=a;const s=[["powerup-fire","green",5],["powerup-shield","yellow",18]];e.forEach(t=>{if(void 0!==t.frame&&h===t.frame){const i=s[t.type];d.get({name:i[0],x:t.x,y:-8,width:8,height:8,color:i[1],dy:t.speed,image:L["font.png"],value:t.value,g:300,u(){r.R+=this.value,0===t.type&&P(1.6,void 0,291,.01,.21,.35,void 0,2.2,void 0,void 0,-136,.09,.03,void 0,void 0,.2,.2,.7,.28),1===t.type&&P(.5,void 0,375,.03,.07,.08,1,2.7,void 0,void 0,302,.05,.05,void 0,void 0,void 0,void 0,.93,.01,void 0,607),this.g=0},m(){var t=this.context;this.frame%20<10&&(t.fillStyle=this.color,t.fillRect(-3,-3,this.width+6,this.height+6),t.fillStyle="black",t.fillRect(-2,-2,this.width+4,this.height+4)),t.fillStyle=this.color,t.fillRect(-1,-1,this.width+2,this.height+2),t.drawImage(this.image,8*i[2],0,8,8,0,0,8,8)}})}})}t.U||t.count!==t.total||t.aa!==t.total||(t.U=!0)})}function e(h,t){h.P()&&!h.o&&t.forEach(t=>{var i,e;(i=(i="enemy"!==h.name||"enemy"!==t.name)&&(t.P()&&!h.o&&!t.o))&&(i=w(t),e=w(h),i=i.x<e.x+e.width&&i.x+i.width>e.x&&i.y<e.y+e.height&&i.y+i.height>e.y),i&&(t.name.includes("powerup-")||t.u(),"ship"==h.name&&"enemy"==t.name?h.W(50):"ship"==h.name&&"powerup-fire"==t.name?(h.na(t.value),t.u()):"ship"==h.name&&"powerup-shield"==t.name?(h.qa(t.value),t.u()):"ship"==h.name&&h.W(10),"enemy"==h.name)&&(h.W(1),r.R+=10)})}x(["esc"],()=>{M("change-scene","menu")});let o=1,h=1;const r=function(){const t=C();return S({name:"ship",x:t.canvas.width/2,y:t.canvas.height+16,image:L["spritesheet.png"],s:1,V:0,v:0,j:0,o:!0,C:!1,Z:!0,i:100,ba:3,R:0,W(t){this.o||(this.i-=t,this.j=1,this.i<=0&&this.u(),P(2.3,void 0,330,void 0,.06,.17,2,3.7,void 0,void 0,void 0,void 0,.05,.4,2,.5,.13,.89,.05,.17))},u(){this.C||(this.C=this.o=!0,this.ba--,this.g=5,this.ba<=0&&M("game-over"))},ra(){this.x=t.canvas.width/2,this.y=t.canvas.height+16,this.F=this.D=2,this.i=100,this.v=0,this.o=!0,this.C=!1,this.Z=!0,this.g=1/0,this.frame=0},na(){this.v++,3<this.v&&(this.v=3)},qa(){this.i=100},update(){this.H=this.N=0,this.dx*=.96,this.dy*=.96,this.s=1,y("arrowright")&&this.dx<5&&(this.N=.2,this.s=2),y("arrowleft")&&-5<this.dx&&(this.N=-.2,this.s=0),y("space")&&0==this.V%(15/(1<this.v?2:1))&&(0==this.v?M("ship-fire",this.x-1):1==this.v?(M("ship-fire",this.x-2,1),M("ship-fire",this.x+2,1)):2==this.v?(M("ship-fire",this.x-3,1),setTimeout(()=>M("ship-fire",this.x-1,2),200),M("ship-fire",this.x+3,1)):3==this.v&&(M("ship-fire",this.x-2,1),setTimeout(()=>M("ship-fire",this.x+2,1),300),setTimeout(()=>M("ship-fire",this.x-4,2),200),setTimeout(()=>M("ship-fire",this.x+4,2),100))),this.Z||(y("arrowdown")&&this.dy<5&&(this.H=.2),y("arrowup")&&-5<this.dy&&(this.H=-.2)),this.frame<100&&(this.H=-.03,this.D=this.F=2-this.frame/100),4<this.j&&(this.j=0),this.M(),this.x>t.canvas.width&&(this.x=t.canvas.width),this.x<0&&(this.x=0),!this.Z&&this.y>t.canvas.height&&(this.y=t.canvas.height),this.y<0&&(this.y=0),this.i<=0&&this.u(),this.g<=0&&(M("explosion",this.x,this.y,30,6,"white"),this.ra()),100==this.frame&&(this.o=!1,this.Z=!1),this.V++,0<this.j&&this.j++},m(){var t=this.context;t.drawImage(this.image,8*this.s,0,8,8,0,0,8,8),this.frame<100&&this.o&&this.frame%20<10&&(t.globalCompositeOperation="source-atop",t.fillStyle="white",t.fillRect(0,0,8,8),t.globalCompositeOperation="source-over"),this.j&&(t.globalCompositeOperation="source-atop",t.fillStyle="white",t.fillRect(0,0,8,8),t.globalCompositeOperation="source-over");let i=1;this.H<0&&(i=this.frame%10<5?2:3),t.fillStyle="#FFaa33",t.fillRect(3,7,2,i),t.fillStyle="#FF6633",t.fillRect(this.frame%10<5?3:4,7+i,1,i)}})}(),t=T(),s=R({create:S,A:100}),n=R({create:S,A:100}),l=R({create:A,A:100}),c=R({create:S,A:300}),d=R({create:S,A:10}),a=I({x:8,y:8,text:"SCORE 0"}),f=I({x:224,y:8,text:"@@@",color:"red"}),g=I({x:8,y:224,text:"",color:"yellow"}),u=I({x:128,y:120,text:"LEVEL "+o,color:"lightgreen",align:"center"}),m=S({x:192,y:8,width:24,height:8,anchor:{x:0,y:0},m(){var t=this.context,i=0<=r.i?r.i/5:0;t.strokeStyle="white",t.strokeRect(0,0,this.width,this.height),t.fillStyle="green",r.i<25&&(t.fillStyle="red"),t.fillRect(2,2,i,this.height-4)}}),v=(E("ship-fire",(t,i=0)=>{s.get({name:"ship-bullet",x:t,y:r.y-4,dx:(1-2*Math.random())/(4-i),dy:-5,width:2,height:3,g:80,u(){this.g=0,this.y=this.x=-100},m(){var t=this.context;t.fillStyle="white",t.fillRect(0,0,this.width,1),t.fillStyle="yellow",t.fillRect(0,1,this.width,1),t.fillStyle="red",t.fillRect(0,2,this.width,1)}}),P(.9,void 0,413,void 0,.05,.01,1,3.8,-3,-13.4,void 0,void 0,void 0,void 0,void 0,void 0,.11,.65,.07,void 0,237)}),E("enemy-fire",({x:t,y:i},e=0)=>{var h=r.x-4-t,s=r.y-i,a=+Math.hypot(h,s);n.get({name:"enemy-bullet",x:t+4,y:i,dx:0==e?0:h/a,dy:0==e?1.5:s/a,width:2,height:2,g:400,u(){this.g=0,this.y=this.x=-100},m(){var t=this.context;t.fillStyle="red",t.fillRect(0,0,this.width,this.width)}}),P(.3,void 0,222,.02,.04,.09,3,.3,11,10,void 0,void 0,void 0,void 0,15,void 0,void 0,.53,.17)}),E("explosion",(h,s,i=50,a=3,o="white")=>{for(let t=0;t<i;t++){let t=360*Math.random(),i=a,e=Math.random()*i+i;c.get({name:"particle",x:h,y:s,dx:Math.cos(t*Math.PI/180)*e/10,dy:Math.sin(t*Math.PI/180)*e/10,width:1,height:1,g:30*i,color:o,update(){var t=256/30*i*(this.g/30);"white"==o&&(this.color=`rgb(${t},${t},${t})`),"red"==o&&(this.color=`rgb(${t},0,0)`),this.M()},m(){var t=this.context;t.fillStyle=this.color,t.fillRect(0,0,this.width,this.height)}}),c.get({name:"particle",x:h,y:s,dx:Math.cos(t*Math.PI/180)*e/20,dy:Math.sin(t*Math.PI/180)*e/20,width:2,height:2,g:10*i/2,update(){var t=256/(i/2)*(this.g/10);this.color=`rgb(${t},${t},${t})`,this.M()},m(){var t=this.context;t.fillStyle=this.color,t.beginPath(),t.arc(0,0,2,0,2*Math.PI),t.fill()}})}P(void 0,void 0,45,.03,.21,.6,4,.9,2,-3,void 0,void 0,void 0,.2,void 0,.9,void 0,.45,.26)}),new D),p=new D;return b({h:[t,r,d,s,n,l,c,a,f,m,g],level:O(h,1),frame:0,update(){i(this.level,this.frame),u.update(),v.clear(),v.add(r,l.J(),n.J(),d.J()),e(r,v.get(r)),p.clear(),l.J().forEach(t=>{p.add(t,s.J()),e(t,p.get(t))});var t=this.level.ga.filter(t=>!t.U).length;0===t&&0===l.J().length&&(o++,1<++h&&(h=1),this.level=O(h,o),this.frame=0,u.text="LEVEL "+o,P(void 0,void 0,264,.07,.29,.06,1,3.7,void 0,-30,-148,.07,.08,void 0,void 0,void 0,void 0,.76,.22,void 0,-1240)),a.text="SCORE "+r.R,f.text="@@@".slice(0,r.ba),g.text=(this.frame+"").padStart(8,"0")+" "+(t+"").padStart(2,"0"),this.frame++},l(){this.frame<100&&u.l()}})}function n(){return x(["enter"],()=>{M("change-scene","game")}),b({h:[T(),I({text:"MICRO SHOOTER",x:128,y:48,align:"center",scale:2,color:"red"}),I({text:"JS13K 2024 EDITION",x:128,y:96,align:"center"}),I({text:"PRESS ENTER TO START",x:128,y:144,align:"center",color:"yellow"}),I({text:"ARROWS TO MOVE\nSPACE TO SHOOT",x:128,y:192,align:"center"})]})}function l(){var t=C();t.filter="url(#remove-alpha)"===t.filter?"none":"url(#remove-alpha)"}let c={},d={},f={},g={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"},L={},u={},z=new AudioContext,P=(t=1,i=.05,e=220,h=0,s=0,a=.1,o=0,r=1,n=0,l=0,c=0,d=0,f=0,k=0,g=0,F=0,u=0,m=1,v=0,p=0,w=0)=>{let y=Math,x=2*y.PI,H=n*=500*x/44100/44100,C=e*=(1-i+2*i*y.random(i=[]))*x/44100,S=0,$=0,E=0,M=1,B=0,V=0,A=0,O=w<0?-1:1;var R=x*O*w*2/44100,b=y.cos(R),I=y.sin,U=-2*b/(R=1+(T=I(R)/4)),T=(1-T)/R,L=(1+O*b)/2/R,b=-(O+b)/R;let P=0,D=0,j=0,N=0;for(l*=500*x/44100**3,g*=x/44100,c*=x/44100,d*=44100,f=44100*f|0,t*=.3,O=(h=44100*h+9)+(v*=44100)+(s*=44100)+(a*=44100)+(u*=44100)|0;E<O;i[E++]=A*t)++V%(100*F|0)||(A=o?1<o?2<o?3<o?I(S**3):y.max(y.min(y.tan(S),1),-1):1-(2*S/x%2+2)%2:1-4*y.abs(y.round(S/x)-S/x):I(S),A=(f?1-p+p*I(x*E/f):1)*(A<0?-1:1)*y.abs(A)**r*(E<h?E/h:E<h+v?1-(E-h)/v*(1-m):E<h+v+s?m:E<O-u?(O-E-u)/a*m:0),A=u?A/2+(u>E?0:(E<O-u?1:(O-E)/u)*i[E-u|0]/2/t):A,w&&(A=N=L*P+b*(P=D)+L*(D=A)-T*j-U*(j=N))),R=(e+=n+=l)*y.cos(g*$++),S+=R+R*k*I(E**5),M&&++M>d&&(e+=c,C+=c,M=0),!f||++B%f||(e=C,n=H,M=M||1);(t=z.createBuffer(1,O,44100)).getChannelData(0).set(i),(e=z.createBufferSource()).buffer=t,e.connect(z.destination),e.start()};var m=[[100,!1,4,!1,3,330,!1,0,"M1 1s162 189 172 199c11 10 30 35 59 24 29-12 9-54 0-65L120 37S99 11 71 15c-27 3-46 47-46 47S4 106 4 126s-3 67 11 77c15 10 55 41 79 9L247 1",[[99,0,!0,"CAPTAIN;WE HAVE DETECTED;SOME ENEMY SCOUTS;A FULL WAVE IS IMINENT;    ;PROCEED WITH CAUTION;AND GOOD LUCK!".split(";")]],[[410,120,1,0,10],[730,200,1,1,10]]],[200,!0,5,!0,3,60,!1,0,"M113.696 117.212C128.254 117.212 156.71 108.752 154.725 91.832C152.74 74.9117 136.196 52.5529 113.696 52.5529C91.1957 52.5529 64.7252 64.0345 54.7988 79.7461C44.8723 95.4577 38.9165 134.737 54.7988 152.261C70.6811 169.786 80.6075 172.807 105.755 172.203C130.902 171.599 155.387 160.117 170.607 149.24C185.828 138.363 203.034 112.378 202.372 91.832C201.71 71.286 207.004 45.9058 189.798 28.3813C172.593 10.8567 149.431 -0.625112 98.4751 1.18777C47.5194 3.00065 40.9017 23.5468 30.3135 38.0498C19.7253 52.5529 2.51948 78.5374 1.19596 112.378C-0.127568 146.219 5.16655 173.412 19.7253 189.728C34.2841 206.044 72.0046 225.381 98.4751 225.985C124.946 226.59 177.887 208.461 194.431 194.562C210.975 180.663 232.813 157.7 238.107 128.09C243.401 98.4791 244.725 70.6818 232.813 52.5529C220.901 34.424 207.666 18.7631 165.313 10.9072C122.96 3.05134 87.8869 18.1082 70.6811 31.4026C53.4752 44.697 19.7253 83.3718 19.7253 112.378C19.7253 141.384 25.6812 165.556 54.7988 186.102C83.9163 206.648 148.107 193.353 167.96 180.663C187.813 167.973 214.284 149.24 218.916 117.212C223.548 85.1847 199.725 59.2001 173.916 46.5099C148.107 33.8198 105.755 33.2155 83.9163 46.5099C62.0781 59.8043 40.24 93.0406 56.7841 128.09C73.3281 163.139 99.1369 163.139 115.681 156.492C132.225 149.844 167.96 141.384 173.916 112.378C179.872 83.3718 177.887 66.4517 142.151 59.2001C106.416 51.9485 79.284 62.2217 79.284 93.6449C79.284 125.068 98.4751 117.212 98.4751 117.212",[],[]],[400,!0,6,!0,3,200,!1,0,"M241 228V23c0-29-40-29-40 0v186c0 36-30 25-37 0S140 7 116 7 82 168 77 206c-5 37-38 29-38 0V33C39-11 1-7 1 33v195",[],[]],[600,!0,7,!1,3,20,!1,0,"M235 1H13c-14 0-11 9 0 9h214c17 0 17 10 0 10H13c-18 0-14 12 0 12h214c20 0 19 15 0 15H13c-16 0-16 13 0 13h244",[],[]]];class D{constructor({X:t=3,Y:i=25,B:e}={}){this.X=t,this.Y=i,t=C().canvas,this.B=e||{x:0,y:0,width:t.width,height:t.height},this.S=!1,this.$=0,this.I=[],this.G=[]}clear(){this.G.map(t=>{t.clear()}),this.S=!1,this.I.length=0}get(i){let e=new Set;return this.G.length&&this.S?(o(i,this.B).map(t=>{this.G[t].get(i).map(t=>e.add(t))}),Array.from(e)):this.I.filter(t=>t!==i)}add(...t){t.flat().map(t=>{this.S?this.da(t):(this.I.push(t),this.I.length>this.Y&&this.$<this.X&&(this.ma(),this.I.map(t=>this.da(t)),this.I.length=0))})}da(i){o(i,this.B).map(t=>{this.G[t].add(i)})}ma(){if(this.S=!0,!this.G.length)for(var t=this.B.width/2|0,i=this.B.height/2|0,e=0;e<4;e++)this.G[e]=new D({B:{x:this.B.x+(1==e%2?t:0),y:this.B.y+(2<=e?i:0),width:t,height:i},X:this.X,Y:this.Y}),this.G[e].$=this.$+1}}j=document.getElementById("c").getContext("2d"),window.ca=window.ca||{};var j=window.ca.context=j;j.imageSmoothingEnabled=!1,j.setTransform(1,0,0,1,0,0),j.filter="url(#remove-alpha)";{let t;for(t=0;t<26;t++)g["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)g["Digit"+t]=g["Numpad"+t]=""+t;window.addEventListener("keydown",i),window.addEventListener("keyup",e)}(async()=>{await t("font.png"),await t("spritesheet.png"),x("e",l),E("change-scene",t=>{{var[e,{oa:h="keydown"}={}]=[["enter","esc"]];let i="keydown"==h?c:d;[].concat(e).map(t=>delete i[t])}var s;s=["change-scene"],u=Object.keys(u).reduce((t,i)=>(s.includes(i)&&(t[i]=u[i]),t),{}),"game"===t&&(i=r()),"menu"===t&&(i=n())});let i=n();!function({update:t,l:i}){function e(){if(requestAnimationFrame(e),o=performance.now(),r=o-a,a=o,!(1e3<r)){for(h+=r;h>=s;)t(1/60),h-=s;n.clearRect(0,0,n.canvas.width,n.canvas.height),i()}}let h=0,s=1e3/60,a,o,r;const n=C();return{start(){a=performance.now(),requestAnimationFrame(e)}}}({update(){i.update()},l(){i.l()}}).start()})()}();
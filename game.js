!function(){"use strict";function h(){return window.zyxplay.context}function q(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return e.appendChild(i),i.setAttribute("d",t),i.setAttribute("fill","none"),i.setAttribute("stroke","black"),i.setAttribute("stroke-width","2"),i.setAttribute("id","path"),i}function R(t){return t*Math.PI/180}function V(t,e,i){return Math.min(Math.max(t,i),e)}function b(t){let{x:e=0,y:i=0,width:n,height:s}=t;return e-=.5*n,i-=.5*s,n<0&&(e+=n,n*=-1),s<0&&(i+=s,s*=-1),{x:e,y:i,width:n,height:s}}function T(t,e,...i){return setTimeout(t,e,...i)}function k(t=0,e=1){return Math.random()*(e-t)+t}function v(t,e){return t[e]|t[e+1]<<8}function g(t,e){return t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24}function w(t){return t<128?String.fromCharCode(t):String.fromCharCode([199,252,233,226,228,224,229,231,234,235,232,239,238,236,196,197,201,230,198,244,246,242,251,249,255,214,220,248,163,216,215,402,225,237,243,250,241,209,170,186,191,174,172,189,188,161,171,187,9617,9618,9619,9474,9508,193,194,192,169,9571,9553,9559,9565,162,165,9488,9492,9524,9516,9500,9472,9532,227,195,9562,9556,9577,9574,9568,9552,9580,164,240,208,202,203,200,305,205,206,207,9496,9484,9608,9604,166,204,9600,211,223,212,210,245,213,181,254,222,218,219,217,253,221,175,180,173,177,8215,190,182,167,247,184,176,168,183,185,179,178,9632,160][t-128])}let r={};function N(t,e){r[t]=r[t]||[],r[t].push(e)}function z(t,...e){(r[t]||[]).map(t=>t(...e))}let p={},Z={};function C(t,e){return new URL(t,e).href}function A(){window.__k||(window.__k={u:C,i:p,d:Z})}function n(t,e,i){if(A(),Z[t])return Z[t];Z[t]=e(...i)}function o(s,a=null){return A(),new Promise((t,e)=>{let i,n;return a?(p[s]=a,t(a)):p[s]?t(p[s]):((i=new Image).onload=()=>{n=C(s,window.location.href),p[n]=p[s]=i,t(i)},i.onerror=()=>{e()},void(i.src=s))})}class e{constructor(t){this.init(t)}init(t={}){t={name:"",x:0,y:0,width:8,height:8,rotation:0,scaleX:1,scaleY:1,anchor:{x:0,y:0},color:"white",dx:0,dy:0,ddx:0,ddy:0,ttl:1/0,frame:0,sprite:0,context:h(),spritesheet:[p["spritesheet.png"],8,8],shield:20,hitted:!1,_uf:t.update,_rf:t.render,_df:t.draw,...t};Object.assign(this,t)}hit(t){z("hit"),this.shield-=t,this.hitted=!0,this.shield<=0&&this.die&&this.die(),T(()=>this.hitted=!1,100)}advance(){this.x+=this.dx,this.y+=this.dy,this.dx+=this.ddx,this.dy+=this.ddy,this.ttl--,this.frame++}update(){this._uf?this._uf():this.advance()}render(){if(this._rf)return this._rf();var{context:t,x:e,y:i,anchor:n,rotation:s,scaleX:a,scaleY:r,width:o,height:h}=this;t.save(),t.translate(e,i),s&&t.rotate(s),a&&r&&t.scale(a,r),t.translate(-o*n.x,-h*n.y),this.draw(),t.restore()}draw(){if(this._df)return this._df();var{context:t,color:e,width:i,height:n}=this;this.hitted&&(t.save(),t.translate(0,-1)),this.color?(t.fillStyle=e,t.fillRect(0,0,i,n)):t.drawImage(this.spritesheet[0],this.sprite*this.spritesheet[1],0,i,n,0,0,i,n),this.hitted&&(t.globalCompositeOperation="source-atop",t.fillStyle="white",t.fillRect(0,0,i,n),t.globalCompositeOperation="source-over",t.restore())}isAlive(){return 0<this.ttl}}const F=t=>new e(t);class S{constructor(t){this.init(t)}init(i={}){var t=Object.keys(i).reduce((t,e)=>("function"!=typeof i[e]&&(t[e]=i[e]),t),{}),t={id:"scene",context:h(),_uf:i.update,_rf:i.render,children:[],paused:!1,...t};Object.assign(this,t)}add(t){this.children.push(t)}pause(){this.paused=!0}resume(){this.paused=!1}update(e){this.paused||(this.children.forEach(t=>{if(!t.isAlive)return t.update(e);t.isAlive()&&t.update(e)}),this._uf&&this._uf())}render(){this.context.save(),this._uf&&this._uf(),this.children.forEach(t=>{if(!t.isAlive)return t.render();t.isAlive()&&t.render()}),this.context.restore()}}function j(t){return new S(t)}class M extends e{constructor(t={}){var t={name:"text",x:0,y:0,text:"",color:"white",align:"left",lineHeight:8,scale:1,spritesheet:p["font.png"],...t},e=t.color?`font-${t.color}.png`:"font.png";t.spritesheet=p[e],super(t)}draw(){var t=this.text.split("\n");const{context:a,align:e,lineHeight:r}=this;a.save(),t.forEach(i=>{a.save(),"center"===e&&a.translate(8*-i.length/2,0),"right"===e&&a.translate(8*-i.length,0);for(let e=0;e<i.length;e++){var n,s=i.charCodeAt(e);let t=64===s?41:58===s?40:33===s?39:63===s?38:44===s?37:46===s?36:32===s?-1:48<=s&&s<=57?s-22:65<=s&&s<=90?s-65:0;-1!==t&&(s=9*t,0,n=8*e,0,a.drawImage(this.spritesheet,s,0,9,9,n,0,9,9))}a.restore(),a.translate(0,r)}),a.restore()}}function D(t){return new M(t)}class E extends e{constructor(t){super({name:"explosion-particle",color:"white",anchor:{x:.5,y:.5},...t})}update(){!this.color&&this.ttl<30&&(this.scaleX=this.scaleY=this.ttl/30),this.color&&this.ttl<60&&(this.scaleX=this.scaleY=this.ttl/60),this.advance()}draw(){this.color||this.context.drawImage(this.spritesheet[0],120,0,8,8,0,0,8,8),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,2,2))}}function W(t){return new E(t)}let a={},O={},I={},l={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function L(t=()=>{},e){t._pd&&e.preventDefault(),t(e)}function X(t){var e=l[t.code],i=a[e];I[e]=!0,L(i,t)}function K(t){var e=l[t.code],i=O[e];I[e]=!1,L(i,t)}function s(t){return[].concat(t).some(t=>I[t])}function P(t,e,{handler:i="keydown",preventDefault:n=!0}={}){let s="keydown"==i?a:O;e._pd=n,[].concat(t).map(t=>s[t]=e)}function J(t,{handler:e="keydown"}={}){let i="keydown"==e?a:O;[].concat(t).map(t=>delete i[t])}const U=(...t)=>{let e=Q.createBufferSource(),i=Q.createBuffer(t.length,t[0].length,Y);return t.map((t,e)=>i.getChannelData(e).set(t)),e.buffer=i,e.connect(Q.destination),e.start(),e},H=(t=1,e=.05,i=220,n=0,s=0,a=.1,r=0,o=1,h=0,l=0,c=0,p=0,f=0,d=0,u=0,m=0,y=0,_=1,v=0,g=0)=>{let w=2*Math.PI,x=h*=500*w/Y**2,b=(0<u?1:-1)*w/4,C=i*=(1+2*e*Math.random()-e)*w/Y,A=[],S=0,M=0,E=0,H=1,O=0,I=0,L=0,R,V;for(n=99+Y*n,v*=Y,s*=Y,a*=Y,y*=Y,l*=500*w/Y**3,u*=w/Y,c*=w/Y,p*=Y,f=Y*f|0,V=n+v+s+a+y|0;E<V;A[E++]=L)++I%(100*m|0)||(L=r?1<r?2<r?3<r?Math.sin((S%w)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/w%2+2)%2:1-4*Math.abs(Math.round(S/w)-S/w):Math.sin(S),L=(f?1-g+g*Math.sin(2*Math.PI*E/f):1)*(0<L?1:-1)*Math.abs(L)**o*t*$*(E<n?E/n:E<n+v?1-(E-n)/v*(1-_):E<n+v+s?_:E<V-y?(V-E-y)/a*_:0),L=y?L/2+(y>E?0:(E<V-y?1:(V-E)/y)*A[E-y|0]/2):L),R=(i+=h+=l)*Math.sin(M*u-b),S+=R-R*d*(1-1e9*(Math.sin(E)+1)%2),M+=R-R*d*(1-1e9*(Math.sin(E)**2+1)%2),H&&++H>p&&(i+=c,C+=c,H=0),!f||++O%f||(i=C,h=x,H=H||1);return A},$=.3,Y=44100,Q=new(window.AudioContext||webkitAudioContext),c=256,f=240;class tt extends e{init(t){t={name:"ship",spawning:!0,y:248,spritesheet:[p["spritesheet16.png"],16,16],width:16,height:16,imune:!1,dying:!1,shield:100,lives:3,score:0,fireLevel:0,firing:!1,fireTimeout:null,anchor:{x:.5,y:.5},sprite:1,...t};super.init(t),this.spawn()}powerUp(t){U(Z.powerup),"shield"===t.type&&(this.shield+=100,100<this.shield)&&(this.shield=100);var e=this.fireType;"fire"!==t.type&&"laser"!==t.type||(this.fireType="fire"===t.type?0:1,this.fireType!==e&&(this.fireLevel=0),this.fireLevel++,4<this.fireLevel&&(this.fireLevel=4),4===this.fireLevel&&(clearTimeout(this.fireTimeout),z("start-fire-timer"),this.fireTimeout=T(()=>{z("end-fire-timer"),4===this.fireLevel&&(this.fireLevel=3)},3e4)))}fire(){this.firing||(this.firing=!0,z("ship-fire",this.x-1,this.y-8,k(-.3,.3)),0<this.fireLevel&&z("ship-fire",this.x-1,this.y-8,k(-.5,.5)),1<this.fireLevel&&T(()=>{z("ship-fire",this.x-1,this.y-8,k(-.3,.3)),z("ship-fire",this.x-1,this.y-8,k(-.5,.5))},100),2<this.fireLevel&&T(()=>{z("ship-fire",this.x-1,this.y-8,-2),z("ship-fire",this.x-1,this.y-8,2)},400),3<this.fireLevel&&T(()=>{z("ship-fire",this.x-16,this.y-4,k(-.1,.1)),z("ship-fire",this.x+14,this.y-4,k(-.1,.1))},200),T(()=>{this.firing=!1},200))}fire2(){if(!this.firing){this.firing=!0;let t=200;z("ship-fire-laser",this.x-1,this.y-16,0),0<this.fireLevel&&(T(()=>{z("ship-fire-laser",this.x-6,this.y-10,0)},20),T(()=>{z("ship-fire-laser",this.x+5,this.y-10,0)},40)),1<this.fireLevel&&(t=150),2<this.fireLevel&&(t=100),3<this.fireLevel&&(T(()=>{z("ship-fire-laser",this.x-16,this.y-16,0)},60),T(()=>{z("ship-fire-laser",this.x+14,this.y-16,0)},80)),T(()=>{this.firing=!1},t)}}die(){z("ship-die"),z("explosion",this.x,this.y-4,60,4,"white",!0),this.dying=!0,this.ttl=0,this.lives--,this.imune=!0,this.dx=0,this.ddx=0,this.x=128,T(()=>{this.spawn()},1e3)}spawn(){this.imune=!0,this.spawning=!0,this.ttl=1/0,this.y=f+32,this.frame=0,this.shield=100,this.fireLevel=0,this.fireType=0,T(()=>{this.spawning=!1,this.imune=!1},1e3)}update(){this.ddx=0,this.ddy=0,this.dx*=.91,this.dy*=.91,this.sprite=2,s(["d","arrowright"])&&this.dx<2&&(this.ddx=.3,this.sprite=3),s(["a","arrowleft"])&&-2<this.dx&&(this.ddx=-.3,this.sprite=4),this.spawning||(s(["s","arrowdown"])&&this.dy<2&&(this.ddy=.3),s(["w","arrowup"])&&-2<this.dy&&(this.ddy=-.3)),!this.firing&&s("space")&&0===this.fireType&&this.fire(),!this.firing&&s("space")&&1===this.fireType&&this.fire2(),this.spawning&&(this.ddy=-.1,this.scaleX=this.scaleY=V(1,2,2-this.frame/60)),this.shield<=0&&this.die(),this.advance(),this.x<4&&(this.x=4,this.dx=0),this.x>c-4&&(this.x=c-4,this.dx=0),this.y<4&&(this.y=4,this.dy=0),this.y>f-4&&(this.y=f-4,this.dy=0)}draw(){var{context:t,width:e,height:i}=this;t.drawImage(this.spritesheet[0],this.spritesheet[1]*this.sprite,0,e,i,0,0,e,i);let n=1;this.ddy<0&&(n=this.frame%10<5?2:3),t.fillStyle="#FFaa33",t.fillRect(7,13,2,n),t.fillStyle="#FF6633",t.fillRect(this.frame%10<5?7:8,13+n,1,n),4===this.fireLevel&&(t.fillStyle="#FFF",t.fillRect(22,4,2,2),t.fillRect(-8,4,2,2)),this.hitted&&(t.globalCompositeOperation="source-atop",t.fillStyle="red",t.fillRect(0,0,e,i),t.globalCompositeOperation="source-over")}}class et{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t({id:""}))||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t({id:""})],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}var e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(e){var i;let n=!1;for(let t=this.size;t--;)(i=this.objects[t]).update(e),i.isAlive()||(n=!0,this.size--);n&&this.objects.sort((t,e)=>e.isAlive()-t.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function G(t){return new et(t)}function it(e=1){var i=G({create:F,maxSize:480});i.increaseVel=function(e){this.objects.forEach(t=>{t.dy=t.dy*e})},i.decreaseVel=function(e){this.objects.forEach(t=>{t.dy=t.dy/e})},i.velocity=e;for(let t=-10;t<f;t++){var n=k(1,3)*e,s=Math.floor(n/e*50)+50;t%2==0&&i.get({x:Math.floor(k(0,c)),y:t,width:1,height:1+n/4,dy:n/4,color:`rgb(${s}, ${s}, ${s})`,update(){this.advance(),this.y>f&&(this.y=-10),this.height=1+this.dy/4}})}return i.isAlive=()=>!0,i}class nt extends e{init(t){t={name:"asteroid",spritesheet:[p["spritesheet16.png"],16,16],sprite:1,width:16,height:16,color:null,anchor:{x:.5,y:.5},shield:10,...t};super.init(t)}die(){z("explosion",this.x,this.y,50,4,"white"),z("score",10),this.ttl=0}update(){this.rotation=this.frame/(10/this.dy),this.advance(),this.x<0||this.x>c+8||this.y>f+8&&(this.ttl=0)}}function st(t){return new nt(t)}function at(t,e){var i=[],n=e.x+e.width/2,e=e.y+e.height/2,s=t.y<e,e=t.y+t.height>=e;return t.x<n&&(s&&i.push(0),e)&&i.push(2),t.x+t.width>=n&&(s&&i.push(1),e)&&i.push(3),i}class rt{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;t=h().canvas;this.bounds=i||{x:0,y:0,width:t.width,height:t.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(t=>{t.clear()}),this._b=!1,this._o.length=0}get(e){let i=new Set;return this._s.length&&this._b?(at(e,this.bounds).map(t=>{this._s[t].get(e).map(t=>i.add(t))}),Array.from(i)):this._o.filter(t=>t!==e)}add(...t){t.flat().map(t=>{this._b?this._a(t):(this._o.push(t),this._o.length>this.maxObjects&&this._d<this.maxDepth&&(this._sp(),this._o.map(t=>this._a(t)),this._o.length=0))})}_a(e){at(e,this.bounds).map(t=>{this._s[t].add(e)})}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=new rt({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(2<=i?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1}}function ot(t){return new rt(t)}class ht extends e{init(t){t={name:"enemy",sprite:3,color:null,anchor:{x:.5,y:.5},shield:1,frame:0,loop:!0,firstRun:!0,debryColor:"white",fireRate:200,speed:1,...t};super.init(t),this.path&&(this.ttl=Math.floor(t.path.getTotalLength()/this.speed)),this.loop&&(this.ttl=1/0)}fire(){z("enemy-fire",this.x-4,this.y-4,this.rotation,3)}die(){z("explosion",this.x,this.y,20,3,this.debryColor),z("score",10),this.ttl=0}update(){var t,e;this.rotation=R(180),this.path?(t=this.path.getPointAtLength(this.frame*this.speed),e=this.path.getPointAtLength(this.frame*this.speed+1),this.x=Math.floor(t.x),this.y=Math.floor(t.y),this.rotate&&(this.rotation=R(90)+Math.atan2(e.y-t.y,e.x-t.x))):(this.x=this.parent.x+Math.cos(this.frame/this.parent.childrenSpeed+this.anglePlacement)*this.parent.childrenRadius,this.y=this.parent.y+Math.sin(this.frame/this.parent.childrenSpeed+this.anglePlacement)*this.parent.childrenRadius),this.firstRun&&(this.scaleX=this.scaleY=V(0,1,(this.frame*this.speed+1)/100)),!this.loop&&this.ttl<100&&(this.scaleX=this.scaleY=V(0,1,this.ttl/100)),this.scaleX<1&&(this.imune=!0),1<=this.scaleX&&(this.imune=!1),1==this.scaleX&&this.frame%this.fireRate==0&&this.fire(),this.path&&this.frame*this.speed>=this.path.getTotalLength()&&this.loop&&(this.frame=0,this.firstRun=!1),this.frame++,this.ttl--}}function lt(t){return new ht(t)}class ct extends ht{init(t){t={name:"boss",spritesheet:[p["spritesheet16.png"],16,16],sprite:0,width:16,height:16,color:null,shield:10,debryColor:"white",fireRate:200,firing:!1,loop:!1,imune:!0,showStatus:!1,timers:[],...t};super.init(t),this.maxShield=this.shield}hit(t){super.hit(t),this.showStatus=!0,T(()=>{this.showStatus=!1},1e3)}fire(){this.firing=!0,this.imune=!1,this.timers[0]=T(()=>{z("boss-fire",this.x,this.y,this.rotation,3)},400),this.timers[1]=T(()=>{z("boss-fire",this.x,this.y,this.rotation,3)},800),this.timers[2]=T(()=>{z("boss-fire",this.x,this.y,this.rotation,3)},1200),T(()=>{this.firing=!1,this.imune=!0},1600)}die(){z("explosion",this.x,this.y,70,6,this.debryColor,!0),z("score",10),this.ttl=0,this.timers.map(t=>clearTimeout(t)),z("boss-die")}update(){this.firing||super.update(),this.firing||(this.imune=!0)}draw(){var t,e;super.draw(),this.showStatus&&(t=this["context"],e=20*this.shield/this.maxShield,t.save(),t.translate(this.width/2,this.height/2),t.rotate(-this.rotation),t.fillStyle="white",t.fillRect(-12,-16,24,6),t.fillStyle="black",t.fillRect(-11,-15,22,4),t.fillStyle="green",this.shield<this.maxShield/4&&(t.fillStyle="red"),t.fillRect(-10,-14,e,2),t.restore())}}function pt(t){return new ct(t)}class ft extends e{init(t){t={name:"dialog",x:-16,y:200,sprites:[10,11,12,13,14],text:D({text:"",x:16,y:8,align:"left"}),textIndex:0,texts:[],textsIndex:0,spriteIndex:0,frame:0,anchor:{x:0,y:0},talking:!1,isTalking:!1,stopping:!1,pauseOnTalk:!0,...t};super.init(t)}skip(){0==this.texts.length||this.textsIndex>this.texts.length||(this.textIndex=this.texts[this.textsIndex].length)}start(t){this.stopping=!1,setTimeout(()=>{this.isTalking=!0,this.texts=["",...t.texts],this.frame=0,this.pauseOnTalk=t.pauseOnTalk},1e3),this.dx=2}stop(){this.stopping=!0,this.text.text="        ",this.isTalking=!1,setTimeout(()=>{this.texts=[],this.textsIndex=0,this.textIndex=0,this.frame=0},1e3),this.dx=-2}update(){var t;8<this.x&&(this.dx=0,this.x=8),this.y<-16&&(this.dx=0,this.x=-16),0!=this.texts.length&&(this.talking=!1," "!==(t=this.texts[this.textsIndex]+"      ")[this.textIndex]&&(this.talking=!0),this.frame%5==0&&(this.textIndex++," "!==t[this.textIndex])&&U(Z.typing),this.textsIndex<this.texts.length&&(this.text.text=t.slice(0,this.textIndex)),this.frame++,this.textIndex>=t.length&&(this.textsIndex++,this.frame=0,this.textIndex=0),this.textsIndex>=this.texts.length&&!this.stopping&&this.stop(),this.talking&&this.frame%5==0&&this.spriteIndex++,this.spriteIndex>=this.sprites.length&&(this.spriteIndex=0),super.update())}draw(){var{context:t,spritesheet:e}=this;t.fillStyle="white",t.fillRect(-2,-2,12,12),t.drawImage(e[0],8*this.sprites[this.spriteIndex],0,8,8,0,0,8,8),t.translate(16,0),this.text.draw()}}const dt=t=>new ft(t);function B(n,t){n.isAlive()&&t.forEach(t=>{var e,i;"enemy"===n.name&&"enemy"===t.name||t.isAlive()&&!n.imune&&!t.imune&&(i=n,e=b(e=t),i=b(i),e.x<i.x+i.width)&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y&&("ship-bullet"!=n.name||t.imune||(n.ttl=0,t.hit(1)),"ship"!=n.name||"asteroid"!=t.name&&"boss"!=t.name||(n.die(),n.ttl=0,t.hit(5)),"ship"==n.name&&"enemy"==t.name&&(t.die(),t.ttl=0,n.hit(50)),"ship"==n.name&&"enemy-bullet"==t.name&&(t.ttl=0,n.hit(10)),"ship"!=n.name||"powerup"!=t.name||t.taken||(t.die(),n.powerUp(t)))})}class ut extends e{init(t){super.init({name:"powerup",type:"fire",width:17,height:17,taken:!1,anchor:{x:.5,y:.5},spritesheet:[p["font-white.png"],9,9],...t})}die(){this.taken=!0,this.ttl=10,this.frame=0}update(){248<this.y&&(this.ttl=0),this.frame%100!=0||this.taken||("fire"===this.type?this.type="laser":"laser"===this.type&&(this.type="fire")),super.update()}draw(){var{context:t,type:e,taken:i,frame:n}=this;let s,a;"shield"===e&&(s="yellow",a=18),"fire"===e&&(s="red",a=1),"laser"===e&&(s="lightblue",a=11),t.strokeStyle=s,t.lineWidth=2,n%20<10&&!i&&t.strokeRect(0,0,17,17),t.fillStyle=s,t.fillRect(3,3,11,11),t.drawImage(this.spritesheet[0],9*a,0,9,9,4,4,9,9),i&&(t.globalAlpha=1-this.frame/10,t.strokeRect(-this.frame,-this.frame,17+2*this.frame,17+2*this.frame),t.globalAlpha=1)}}function mt(t){return new ut(t)}const d={spiral:"M127 120V43c0-77 99 8 99 77 0 70-35 102-99 102S22 181 22 120s32-84 84-84 85 32 85 84c0 53-28 62-64 62-35 0-68-18-68-62 0-43 25-47 47-47 21 0 48 24 48 47 0 24-7 28-27 28s0-14 0-28Z",zigzag:"M287 13-21 61l293 46-293 31 293 48-290 52",zigzagLeft:"m-21 13 308 48-293 46 293 31-293 48 291 52",zzLeft:"m20 7 50 48-48 46 48 31-48 48 48 52",zzRight:"m237 7-50 48 48 46-48 31 48 48-48 52",sandClock:"M121 123S-30 40 24 24C78 6 168 7 233 24 298 40-40 214 24 227c63 12 159 12 209 0 51-12-112-104-112-104Z",w:"M223-33v238c0 42-61 41-61 0V41c0-44-64-44-64 0v164c0 43-71 33-71 0V-27",wReversed:"M27-33v238c0 42 61 41 61 0V41c0-44 64-44 64 0v164c0 43 71 33 71 0V-27"};const yt=[[{500:[3,400,4,!0,!0,1,0,200,d.sandClock],1e3:[3,400,5,!0,!0,2,0,200,d.sandClock]},{},{1500:["fire",128,.6]},{100:[!1,["CAPTAIN","    ","WE DETECTED SOME ENEMY SCOUTS","BETTER DESTROY THEM"]],1e3:[!1,["TOO LATE!","THEY ARE COMING","WITH A FULL FLEET","    ","GOOD LUCK!"]]},[]],[{1e3:[3,1e3,3,!0,!1,1,0,200,d.zigzag],2e3:[5,1500,6,!1,!1,1,0,130,d.zigzagLeft]},{},{2500:["fire",128,.6],550:["shield",140,.3]},{100:[!1,["TOO LATE!","THEY ARE COMING","WITH A FULL FLEET","    ","GOOD LUCK!"]]},[0,10,50,"M127 120V43c0-77 99 8 99 77 0 70-35 102-99 102S22 181 22 120s32-84 84-84 85 32 85 84c0 53-28 62-64 62-35 0-68-18-68-62 0-43 25-47 47-47 21 0 48 24 48 47 0 24-7 28-27 28s0-14 0-28Z",30,8,9,1,20,150]],[{},{1e3:[13,1e3,[20,200,120,180,60,220,180,40,120,60],[0,-.1,0,-.1,.1,-.1,0,.1,0,.1],[1,.5,.7,.5,.9,.5,1,.8,.4,.7]]},{1500:["fire",128,.6],2500:["shield",140,.3],3500:["fire",128,.6]},{100:[!1,["13 ASTEROIDS DETECTED","      ","OOOPSS...","HOPE THIS DOES NOT TRIGGER","YOUR TRISKAIDEKAPHOBIA...","         "]]},[0,10,100,"M127 120V43c0-77 99 8 99 77 0 70-35 102-99 102S22 181 22 120s32-84 84-84 85 32 85 84c0 53-28 62-64 62-35 0-68-18-68-62 0-43 25-47 47-47 21 0 48 24 48 47 0 24-7 28-27 28s0-14 0-28Z",40,4,9,1,60,50]],[{800:[5,400,9,!0,!1,4,0,400,d.zigzag],810:[5,400,9,!0,!1,4,0,400,d.zigzagLeft],2e3:[5,400,7,!0,!1,4,0,400,d.w],2010:[5,400,7,!0,!1,4,0,400,d.wReversed]},{},{1500:["fire",128,.6]},{100:[!1,["THAT CONDITION STILL","AFFECTING YOUR","VISION, HUH!?","         "]]},[0,10,250,d.sandClock,30,8,8,0,10,50]],[{2500:[14,200,5,!0,!0,1,0,50,d.spiral]},{1e3:[13,1e3,[20,200,120,180,60,220,180,40,120,60],[0,-.1,0,-.1,.1,-.1,0,.1,0,.1],[1,.5,.7,.5,.9,.5,1,.8,.4,.7]]},{1500:["fire",128,.6]},{100:[!1,["HERE COME MORE ASTEROIDS","12 PLUS 1, HEHE!","         ","ALSO 13 SHIPS","        ","OH MAN! NOT AGAIN!"]]},[]],[{500:[10,400,3,!1,!1,2,0,200,d.zzLeft],800:[10,400,4,!1,!1,2,0,200,d.zzRight],1500:[10,400,3,!1,!1,2,0,200,d.zzLeft],1800:[10,400,4,!1,!1,2,0,200,d.zzRight],2500:[5,1e3,6,!1,!1,1,0,40,d.spiral]},{},{1500:["fire",128,.6]},{100:[!1,["HMMM... ZIGZAGERS?","    "]]},[]],[{500:[3,400,4,!0,!1,4,1,100,d.spiral],2e3:[3,1e3,5,!0,!1,4,1,100,d.sandClock]},{500:[30,700,[220,180,40,120,60,20,200,120,180,60],[-.1,0,.1,0,.1,0,-.1,0,-.1,.1],[.5,1,.8,.4,.7,1,.5,.7,.5,.9]]},{1500:["shield",128,.6],500:["fire",64,.3]},{},[0,60,150,d.sandClock,30,16,8,1,100,50]],[{500:[5,1e3,9,!0,!1,1,0,100,d.w],501:[5,1e3,9,!0,!1,1,0,100,d.wReversed],1500:[5,1e3,3,!1,!1,1,0,100,d.zzLeft],1501:[5,1e3,3,!1,!1,1,0,100,d.zzRight]},{},{2500:["fire",128,.6],550:["shield",140,.3]},{100:[!1,["THEY JUST KEEP COMING"]]},[]],[{500:[1,1e3,9,!0,!1,10,0,30,d.spiral]},{},{1500:["fire",128,.6],2500:["shield",140,.3],3500:["fire",128,.6]},{},[0,20,110,d.spiral,100,8,9,1,60,100]],[{1200:[13,400,9,!0,!1,4,0,400,d.zigzag],3500:[20,400,9,!0,!1,1,0,1e3,d.spiral]},{2e3:[30,700,[20,200,120,180,60,220,180,40,120,60],[0,-.1,0,-.1,.1,-.1,0,.1,0,.1],[1,.5,.7,.5,.9,.5,1,.8,.4,.7]]},{1500:["fire",128,.6]},{100:[!1,["HMMM... DETECTING A SHIP","WITH SOME TAG ON IT...","A NUMBER, MAYBE?","YEP, IT IS 13","YIKES! I AM SORRY..."]]},[0,30,150,d.sandClock,30,8,8,0,100,500]],[{2500:[13,200,5,!0,!0,1,0,50,d.spiral]},{10:[60,400,[20,200,120,180,60,220,180,40,120,60],[0,-.1,0,-.1,.1,-.1,0,.1,0,.1],[1,.5,.7,.5,.9,.5,1,.8,.4,.7]]},{1500:["fire",128,.6]},{3e3:[!1,["CONTROL YOURSELF, CAPTAIN!"]]},[]],[{1500:[10,400,3,!1,!1,2,0,200,d.zzLeft],1800:[10,400,4,!1,!1,2,0,200,d.zzRight],2500:[5,1e3,6,!1,!1,1,0,40,d.spiral]},{},{1500:["fire",64,.6],1500:["shield",156,.4]},{100:[!1,["I GOT A FEELING","THIS NEVER ENDS","       ","MAYBE THAT IS WHY","IT IS A GAME.","       ","OH WELL, LETS KEEP GOING.","BUT HARDER THIS TIME. HEHE!"]]},[]]];function _t(t){var t=yt[t],e=Math.max(...Object.keys(t[0]),...Object.keys(t[1]));let i=t[0][e];return e+=(i=i??t[1][e])[1]/1e3*60*i[0]}const vt=yt.length;function gt(t=0,e=0,i=0,n=!1){var s,a=yt[e],r=_t(e);a[0][t]&&z("spawn-enemy",(s=a[0][t])[0],s[1],{sprite:s[2],rotate:s[3],loop:s[4],shield:s[5],fireMode:s[6],fireRate:s[7],path:q(s[8])}),a[1][t]&&z("spawn-asteroid",...a[1][t]),a[2][t]&&z("spawn-powerup",...a[2][t]),a[3][t]&&z("set-dialog",...a[3][t]),0===a[4].length&&r<=t&&0===i&&z("next-level",e+1>=vt?0:e+1),0<a[4].length&&n&&0===i&&z("spawn-boss",...a[4])}function wt(){P(["esc"],()=>{z("change-scene","menu")}),P(["p"],()=>{z("pause")}),J(["enter"]),P(["enter"],()=>i.skip());const a=new tt({x:120,y:248}),e=it(20),i=dt(),n=dt();let s=0,r=0,o=12<r?Math.floor(.25*r):0,h=0,l=!0,c=!1,p=_t(s),f=!1,d;const u=G({create:W,maxSize:400}),m=G({create:F,maxSize:40}),y=G({create:F,maxSize:80}),_=G({create:F,maxSize:400}),v=G({create:st,maxSize:10}),g=G({create:lt,maxSize:50}),w=G({create:pt,maxSize:4}),x=G({create:mt,maxSize:4}),b=D({text:"SCORE 00000",x:8,y:8});var t=D({text:"HI "+(localStorage.getItem("hiScore")||0),x:128,y:8,color:"gray",align:"center"});const C=D({x:224,y:8,text:"@@@",color:"red"});var A=D({x:128,y:120,text:"LEVEL 1",align:"center",color:"lightgreen",ttl:0});const S=D({x:248,y:224,text:"FIRE PODS :00",align:"right",color:"gray",ttl:0});var M=F({x:192,y:8,width:24,height:8,anchor:{x:0,y:0},draw(){var t=this["context"],e=0<=a.shield?a.shield/5:0;t.strokeStyle="white",t.lineWidth=2,t.strokeRect(0,0,this.width,this.height),t.fillStyle="green",a.shield<25&&(t.fillStyle="red"),t.fillRect(2,2,e,this.height-4)}});const E=F({x:0,y:0,active:!1,radius:484,update(){},update(){this.active&&60<this.radius&&(this.radius-=2),!this.active&&this.radius<484&&(this.radius+=1),this.advance()},draw(){var t=this["context"];t.save(),t.beginPath(),t.strokeStyle="white",t.lineWidth=3,t.arc(a.x,a.y,this.radius,0,2*Math.PI,!0),t.clip(),t.stroke()},start(){U(Z.transition),this.radius=484,this.active=!0},end(){U(Z.transition),this.active=!1},render(){this.draw()}});var H=F({x:0,y:0,update(){},draw(){var t=this["context"];t.restore()},render(){this.draw()}});N("hit",()=>{U(Z.hit)}),N("explosion",(e,i,n,s,a,t=!1)=>{t=t?"bigExplosion":"explosion";U(Z[t]);for(let t=0;t<n;t++)t%2==0&&u.get({x:e,y:i,dx:k(-1,1)/2,dy:k(-1,1)/2,color:null,ttl:30}),u.get({x:e,y:i,dx:k(-s/2,s/2),dy:k(-s/2,s/2),color:a,ttl:30*s})}),N("ship-fire",(t,e,i)=>{U(Z.shoot),m.get({name:"ship-bullet",x:t,y:e,width:2,height:4,dy:-4,dx:i,color:null,sprite:16,ttl:100,update(){this.advance(),this.y<0&&(this.ttl=0)}})}),N("ship-fire-laser",(t,e,i,n=.4)=>{var s=Z.laser;s[0]=n,U(s),y.get({name:"ship-bullet",x:t,y:e,width:2,height:18,dy:-10,dx:i,rotation:i/10,color:null,ttl:100,update(){this.advance(),this.y<0&&(this.ttl=0)},draw(){var t=this["context"];t.fillStyle="#0cc",t.fillRect(-1,-1,this.width+2,this.height),t.fillStyle="#0ff",t.fillRect(0,0,this.width,this.height),t.fillStyle="#fff",t.fillRect(1,1,this.width/2,this.height)}})}),N("ship-die",()=>{z("spawn-powerup","fire",128,.6)}),N("enemy-fire",(t,e)=>{U(Z.shoot);var i=a.x-4-t,n=a.y-4-e,s=+Math.hypot(i,n);_.get({name:"enemy-bullet",x:t+4,y:e+4,dx:i/s,dy:n/s,width:3,height:3,color:"red",ttl:300,draw(){var t=this["context"];t.fillStyle=this.color,t.fillRect(0,0,this.width,this.height),t.fillStyle="white",t.fillRect(1,1,1,1)}})}),N("boss-fire",(e,i)=>{U(Z.shoot2);for(let t=0;t<12;t++){var n=+Math.cos(R(30*t)),s=+Math.sin(R(30*t));_.get({name:"enemy-bullet",x:e,y:i,dx:n,dy:s,width:3,height:3,color:"red",ttl:400})}}),N("score",t=>{a.score+=Math.floor(t+2*o)}),N("spawn-boss",(t,e,i,n,s,a,r,o,h,l)=>{c=!1,z("spawn-enemy",a,0,{sprite:r,shield:2,fireRate:l,fireMode:o,parent:w.get({sprite:t,shield:e,fireRate:i,rotate:!1,loop:!0,imune:!0,debryColor:"pink",childrenSpeed:h,childrenRadius:s,path:q(n)}),path:null})}),N("spawn-enemy",(e,i,n)=>{13===e&&(E.start(),T(()=>E.end(),15e3)),e+=o;for(let t=0;t<e;t++){var s=t*(360/e);const a=V(1,2,n.sprite/4);T(t=>{g.get({...n,speed:a,anglePlacement:R(t),shield:n.shield+o})},t*i,s)}}),N("spawn-asteroid",(e,i,n,s,a)=>{13===e&&(E.start(),T(()=>E.end(),15e3));let r=0;for(let t=0;t<e;t++)r>n.length-1&&(r=0),T((t,e)=>{v.get({x:n[e],y:-8,dx:s[e],dy:a[e],shield:10+o})},t*i,t,r),r++}),N("spawn-powerup",(t,e,i)=>{"shield"===t&&f||x.get({type:t,x:e,y:-8,dy:i})}),N("set-dialog",(t,e)=>{t?n.start({texts:e,pauseOnTalk:!0}):i.start({texts:e,pauseOnTalk:!1})}),N("next-level",t=>{c=!1,s=t,r++,h=0,l=!1,p=_t(t),o=12<r?Math.floor(.25*r):0,z("score",100),12===r&&z("level-13"),25===r&&z("level-26")}),N("boss-die",()=>{z("score",200),z("next-level",s=++s>=vt?0:s)}),N("game-over",()=>{var t=localStorage.getItem("hiScore")||0;a.score>t&&localStorage.setItem("hiScore",a.score),z("change-scene","game-over",{score:a.score,previous:t})}),N("start-fire-timer",()=>{d=performance.now()+3e4,S.ttl=1/0}),N("end-fire-timer",()=>{d=null,S.ttl=0}),N("level-13",()=>{z("set-dialog",!0,["LETS MAKE THIS","INSTERESTING.","NOW WITH ONE LIFE ONLY"]),a.lives=1,a.shield=100}),N("level-26",()=>{z("set-dialog",!0,["HEY! YOU ARE GOOD AT THIS!","NOW ONE HIT AND YOU DIE!","AND NO SHIELD POWERUPS."]),a.lives=1,a.shield=10,f=!0});const O=ot(),I=ot(),L=ot();return j({children:[E,e,m,y,_,a,g,w,v,x,u,H,i,n,M,A,b,t,C,S],gameOver:!1,update(){var t;this.paused=!1,n.isTalking&&n.pauseOnTalk?(n.update(),this.paused=!0):(S.text="PODS "+(d?Math.floor((d-performance.now())/1e3):"00"),t=g.size+v.size,h===p&&(c=!0),gt(h,s,t,c),a.lives<=0&&!this.gameOver?(this.gameOver=!0,T(()=>z("game-over"),1e3)):(m.getAliveObjects().forEach(t=>{O.clear(),O.add(t,v.getAliveObjects(),g.getAliveObjects(),w.getAliveObjects()),B(t,O.get(t))}),y.getAliveObjects().forEach(t=>{O.clear(),O.add(t,v.getAliveObjects(),g.getAliveObjects(),w.getAliveObjects()),B(t,O.get(t))}),I.clear(),I.add(a,v.getAliveObjects(),g.getAliveObjects(),_.getAliveObjects(),w.getAliveObjects(),x.getAliveObjects()),B(a,I.get(a)),L.clear(),L.add(v.getAliveObjects()),v.getAliveObjects().forEach(t=>{B(t,L.get(t))}),b.text="SCORE "+a.score,C.text="@@@".slice(0,a.lives),l&&40<h&&h<140&&h%20==0&&e.decreaseVel(2),l&&0===h&&U(Z.engineSlowdown),h++))}})}var xt=(i,n,s,t=125)=>{let a,r,o,h,l,c,p,f,d,u,m,y,_,v,g=0,w=[],x=[],b=[],C=0,A=0,S=1,M={},E=Y/t*60>>2;for(;S;C++)w=[S=f=y=0],s.map((t,e)=>{for(p=n[t][C]||[0,0,0],S|=!!n[t][C],v=y+(n[t][0].length-2-!f)*E,_=e==s.length-1,r=2,h=y;r<p.length+_;f=++r){for(l=p[r],d=r==p.length+_-1&&_||u!=(p[0]||0)|l|0,o=0;o<E&&f;o++>E-99&&d&&(m+=(m<1)/99))c=(1-m)*w[g++]/2||0,x[h]=(x[h]||0)-c*A+c,b[h]=(b[h++]||0)+c*A+c;l&&(m=l%1,A=p[1]||0,l|=0)&&(w=M[[u=p[g=0]||0,l]]=M[[u,l]]||((a=[...i[u]])[2]*=2**((l-12)/12),0<l?H(...a):[]))}y=v});return[x,b]},bt=[[[,0,77,,,.7,2,.41,,,,,,,,.06],[,0,43,.01,,.3,2,,,,,,,,,.02,.01],[,0,170,.003,,.008,,.97,-35,53,,,,,,.1],[.8,0,270,,,.12,3,1.65,-2,,,,,4.5,,.02],[,0,86,,,,,.7,,,,.5,,6.7,1,.05],[,0,41,,.05,.4,2,0,,,9,.01,,,,.08,.02],[,0,2200,,,.04,3,2,,,800,.02,,4.8,,.01,.1],[.3,0,16,,,.3,3]],[[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,24,,,,,,,,,,,,,,,,,,,,,,,,22,,22,,22,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,24,,,,,,,,27,,,,,,,,,,,,,,,,27,,,,24,,,,24,,,,,,,,27,,,,,,,,,,,,,,,,24,,24,,24,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[6,1,,,34,34,34,,,,,,34,34,,,,,34,,,,34,34,,,,,34,,,,34,,,,34,34,34,,,,,,34,,,,,,34,34,,,34,34,,,,,,,,,34,34],[4,1,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,23,23,35,23,23,36,23,23,35,23,23,36,23,23,35,35,23,23,35,23,23,35,23,23,36,23,23,35,23,23,36,36],[5,-1,21,,,19,,,21,,,,,,,,,,21,,,19,,,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,1,24,,,24,,,24,,,,,,,,,,24,,,24,,,24,,,,24.75,24.5,24.26,24.01,24.01,24.01,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[4,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,24.75,24.5,24.26,24.01,24.01,24.01,24.01,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,23,,21,23,,35,,23,,21,23,,35,,35,,23,,21,23,,35,,21,23,,35,,21,23,,,],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,36,34,,33,34,34,36,31,36,34,,31,34,32,,33,36,34,,31,34,34,36,33,36,33,,31,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,21,,19,21,,33,,21,,19,21,,33,,33,,21,,19,21,,33,,21,,19,21,,33,,33,,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29],[2,1,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,],[6,1,,,36,,,,,,36,,36,,,,,,,,36,,,,,,36,,36,,,,,,,,36,,,,,,,,,,,,,,,,36,,,,,,36,,36,,,,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,25,,,25,,,,,,,,25,,,,,,,,25,25,25,25]],[[1,-1,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,19,19,31,19,19,31,19,19,31,19,19,31,19,19,31,31],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,36,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,19,,19,19,31,19,19,31,19,,19,19,31,19,19,31],[2,1,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,,,,,,34,,34,,,,,,,,34,,,,,,34,,34,,,,,,]]],[0,1,1,2,3,4,4]],Ct=[,,45,.03,.21,.6,4,.9,2,-3,,,,.2,,.9,,.45,.26],At=[.9,,413,,.05,.01,1,3.8,-3,-13.4,,,,,,,.11,.65,.07,,237],St=[1.5,,261,.01,.02,.08,1,1.5,-.5,,,-.5,,,,,.9,.05],Mt=[1.6,,291,.01,.21,.35,,2.2,,,-136,.09,.03,,,.2,.2,.7,.28],Et=[,,468,.05,.62,.7,,.3,,,300,.05,.02,,,,.32,,.6],Ht=[.8,,112,.03,.1,.2,3,3.6,18,-9,,,,,,,.03,.83,.12],Ot=[2.3,,330,,.06,.17,2,3.7,,,,,.05,.4,2,.5,.13,.89,.05,.17],It=[,,73,.02,.06,.96,4,.1,5.6,-7.4,,,.37,2.6,,.3,.3,.8,.16],Lt=[,,250,.13,.25,.83,1,.7,,-.3,,,,,17,,,,.02,,23];var Rt={palette:[[124,124,124],[0,0,252],[0,0,188],[68,40,188],[148,0,132],[168,0,32],[168,16,0],[136,20,0],[80,48,0],[0,120,0],[0,104,0],[0,88,0],[0,64,88],[0,0,0],[188,188,188],[0,120,248],[0,88,248],[104,68,252],[216,0,204],[228,0,88],[248,56,0],[228,92,16],[172,124,0],[0,184,0],[0,168,0],[0,168,68],[0,136,136],[248,248,248],[60,188,252],[104,136,252],[152,120,248],[248,120,248],[248,88,152],[248,120,88],[252,160,68],[248,184,0],[88,216,84],[88,248,152],[0,232,216],[120,120,120],[252,252,252],[164,228,252],[184,184,248],[216,184,248],[248,184,248],[248,164,192],[240,208,176],[252,224,168],[248,216,120],[216,248,120],[184,248,184],[184,248,216],[0,252,252],[216,216,216]],step:1,errorDiffusionDither:function(t,i,e){var n=new Uint8ClampedArray(t.data),s=new Uint8ClampedArray(t.data),a=this.step,r=1/16;new Array([1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]);for(var o=0;o<e;o+=a)for(var h=0;h<i;h+=a)for(var l=4*h+4*o*i,c=function(t,e){return 4*t+4*e*i},p=l,f=1+l,d=2+l,u=new Array(n[p],n[f],n[d]),u=this.approximateColor(u),m=[],y=(m[p]=n[p]-u[0],m[f]=n[f]-u[1],m[d]=n[d]-u[2],n[c(h+a,o)]=n[c(h+a,o)]+7*r*m[p],n[c(h-a,o+1)]=n[c(h-1,o+a)]+3*r*m[p],n[c(h,o+a)]=n[c(h,o+a)]+5*r*m[p],n[c(h+a,o+a)]=n[c(h+1,o+a)]+r*m[p],n[c(h+a,o)+1]=n[c(h+a,o)+1]+7*r*m[f],n[c(h-a,o+a)+1]=n[c(h-a,o+a)+1]+3*r*m[f],n[c(h,o+a)+1]=n[c(h,o+a)+1]+5*r*m[f],n[c(h+a,o+a)+1]=n[c(h+a,o+a)+1]+r*m[f],n[c(h+a,o)+2]=n[c(h+a,o)+2]+7*r*m[d],n[c(h-a,o+a)+2]=n[c(h-a,o+a)+2]+3*r*m[d],n[c(h,o+a)+2]=n[c(h,o+a)+2]+5*r*m[d],n[c(h+a,o+a)+2]=n[c(h+a,o+a)+2]+r*m[d],u[0]),_=u[1],v=u[2],g=0;g<a;g++)for(var w=0;w<a;w++){var x=l+4*g+4*i*w;s[x]=y,s[1+x]=_,s[2+x]=v}return s},dither:function(t,e,i){for(var n=new Uint8ClampedArray(t.data),s=new Array([1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]),a=0;a<i;a+=1)for(var r=0;r<e;r+=1)for(var o=4*r+4*a*e,h=o,l=1+o,c=2+o,h=(n[h]+=2*s[r%4][a%4],n[l]+=2*s[r%4][a%4],n[c]+=2*s[r%4][a%4],new Array(n[h],n[l],n[c])),l=this.approximateColor(h),p=l[0],f=l[1],d=l[2],u=0;u<1;u++)for(var m=0;m<1;m++){var y=o+4*u+4*e*m;n[y]=p,n[1+y]=f,n[2+y]=d}return n},approximateColor:function(t){function a(t,e,i,n){var s;return 2==i.length?t(e,n)<=t(e,i[1])?n:i[1]:(s=i.slice(1),t(e,n)<=t(e,i[1])||(n=i[1]),a(t,e,s,n))}var e=this.palette;return a(this.colorDistance,t,e,e[0])},colorDistance:function(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}};class Vt{constructor(t){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.imageSmoothingEnabled=!1,this.image=new Image,Object.assign(this,t)}async generate(t,e){this.canvas.width=t,this.canvas.height=e,this.draw&&await this.draw(this.ctx);var i=this.ctx.getImageData(0,0,t,e),i=new ImageData(Rt.dither(i,t,e),t,e);return this.ctx.putImageData(i,0,0),this.image.src=this.canvas.toDataURL(),new Promise(t=>{this.image.onload=()=>t(this.image)})}}function u(t){return new Vt(t)}var m=async(e="white")=>{const n=new Image,s=(n.src="font.png",{white:["rgb(255, 255, 255)","rgb(255, 255, 255)","rgb(63, 63, 63)"],yellow:["rgb(255, 255, 255)","rgb(255, 255, 127)","rgb(255, 255, 127)","rgb(127, 127, 63)"],red:["rgb(255, 0, 0)","rgb(255, 0, 0)","rgb(63, 0, 0)"],green:["rgb(0, 127, 0)","rgb(0, 127, 0)","rgb(0, 63, 0)"],lightgreen:["rgb(0, 255, 63)","rgb(0, 255, 63)","rgb(0, 63, 31)"],gray:["rgb(127, 127, 127)","rgb(127, 127, 127)","rgb(63, 63, 63)"],lightblue:["rgb(0, 254, 254)","rgb(0, 127, 127)","rgb(0, 63, 63)"]});return new Promise(t=>{n.onload=()=>{t(u({async draw(i){i.drawImage(n,0,0),i.save(),i.globalCompositeOperation="source-in";var t=i.createLinearGradient(0,0,0,8),t=(t.addColorStop(0,s[e][0]),t.addColorStop(.5,s[e][1]),t.addColorStop(1,s[e][2]),i.fillStyle=t,i.fillRect(0,0,378,9),i.getImageData(0,0,378,9)),t=await createImageBitmap(t);i.globalCompositeOperation="source-over",i.clearRect(0,0,378,9);for(let e=-1;e<2;e++)for(let t=-1;t<2;t++)i.drawImage(n,e,t);i.drawImage(t,0,0)}}))}})};function y(){var t,e;for(this.clearsong(),this.initialize(),this.playing=!1,this.paused=!1,this.repeat=!1,this.filter=!1,this.syncqueue=[],this.samplerate=44100,this.ramplen=64,this.mixval=8,this.periodtable=new Float32Array([907,900,894,887,881,875,868,862,856,850,844,838,832,826,820,814,808,802,796,791,785,779,774,768,762,757,752,746,741,736,730,725,720,715,709,704,699,694,689,684,678,675,670,665,660,655,651,646,640,636,632,628,623,619,614,610,604,601,597,592,588,584,580,575,570,567,563,559,555,551,547,543,538,535,532,528,524,520,516,513,508,505,502,498,494,491,487,484,480,477,474,470,467,463,460,457,453,450,447,445,442,439,436,433,428]),this.pan=new Float32Array(32),this.finalpan=new Float32Array(32),t=0;t<32;t++)this.pan[t]=this.finalpan[t]=.5;for(this.vibratotable=new Array,e=0;e<4;e++)for(this.vibratotable[e]=new Float32Array(64),t=0;t<64;t++)switch(e){case 0:this.vibratotable[e][t]=127*Math.sin(2*Math.PI*(t/64));break;case 1:this.vibratotable[e][t]=127-4*t;break;case 2:this.vibratotable[e][t]=t<32?127:-127;break;case 3:this.vibratotable[e][t]=127*(1-2*Math.random())}this.voleffects_t0=new Array(this.effect_vol_t0_f0,this.effect_vol_t0_60,this.effect_vol_t0_70,this.effect_vol_t0_80,this.effect_vol_t0_90,this.effect_vol_t0_a0,this.effect_vol_t0_b0,this.effect_vol_t0_c0,this.effect_vol_t0_d0,this.effect_vol_t0_e0),this.voleffects_t1=new Array(this.effect_vol_t1_f0,this.effect_vol_t1_60,this.effect_vol_t1_70,this.effect_vol_t1_80,this.effect_vol_t1_90,this.effect_vol_t1_a0,this.effect_vol_t1_b0,this.effect_vol_t1_c0,this.effect_vol_t1_d0,this.effect_vol_t1_e0),this.effects_t0=new Array(this.effect_t0_0,this.effect_t0_1,this.effect_t0_2,this.effect_t0_3,this.effect_t0_4,this.effect_t0_5,this.effect_t0_6,this.effect_t0_7,this.effect_t0_8,this.effect_t0_9,this.effect_t0_a,this.effect_t0_b,this.effect_t0_c,this.effect_t0_d,this.effect_t0_e,this.effect_t0_f,this.effect_t0_g,this.effect_t0_h,this.effect_t0_i,this.effect_t0_j,this.effect_t0_k,this.effect_t0_l,this.effect_t0_m,this.effect_t0_n,this.effect_t0_o,this.effect_t0_p,this.effect_t0_q,this.effect_t0_r,this.effect_t0_s,this.effect_t0_t,this.effect_t0_u,this.effect_t0_v,this.effect_t0_w,this.effect_t0_x,this.effect_t0_y,this.effect_t0_z),this.effects_t0_e=new Array(this.effect_t0_e0,this.effect_t0_e1,this.effect_t0_e2,this.effect_t0_e3,this.effect_t0_e4,this.effect_t0_e5,this.effect_t0_e6,this.effect_t0_e7,this.effect_t0_e8,this.effect_t0_e9,this.effect_t0_ea,this.effect_t0_eb,this.effect_t0_ec,this.effect_t0_ed,this.effect_t0_ee,this.effect_t0_ef),this.effects_t1=new Array(this.effect_t1_0,this.effect_t1_1,this.effect_t1_2,this.effect_t1_3,this.effect_t1_4,this.effect_t1_5,this.effect_t1_6,this.effect_t1_7,this.effect_t1_8,this.effect_t1_9,this.effect_t1_a,this.effect_t1_b,this.effect_t1_c,this.effect_t1_d,this.effect_t1_e,this.effect_t1_f,this.effect_t1_g,this.effect_t1_h,this.effect_t1_i,this.effect_t1_j,this.effect_t1_k,this.effect_t1_l,this.effect_t1_m,this.effect_t1_n,this.effect_t1_o,this.effect_t1_p,this.effect_t1_q,this.effect_t1_r,this.effect_t1_s,this.effect_t1_t,this.effect_t1_u,this.effect_t1_v,this.effect_t1_w,this.effect_t1_x,this.effect_t1_y,this.effect_t1_z),this.effects_t1_e=new Array(this.effect_t1_e0,this.effect_t1_e1,this.effect_t1_e2,this.effect_t1_e3,this.effect_t1_e4,this.effect_t1_e5,this.effect_t1_e6,this.effect_t1_e7,this.effect_t1_e8,this.effect_t1_e9,this.effect_t1_ea,this.effect_t1_eb,this.effect_t1_ec,this.effect_t1_ed,this.effect_t1_ee,this.effect_t1_ef)}function _(){this.supportedformats=new Array("mod","s3m","xm"),this.url="",this.format="s3m",this.state="initializing..",this.request=null,this.loading=!1,this.playing=!1,this.paused=!1,this.repeat=!1,this.separation=1,this.mixval=8,this.amiga500=!1,this.filter=!1,this.endofsong=!1,this.autostart=!1,this.bufferstodelay=4,this.delayfirst=0,this.delayload=0,this.onReady=function(){},this.onPlay=function(){},this.onStop=function(){},this.buffer=0,this.mixerNode=0,this.context=null,this.samplerate=44100,this.bufferlen=4096,this.chvu=new Float32Array(32),this.player=null,this.title="",this.signature="....",this.songlen=0,this.channels=0,this.patterns=0,this.samplenames=new Array}y.prototype.clearsong=function(){var t;for(this.title="",this.signature="",this.trackerversion=260,this.songlen=1,this.repeatpos=0,this.channels=0,this.patterns=0,this.instruments=32,this.amigaperiods=0,this.initSpeed=6,this.initBPM=125,this.patterntable=new ArrayBuffer(256),t=0;t<256;t++)this.patterntable[t]=0;for(this.pattern=new Array,this.instrument=new Array(this.instruments),t=0;t<32;t++)this.instrument[t]=new Object,this.instrument[t].name="",this.instrument[t].samples=new Array;this.chvu=new Float32Array(2)},y.prototype.initialize=function(){for(this.syncqueue=[],this.tick=-1,this.position=0,this.row=0,this.flags=0,this.volume=64,this.initSpeed&&(this.speed=this.initSpeed),this.initBPM&&(this.bpm=this.initBPM),this.stt=0,this.breakrow=0,this.patternjump=0,this.patterndelay=0,this.patternwait=0,this.endofsong=!1,this.looprow=0,this.loopstart=0,this.loopcount=0,this.globalvolslide=0,this.channel=new Array,i=0;i<this.channels;i++)this.channel[i]=new Object,this.channel[i].instrument=0,this.channel[i].sampleindex=0,this.channel[i].note=36,this.channel[i].command=0,this.channel[i].data=0,this.channel[i].samplepos=0,this.channel[i].samplespeed=0,this.channel[i].flags=0,this.channel[i].noteon=0,this.channel[i].volslide=0,this.channel[i].slidespeed=0,this.channel[i].slideto=0,this.channel[i].slidetospeed=0,this.channel[i].arpeggio=0,this.channel[i].period=640,this.channel[i].frequency=8363,this.channel[i].volume=64,this.channel[i].voiceperiod=0,this.channel[i].voicevolume=0,this.channel[i].finalvolume=0,this.channel[i].semitone=12,this.channel[i].vibratospeed=0,this.channel[i].vibratodepth=0,this.channel[i].vibratopos=0,this.channel[i].vibratowave=0,this.channel[i].volramp=1,this.channel[i].volrampfrom=0,this.channel[i].volenvpos=0,this.channel[i].panenvpos=0,this.channel[i].fadeoutpos=0,this.channel[i].playdir=1,this.channel[i].volramp=0,this.channel[i].volrampfrom=0,this.channel[i].trigramp=0,this.channel[i].trigrampfrom=0,this.channel[i].currentsample=0,this.channel[i].lastsample=0,this.channel[i].oldfinalvolume=0},y.prototype.parse=function(t){var e,i,n,s,a;if(!t)return!1;for(p=0;p<17;p++)this.signature+=String.fromCharCode(t[p]);if("Extended Module: "!=this.signature)return!1;if(26!=t[37])return!1;if(this.signature="X.M.",this.trackerversion=v(t,58),this.trackerversion<260)return!1;for(p=0;t[p]&&p<20;)this.title+=w(t[17+p++]);a=g(t,n=60),this.songlen=v(t,n+4),this.repeatpos=v(t,n+6),this.channels=v(t,n+8),this.patterns=v(t,n+10),this.instruments=v(t,n+12),this.amigaperiods=1&!v(t,n+14),this.initSpeed=v(t,n+16),this.initBPM=v(t,n+18);for(var r,o,h,l,c=0,p=0;p<256;p++)this.patterntable[p]=t[n+20+p],this.patterntable[p]>c&&(c=this.patterntable[p]);for(c++,this.pattern=new Array(c),this.patternlen=new Array(c),p=0;p<c;p++)for(this.patternlen[p]=64,this.pattern[p]=new Uint8Array(this.channels*this.patternlen[p]*5),row=0;row<this.patternlen[p];row++)for(ch=0;ch<this.channels;ch++)this.pattern[p][row*this.channels*5+5*ch]=255,this.pattern[p][row*this.channels*5+5*ch+1]=0,this.pattern[p][row*this.channels*5+5*ch+2]=255,this.pattern[p][row*this.channels*5+5*ch+3]=255,this.pattern[p][row*this.channels*5+5*ch+4]=0;for(n+=a,p=0;p<this.patterns;){for(this.patternlen[p]=v(t,n+5),this.pattern[p]=new Uint8Array(this.channels*this.patternlen[p]*5),e=0;e<this.patternlen[p]*this.channels;e++)this.pattern[p][5*e+0]=0,this.pattern[p][5*e+1]=0,this.pattern[p][5*e+2]=0,this.pattern[p][5*e+3]=0,this.pattern[p][5*e+4]=0;for(s=v(t,n+7),n+=g(t,n),e=d=0;d<s;)128&(i=t[n+d++])?(1&i&&(this.pattern[p][e+0]=t[n+d++]),2&i&&(this.pattern[p][e+1]=t[n+d++]),4&i&&(this.pattern[p][e+2]=t[n+d++]),8&i&&(this.pattern[p][e+3]=t[n+d++]),16&i&&(this.pattern[p][e+4]=t[n+d++])):(this.pattern[p][e+0]=i,this.pattern[p][e+1]=t[n+d++],this.pattern[p][e+2]=t[n+d++],this.pattern[p][e+3]=t[n+d++],this.pattern[p][e+4]=t[n+d++]),e+=5;for(e=0;e<this.patternlen[p]*this.channels*5;e+=5)97<=this.pattern[p][e+0]?this.pattern[p][e+0]=254:0==this.pattern[p][e+0]?this.pattern[p][e+0]=255:this.pattern[p][e+0]--,0==this.pattern[p][e+3]&&0==this.pattern[p][e+4]&&(this.pattern[p][e+3]=255),this.pattern[p][e+2]<16?this.pattern[p][e+2]=255:16<=this.pattern[p][e+2]&&this.pattern[p][e+2]<=80?this.pattern[p][e+2]-=16:240<=this.pattern[p][e+2]&&(this.pattern[p][e+2]-=160);n+=d,p++}for(this.patterns=c,this.instrument=new Array(this.instruments),p=0;p<this.instruments;){for(a=g(t,n),this.instrument[p]=new Object,this.instrument[p].sample=new Array,this.instrument[p].name="",d=0;t[n+4+d]&&d<22;)this.instrument[p].name+=w(t[n+4+d++]);for(this.instrument[p].samples=v(t,n+27),this.instrument[p].samplemap=new Uint8Array(96),d=0;d<96;d++)this.instrument[p].samplemap[d]=0;for(this.instrument[p].volenv=new Float32Array(325),this.instrument[p].panenv=new Float32Array(325),this.instrument[p].voltype=0,d=this.instrument[p].pantype=0;d<=this.instrument[p].samples;d++)this.instrument[p].sample[d]={bits:8,stereo:0,bps:1,length:0,loopstart:0,looplength:0,loopend:0,looptype:0,volume:64,finetune:0,relativenote:0,panning:128,name:"",data:new Float32Array(0)};if(this.instrument[p].samples){for(var f=g(t,n+29),d=0;d<96;d++)this.instrument[p].samplemap[d]=t[n+33+d];var u,m,y=new Array(12),_=new Array(12);for(d=0;d<12;d++)y[d]=new Uint16Array([v(t,n+129+4*d),v(t,n+129+4*d+2)]),_[d]=new Uint16Array([v(t,n+177+4*d),v(t,n+177+4*d+2)]);for(this.instrument[p].voltype=t[n+233],this.instrument[p].pantype=t[n+234],d=0;d<325;d++)this.instrument[p].volenv[d]=1;if(1&this.instrument[p].voltype){for(d=0;d<325;d++){for(u=1;y[u][0]<d&&u<11;)u++;m=y[u][0]==y[u-1][0]?0:(y[u][1]-y[u-1][1])/(y[u][0]-y[u-1][0]),this.instrument[p].volenv[d]=(y[u-1][1]+m*(d-y[u-1][0]))/64}this.instrument[p].volenvlen=y[Math.max(0,t[n+225]-1)][0],this.instrument[p].volsustain=y[t[n+227]][0],this.instrument[p].volloopstart=y[t[n+228]][0],this.instrument[p].volloopend=y[t[n+229]][0]}for(d=0;d<325;d++)this.instrument[p].panenv[d]=.5;if(1&this.instrument[p].pantype){for(d=0;d<325;d++){for(u=1;_[u][0]<d&&u<11;)u++;m=_[u][0]==_[u-1][0]?0:(_[u][1]-_[u-1][1])/(_[u][0]-_[u-1][0]),this.instrument[p].panenv[d]=(_[u-1][1]+m*(d-_[u-1][0]))/64}this.instrument[p].panenvlen=_[Math.max(0,t[n+226]-1)][0],this.instrument[p].pansustain=_[t[n+230]][0],this.instrument[p].panloopstart=_[t[n+231]][0],this.instrument[p].panloopend=_[t[n+232]][0]}for(this.instrument[p].vibratotype=t[n+235],this.instrument[p].vibratosweep=t[n+236],this.instrument[p].vibratodepth=t[n+237],this.instrument[p].vibratorate=t[n+238],this.instrument[p].volfadeout=v(t,n+239),n+=a,this.instrument[p].sample=new Array(this.instrument[p].samples),d=0;d<this.instrument[p].samples;d++){for(s=g(t,n+0),this.instrument[p].sample[d]=new Object,this.instrument[p].sample[d].bits=16&t[n+14]?16:8,this.instrument[p].sample[d].stereo=0,this.instrument[p].sample[d].bps=16==this.instrument[p].sample[d].bits?2:1,this.instrument[p].sample[d].length=s/this.instrument[p].sample[d].bps,this.instrument[p].sample[d].loopstart=g(t,n+4)/this.instrument[p].sample[d].bps,this.instrument[p].sample[d].looplength=g(t,n+8)/this.instrument[p].sample[d].bps,this.instrument[p].sample[d].loopend=this.instrument[p].sample[d].loopstart+this.instrument[p].sample[d].looplength,this.instrument[p].sample[d].looptype=3&t[n+14],this.instrument[p].sample[d].volume=t[n+12],t[n+13]<128?this.instrument[p].sample[d].finetune=t[n+13]:this.instrument[p].sample[d].finetune=t[n+13]-256,t[n+16]<128?this.instrument[p].sample[d].relativenote=t[n+16]:this.instrument[p].sample[d].relativenote=t[n+16]-256,this.instrument[p].sample[d].panning=t[n+15],e=0,this.instrument[p].sample[d].name="";t[n+18+e]&&e<22;)this.instrument[p].sample[d].name+=w(t[n+18+e++]);n+=f}for(d=0;d<this.instrument[p].samples;d++){if(this.instrument[p].sample[d].data=new Float32Array(this.instrument[p].sample[d].length),i=0,16==this.instrument[p].sample[d].bits)for(e=0;e<this.instrument[p].sample[d].length;e++)(i+=v(h=t,l=n+2*e)<32768?v(h,l):v(h,l)-65536)<-32768&&(i+=65536),32767<i&&(i-=65536),this.instrument[p].sample[d].data[e]=i/32768;else for(e=0;e<this.instrument[p].sample[d].length;e++)(i+=(r=t)[o=n+e]<128?r[o]:r[o]-256)<-128&&(i+=256),127<i&&(i-=256),this.instrument[p].sample[d].data[e]=i/128;n+=this.instrument[p].sample[d].length*this.instrument[p].sample[d].bps}}else n+=a;p++}for(this.mixval=4-this.channels/32*2,this.chvu=new Float32Array(this.channels),p=0;p<this.channels;p++)this.chvu[p]=0;return!0},y.prototype.calcperiod=function(t,e,i){var n,s;return t.amigaperiods?(s=Math.floor(i/16),n=t.periodtable[8+e%12*8+s],t=t.periodtable[8+e%12*8+s+1],((1-(s=i/16-s))*n+s*t)*(16/Math.pow(2,Math.floor(e/12)-1))):7680-64*e-i/2},y.prototype.advance=function(t){t.stt=Math.floor(125/t.bpm*.02*t.samplerate),t.tick++,t.flags|=1,t.tick>=t.speed&&(t.patterndelay?t.tick<(t.patternwait+1)*t.speed?t.patternwait++:(t.row++,t.tick=0,t.flags|=2,t.patterndelay=0):112&t.flags?(64&t.flags?(t.row=t.looprow,t.flags&=161,t.flags|=2):16&t.flags&&(t.position=t.patternjump,t.row=t.breakrow,t.patternjump=0,t.breakrow=0,t.flags&=225,t.flags|=2),t.tick=0):(t.row++,t.tick=0,t.flags|=2)),t.row>=t.patternlen[t.patterntable[t.position]]&&(t.position++,t.row=0,t.flags|=4),t.position>=t.songlen&&(t.repeat?t.position=0:this.endofsong=!0)},y.prototype.process_note=function(t,e,i){var n,s,a=5*t.row*t.channels+5*i,r=t.pattern[e][a],o=t.pattern[e][1+a];o&&o<=t.instrument.length&&(t.channel[i].instrument=o-1,t.instrument[o-1].samples&&(n=t.instrument[o-1].samplemap[t.channel[i].note],t.channel[i].sampleindex=n,t.channel[i].volume=t.instrument[o-1].sample[n].volume,t.channel[i].playdir=1,t.pan[i]=t.instrument[o-1].sample[n].panning/255),t.channel[i].voicevolume=t.channel[i].volume),o=t.channel[i].instrument,r<254?(n=t.instrument[o].samplemap[r],t.channel[i].sampleindex=n,s=r+t.instrument[o].sample[n].relativenote,s=t.calcperiod(t,s,t.instrument[o].sample[n].finetune),t.channel[i].noteon?3!=t.channel[i].command&&5!=t.channel[i].command&&(t.channel[i].note=r,t.channel[i].period=s,t.channel[i].voiceperiod=t.channel[i].period,t.channel[i].flags|=3,t.channel[i].trigramp=0,t.channel[i].trigrampfrom=t.channel[i].currentsample,t.channel[i].samplepos=0,t.channel[i].playdir=1,3<t.channel[i].vibratowave&&(t.channel[i].vibratopos=0),t.channel[i].noteon=1,t.channel[i].fadeoutpos=65535,t.channel[i].volenvpos=0,t.channel[i].panenvpos=0):(t.pattern[e][1+a]&&(t.channel[i].samplepos=0,t.channel[i].playdir=1,3<t.channel[i].vibratowave&&(t.channel[i].vibratopos=0),t.channel[i].noteon=1,t.channel[i].fadeoutpos=65535,t.channel[i].volenvpos=0,t.channel[i].panenvpos=0,t.channel[i].trigramp=0,t.channel[i].trigrampfrom=t.channel[i].currentsample),3!=t.channel[i].command&&5!=t.channel[i].command&&(t.channel[i].note=r,t.channel[i].period=s,t.channel[i].voiceperiod=t.channel[i].period,t.channel[i].flags|=3)),t.channel[i].slideto=s):254==r&&(t.channel[i].noteon=0,1&t.instrument[o].voltype||(t.channel[i].voicevolume=0)),255!=t.pattern[e][2+a]&&(n=t.pattern[e][2+a])<=64&&(t.channel[i].volume=n,t.channel[i].voicevolume=t.channel[i].volume)},y.prototype.process_tick=function(t){t.advance(t);for(var e=0;e<t.channels;e++){var n=t.patterntable[t.position],s=5*t.row*t.channels+5*e,n=(t.channel[e].oldfinalvolume=t.channel[e].finalvolume,2&t.flags&&(t.channel[e].command=t.pattern[n][3+s],t.channel[e].data=t.pattern[n][4+s],14==t.channel[e].command&&208==(240&t.channel[e].data)||t.process_note(t,n,e)),i=t.channel[e].instrument,si=t.channel[e].sampleindex,t.channel[e].noteon&&!t.instrument[i].samples&&(t.channel[e].noteon=0),t.pattern[n][2+s]);80<=n&&n<240&&(t.tick?t.voleffects_t1:t.voleffects_t0)[(n>>4)-5](t,e,15&n),t.channel[e].command<36&&(t.tick?t.effects_t1:t.effects_t0)[t.channel[e].command](t,e),(1&t.channel[e].flags||2&t.flags)&&t.channel[e].voiceperiod&&(s=t.amigaperiods?8287.137*1712/t.channel[e].voiceperiod:8287.137*Math.pow(2,(4608-t.channel[e].voiceperiod)/768),t.channel[e].samplespeed=s/t.samplerate),t.channel[e].vibratopos+=t.channel[e].vibratospeed,t.channel[e].vibratopos&=63,1&t.instrument[i].voltype&&(t.channel[e].volenvpos++,t.channel[e].noteon&&2&t.instrument[i].voltype&&t.channel[e].volenvpos>=t.instrument[i].volsustain&&(t.channel[e].volenvpos=t.instrument[i].volsustain),4&t.instrument[i].voltype&&t.channel[e].volenvpos>=t.instrument[i].volloopend&&(t.channel[e].volenvpos=t.instrument[i].volloopstart),t.channel[e].volenvpos>=t.instrument[i].volenvlen&&(t.channel[e].volenvpos=t.instrument[i].volenvlen),324<t.channel[e].volenvpos&&(t.channel[e].volenvpos=324),!t.channel[e].noteon)&&t.channel[e].fadeoutpos&&(t.channel[e].fadeoutpos-=t.instrument[i].volfadeout,t.channel[e].fadeoutpos<0)&&(t.channel[e].fadeoutpos=0),1&t.instrument[i].pantype&&(t.channel[e].panenvpos++,t.channel[e].noteon&&2&t.instrument[i].pantype&&t.channel[e].panenvpos>=t.instrument[i].pansustain&&(t.channel[e].panenvpos=t.instrument[i].pansustain),4&t.instrument[i].pantype&&t.channel[e].panenvpos>=t.instrument[i].panloopend&&(t.channel[e].panenvpos=t.instrument[i].panloopstart),t.channel[e].panenvpos>=t.instrument[i].panenvlen&&(t.channel[e].panenvpos=t.instrument[i].panenvlen),324<t.channel[e].panenvpos)&&(t.channel[e].panenvpos=324),t.channel[e].finalvolume=t.channel[e].voicevolume*t.instrument[i].volenv[t.channel[e].volenvpos]*t.channel[e].fadeoutpos/65536,t.finalpan[e]=t.pan[e]+(t.instrument[i].panenv[t.channel[e].panenvpos]-.5)*(.5*Math.abs(t.pan[e]-.5))*2,t.channel[e].oldfinalvolume!=t.channel[e].finalvolume&&(t.channel[e].volrampfrom=t.channel[e].oldfinalvolume,t.channel[e].volramp=0),t.channel[e].flags=0}t.flags&=112},y.prototype.mix=function(e,i,n){var s=new Float32Array(2);if(e.paused||e.endofsong||!e.playing)for(var a=0;a<n;a++){i[0][a]=0;for(var r=i[1][a]=0;r<e.chvu.length;r++)e.chvu[r]=0}else for(a=0;a<n;a++){s[0]=0,s[1]=0,e.stt<=0&&e.process_tick(e);for(r=0;r<e.channels;r++){var o,h=0,l=0,c=0,p=e.channel[r].instrument,f=e.channel[r].sampleindex;e.channel[r].noteon||1&e.instrument[p].voltype&&!e.channel[r].noteon&&e.channel[r].fadeoutpos||!e.channel[r].noteon&&e.channel[r].volramp<1?(e.instrument[p].sample[f].length>e.channel[r].samplepos&&(h=e.channel[r].lastsample,o=Math.floor(e.channel[r].samplepos),c=e.instrument[p].sample[f].data[o],o=e.channel[r].samplepos-o,h=(o=e.channel[r].playdir<0?1-o:o)*c+(1-o)*h,h=(o=e.channel[r].trigramp)*h+(1-o)*e.channel[r].trigrampfrom,o+=1/128,e.channel[r].trigramp=Math.min(1,o),l=(e.channel[r].currentsample=h)*(e.channel[r].finalvolume/64),h=(o=e.channel[r].volramp)*l+(1-o)*(h*(e.channel[r].volrampfrom/64)),o+=1/64,e.channel[r].volramp=Math.min(1,o),l=h*(o=e.finalpan[r]),h*=1-o),s[0]+=h,s[1]+=l,o=e.channel[r].samplepos,e.channel[r].samplepos+=e.channel[r].playdir*e.channel[r].samplespeed,1==e.channel[r].playdir?Math.floor(e.channel[r].samplepos)>Math.floor(o)&&(e.channel[r].lastsample=c):Math.floor(e.channel[r].samplepos)<Math.floor(o)&&(e.channel[r].lastsample=c),e.instrument[p].sample[f].looptype?2==e.instrument[p].sample[f].looptype?-1==e.channel[r].playdir?e.channel[r].samplepos<=e.instrument[p].sample[f].loopstart&&(e.channel[r].samplepos+=e.instrument[p].sample[f].loopstart-e.channel[r].samplepos,e.channel[r].playdir=1,e.channel[r].lastsample=e.channel[r].currentsample):e.channel[r].samplepos>=e.instrument[p].sample[f].loopend&&(e.channel[r].samplepos-=e.channel[r].samplepos-e.instrument[p].sample[f].loopend,e.channel[r].playdir=-1,e.channel[r].lastsample=e.channel[r].currentsample):e.channel[r].samplepos>=e.instrument[p].sample[f].loopend&&(e.channel[r].samplepos-=e.instrument[p].sample[f].looplength,e.channel[r].lastsample=e.channel[r].currentsample):e.channel[r].samplepos>=e.instrument[p].sample[f].length&&(e.channel[r].noteon=0)):e.channel[r].currentsample=0,e.chvu[r]=Math.max(e.chvu[r],Math.abs(h+l))}t=e.volume/64,i[0][a]=s[0]*t,i[1][a]=s[1]*t,e.stt--}},y.prototype.effect_vol_t0_60=function(t,e,i){},y.prototype.effect_vol_t0_70=function(t,e,i){},y.prototype.effect_vol_t0_80=function(t,e,i){t.channel[e].voicevolume-=i,t.channel[e].voicevolume<0&&(t.channel[e].voicevolume=0)},y.prototype.effect_vol_t0_90=function(t,e,i){t.channel[e].voicevolume+=i,64<t.channel[e].voicevolume&&(t.channel[e].voicevolume=64)},y.prototype.effect_vol_t0_a0=function(t,e,i){t.channel[e].vibratospeed=i},y.prototype.effect_vol_t0_b0=function(t,e,i){i&&(t.channel[e].vibratodepth=i),t.effect_t1_4(t,e)},y.prototype.effect_vol_t0_c0=function(t,e,i){t.pan[e]=(15&i)/15},y.prototype.effect_vol_t0_d0=function(t,e,i){},y.prototype.effect_vol_t0_e0=function(t,e,i){},y.prototype.effect_vol_t0_f0=function(t,e,i){},y.prototype.effect_vol_t1_60=function(t,e,i){t.channel[e].voicevolume-=i,t.channel[e].voicevolume<0&&(t.channel[e].voicevolume=0)},y.prototype.effect_vol_t1_70=function(t,e,i){t.channel[e].voicevolume+=i,64<t.channel[e].voicevolume&&(t.channel[e].voicevolume=64)},y.prototype.effect_vol_t1_80=function(t,e,i){},y.prototype.effect_vol_t1_90=function(t,e,i){},y.prototype.effect_vol_t1_a0=function(t,e,i){},y.prototype.effect_vol_t1_b0=function(t,e,i){t.effect_t1_4(t,e)},y.prototype.effect_vol_t1_c0=function(t,e,i){},y.prototype.effect_vol_t1_d0=function(t,e,i){},y.prototype.effect_vol_t1_e0=function(t,e,i){},y.prototype.effect_vol_t1_f0=function(t,e,i){},y.prototype.effect_t0_0=function(t,e){t.channel[e].arpeggio=t.channel[e].data},y.prototype.effect_t0_1=function(t,e){t.channel[e].data&&(t.channel[e].slideupspeed=4*t.channel[e].data)},y.prototype.effect_t0_2=function(t,e){t.channel[e].data&&(t.channel[e].slidedownspeed=4*t.channel[e].data)},y.prototype.effect_t0_3=function(t,e){t.channel[e].data&&(t.channel[e].slidetospeed=4*t.channel[e].data)},y.prototype.effect_t0_4=function(t,e){15&t.channel[e].data&&240&t.channel[e].data&&(t.channel[e].vibratodepth=15&t.channel[e].data,t.channel[e].vibratospeed=(240&t.channel[e].data)>>4),t.effect_t1_4(t,e)},y.prototype.effect_t0_5=function(t,e){t.effect_t0_a(t,e)},y.prototype.effect_t0_6=function(t,e){t.effect_t0_a(t,e)},y.prototype.effect_t0_7=function(t,e){},y.prototype.effect_t0_8=function(t,e){t.pan[e]=t.channel[e].data/255},y.prototype.effect_t0_9=function(t,e){t.channel[e].samplepos=256*t.channel[e].data,t.channel[e].playdir=1,t.channel[e].trigramp=0,t.channel[e].trigrampfrom=t.channel[e].currentsample},y.prototype.effect_t0_a=function(t,e){t.channel[e].data&&(t.channel[e].volslide=t.channel[e].data)},y.prototype.effect_t0_b=function(t,e){t.breakrow=0,t.patternjump=t.channel[e].data,t.flags|=16},y.prototype.effect_t0_c=function(t,e){t.channel[e].voicevolume=t.channel[e].data,t.channel[e].voicevolume<0&&(t.channel[e].voicevolume=0),64<t.channel[e].voicevolume&&(t.channel[e].voicevolume=64)},y.prototype.effect_t0_d=function(t,e){t.breakrow=10*((240&t.channel[e].data)>>4)+(15&t.channel[e].data),16&t.flags||(t.patternjump=t.position+1),t.flags|=16},y.prototype.effect_t0_e=function(t,e){var i=(240&t.channel[e].data)>>4;t.effects_t0_e[i](t,e)},y.prototype.effect_t0_f=function(t,e){32<t.channel[e].data?t.bpm=t.channel[e].data:t.channel[e].data&&(t.speed=t.channel[e].data)},y.prototype.effect_t0_g=function(t,e){t.channel[e].data<=64&&(t.volume=t.channel[e].data)},y.prototype.effect_t0_h=function(t,e){t.channel[e].data&&(t.globalvolslide=t.channel[e].data)},y.prototype.effect_t0_i=function(t,e){},y.prototype.effect_t0_j=function(t,e){},y.prototype.effect_t0_k=function(t,e){t.channel[e].noteon=0,1&t.instrument[t.channel[e].instrument].voltype||(t.channel[e].voicevolume=0)},y.prototype.effect_t0_l=function(t,e){t.channel[e].volenvpos=t.channel[e].data,t.channel[e].panenvpos=t.channel[e].data},y.prototype.effect_t0_m=function(t,e){},y.prototype.effect_t0_n=function(t,e){},y.prototype.effect_t0_o=function(t,e){},y.prototype.effect_t0_p=function(t,e){},y.prototype.effect_t0_q=function(t,e){},y.prototype.effect_t0_r=function(t,e){},y.prototype.effect_t0_s=function(t,e){},y.prototype.effect_t0_t=function(t,e){},y.prototype.effect_t0_u=function(t,e){},y.prototype.effect_t0_v=function(t,e){},y.prototype.effect_t0_w=function(t,e){},y.prototype.effect_t0_x=function(t,e){},y.prototype.effect_t0_y=function(t,e){},y.prototype.effect_t0_z=function(t,e){},y.prototype.effect_t0_e0=function(t,e){},y.prototype.effect_t0_e1=function(t,e){t.channel[e].period-=15&t.channel[e].data,t.channel[e].period<113&&(t.channel[e].period=113)},y.prototype.effect_t0_e2=function(t,e){t.channel[e].period+=15&t.channel[e].data,856<t.channel[e].period&&(t.channel[e].period=856),t.channel[e].flags|=1},y.prototype.effect_t0_e3=function(t,e){},y.prototype.effect_t0_e4=function(t,e){t.channel[e].vibratowave=7&t.channel[e].data},y.prototype.effect_t0_e5=function(t,e){},y.prototype.effect_t0_e6=function(t,e){15&t.channel[e].data?(t.loopcount?t.loopcount--:t.loopcount=15&t.channel[e].data,t.loopcount&&(t.flags|=64)):t.looprow=t.row},y.prototype.effect_t0_e7=function(t,e){},y.prototype.effect_t0_e8=function(t,e){t.syncqueue.unshift(15&t.channel[e].data)},y.prototype.effect_t0_e9=function(t,e){},y.prototype.effect_t0_ea=function(t,e){t.channel[e].voicevolume+=15&t.channel[e].data,64<t.channel[e].voicevolume&&(t.channel[e].voicevolume=64)},y.prototype.effect_t0_eb=function(t,e){t.channel[e].voicevolume-=15&t.channel[e].data,t.channel[e].voicevolume<0&&(t.channel[e].voicevolume=0)},y.prototype.effect_t0_ec=function(t,e){},y.prototype.effect_t0_ed=function(t,e){t.tick==(15&t.channel[e].data)&&t.process_note(t,t.patterntable[t.position],e)},y.prototype.effect_t0_ee=function(t,e){t.patterndelay=15&t.channel[e].data,t.patternwait=0},y.prototype.effect_t0_ef=function(t,e){},y.prototype.effect_t1_0=function(t,e){var i,n,s;t.channel[e].data&&(i=t.channel[e].instrument,n=t.channel[e].note,t.tick%3==1&&(n+=t.channel[e].arpeggio>>4),t.tick%3==2&&(n+=15&t.channel[e].arpeggio),s=t.channel[e].sampleindex,t.channel[e].voiceperiod=t.calcperiod(t,n+t.instrument[i].sample[s].relativenote,t.instrument[i].sample[s].finetune),t.channel[e].flags|=1)},y.prototype.effect_t1_1=function(t,e){t.channel[e].voiceperiod-=t.channel[e].slideupspeed,t.channel[e].voiceperiod<1&&(t.channel[e].voiceperiod+=65535),t.channel[e].flags|=3},y.prototype.effect_t1_2=function(t,e){t.channel[e].voiceperiod+=t.channel[e].slidedownspeed,7680<t.channel[e].voiceperiod&&(t.channel[e].voiceperiod=7680),t.channel[e].flags|=3},y.prototype.effect_t1_3=function(t,e){t.channel[e].voiceperiod<t.channel[e].slideto&&(t.channel[e].voiceperiod+=t.channel[e].slidetospeed,t.channel[e].voiceperiod>t.channel[e].slideto)&&(t.channel[e].voiceperiod=t.channel[e].slideto),t.channel[e].voiceperiod>t.channel[e].slideto&&(t.channel[e].voiceperiod-=t.channel[e].slidetospeed,t.channel[e].voiceperiod<t.channel[e].slideto)&&(t.channel[e].voiceperiod=t.channel[e].slideto),t.channel[e].flags|=3},y.prototype.effect_t1_4=function(t,e){var i=t.vibratotable[3&t.channel[e].vibratowave][t.channel[e].vibratopos]/63,i=t.channel[e].vibratodepth*i;t.channel[e].voiceperiod+=i,t.channel[e].flags|=1},y.prototype.effect_t1_5=function(t,e){t.effect_t1_3(t,e),t.effect_t1_a(t,e)},y.prototype.effect_t1_6=function(t,e){t.effect_t1_4(t,e),t.effect_t1_a(t,e)},y.prototype.effect_t1_7=function(t,e){},y.prototype.effect_t1_8=function(t,e){},y.prototype.effect_t1_9=function(t,e){},y.prototype.effect_t1_a=function(t,e){15&t.channel[e].volslide||(t.channel[e].voicevolume+=t.channel[e].volslide>>4,64<t.channel[e].voicevolume&&(t.channel[e].voicevolume=64)),240&t.channel[e].volslide||(t.channel[e].voicevolume-=15&t.channel[e].volslide,t.channel[e].voicevolume<0&&(t.channel[e].voicevolume=0))},y.prototype.effect_t1_b=function(t,e){},y.prototype.effect_t1_c=function(t,e){},y.prototype.effect_t1_d=function(t,e){},y.prototype.effect_t1_e=function(t,e){var i=(240&t.channel[e].data)>>4;t.effects_t1_e[i](t,e)},y.prototype.effect_t1_f=function(t,e){},y.prototype.effect_t1_g=function(t,e){},y.prototype.effect_t1_h=function(t,e){15&t.globalvolslide||(t.volume+=t.globalvolslide>>4,64<t.volume&&(t.volume=64)),240&t.globalvolslide||(t.volume-=15&t.globalvolslide,t.volume<0&&(t.volume=0))},y.prototype.effect_t1_i=function(t,e){},y.prototype.effect_t1_j=function(t,e){},y.prototype.effect_t1_k=function(t,e){},y.prototype.effect_t1_l=function(t,e){},y.prototype.effect_t1_m=function(t,e){},y.prototype.effect_t1_n=function(t,e){},y.prototype.effect_t1_o=function(t,e){},y.prototype.effect_t1_p=function(t,e){},y.prototype.effect_t1_q=function(t,e){},y.prototype.effect_t1_r=function(t,e){},y.prototype.effect_t1_s=function(t,e){},y.prototype.effect_t1_t=function(t,e){},y.prototype.effect_t1_u=function(t,e){},y.prototype.effect_t1_v=function(t,e){},y.prototype.effect_t1_w=function(t,e){},y.prototype.effect_t1_x=function(t,e){},y.prototype.effect_t1_y=function(t,e){},y.prototype.effect_t1_z=function(t,e){},y.prototype.effect_t1_e0=function(t,e){},y.prototype.effect_t1_e1=function(t,e){},y.prototype.effect_t1_e2=function(t,e){},y.prototype.effect_t1_e3=function(t,e){},y.prototype.effect_t1_e4=function(t,e){},y.prototype.effect_t1_e5=function(t,e){},y.prototype.effect_t1_e6=function(t,e){},y.prototype.effect_t1_e7=function(t,e){},y.prototype.effect_t1_e8=function(t,e){},y.prototype.effect_t1_e9=function(t,e){t.tick%(15&t.channel[e].data)==0&&(t.channel[e].samplepos=0,t.channel[e].playdir=1,t.channel[e].trigramp=0,t.channel[e].trigrampfrom=t.channel[e].currentsample,t.channel[e].fadeoutpos=65535,t.channel[e].volenvpos=0,t.channel[e].panenvpos=0)},y.prototype.effect_t1_ea=function(t,e){},y.prototype.effect_t1_eb=function(t,e){},y.prototype.effect_t1_ec=function(t,e){t.tick==(15&t.channel[e].data)&&(t.channel[e].voicevolume=0)},y.prototype.effect_t1_ed=function(t,e){t.effect_t0_ed(t,e)},y.prototype.effect_t1_ee=function(t,e){},y.prototype.effect_t1_ef=function(t,e){},_.prototype.load=function(t){var e=(this.url=t).split(".").pop().toLowerCase().trim();if(-1==this.supportedformats.indexOf(e)&&(e=t.split("/").pop().split(".").shift().toLowerCase().trim(),-1==this.supportedformats.indexOf(e)))return!1;"xm"===(this.format=e)&&(this.player=new y),this.player.onReady=this.loadSuccess,this.state="loading..";var n=new XMLHttpRequest,s=(n.open("GET",this.url,!0),n.responseType="arraybuffer",this.request=n,this.loading=!0,this);return n.onprogress=function(t){s.state="loading ("+Math.floor(100*t.loaded/t.total)+"%).."},n.onload=function(){var t=new Uint8Array(n.response);if(this.state="parsing..",s.player.parse(t)){for(s.title=s.player.title,s.signature=s.player.signature,s.songlen=s.player.songlen,s.channels=s.player.channels,s.patterns=s.player.patterns,s.filter=s.player.filter,s.context&&s.setfilter(s.filter),s.mixval=s.player.mixval,s.samplenames=new Array(32),i=0;i<32;i++)s.samplenames[i]="";if("xm"==s.format||"it"==s.format)for(i=0;i<s.player.instrument.length;i++)s.samplenames[i]=s.player.instrument[i].name;else for(i=0;i<s.player.sample.length;i++)s.samplenames[i]=s.player.sample[i].name;s.state="ready.",s.loading=!1,s.onReady(),s.autostart&&s.play()}else s.state="error!",s.loading=!1},n.send(),!0},_.prototype.play=function(){if(this.loading||!this.player)return!1;if(null==this.context&&this.createContext(),this.player.samplerate=this.samplerate,this.context&&this.setfilter(this.player.filter),this.player.paused)return!(this.player.paused=!1);for(this.endofsong=!1,this.player.endofsong=!1,this.player.paused=!1,this.player.initialize(),this.player.flags=3,this.player.playing=!0,this.playing=!0,this.chvu=new Float32Array(this.player.channels),i=0;i<this.player.channels;i++)this.chvu[i]=0;return this.onPlay(),this.player.delayfirst=this.bufferstodelay,!0},_.prototype.pause=function(){this.player&&(this.player.paused?this.player.paused=!1:this.player.paused=!0)},_.prototype.stop=function(){this.paused=!1,this.playing=!1,this.player&&(this.player.paused=!1,this.player.playing=!1,this.player.delayload=1),this.onStop()},_.prototype.stopaudio=function(t){this.player&&(this.player.playing=t)},_.prototype.jump=function(t){this.player&&(this.player.tick=0,this.player.row=0,this.player.position+=t,this.player.flags=3,this.player.position<0&&(this.player.position=0),this.player.position>=this.player.songlen)&&this.stop(),this.position=this.player.position,this.row=this.player.row},_.prototype.setrepeat=function(t){this.repeat=t,this.player&&(this.player.repeat=t)},_.prototype.setseparation=function(t){this.separation=t,this.player&&(this.player.separation=t)},_.prototype.setautostart=function(t){this.autostart=t},_.prototype.setamigamodel=function(t){"600"==t||"1200"==t||"4000"==t?(this.amiga500=!1,this.filterNode&&(this.filterNode.frequency.value=22050)):(this.amiga500=!0,this.filterNode&&(this.filterNode.frequency.value=6e3))},_.prototype.setfilter=function(t){this.lowpassNode.frequency.value=t?3275:28867,this.filter=t,this.player&&(this.player.filter=t)},_.prototype.hassyncevents=function(){return!!this.player&&0!=this.player.syncqueue.length},_.prototype.popsyncevent=function(){if(this.player)return this.player.syncqueue.pop()},_.prototype.currentpattern=function(){if(this.player)return this.player.patterntable[this.player.position]},_.prototype.patterndata=function(t){var e,i,n;if("mod"==this.format)for(n=new Uint8Array(this.player.pattern_unpack[t]),e=0;e<64;e++)for(i=0;i<this.player.channels;i++)0==n[5*e*this.channels+5*i+3]&&0==n[5*e*this.channels+5*i+4]?n[5*e*this.channels+5*i+3]=46:(n[5*e*this.channels+5*i+3]+=55,n[5*e*this.channels+5*i+3]<65&&(n[5*e*this.channels+5*i+3]-=7));else if("s3m"==this.format)for(n=new Uint8Array(this.player.pattern[t]),e=0;e<64;e++)for(i=0;i<this.player.channels;i++)255==n[5*e*this.channels+5*i+3]?n[5*e*this.channels+5*i+3]=46:n[5*e*this.channels+5*i+3]+=64;else if("xm"==this.format)for(n=new Uint8Array(this.player.pattern[t]),e=0;e<this.player.patternlen[t];e++)for(i=0;i<this.player.channels;i++)n[5*e*this.channels+5*i]<97&&(n[5*e*this.channels+5*i]=n[5*e*this.channels+5*i]%12|Math.floor(n[5*e*this.channels+5*i]/12)<<4),255==n[5*e*this.channels+5*i+3]?n[5*e*this.channels+5*i+3]=46:n[5*e*this.channels+5*i+3]<10?n[5*e*this.channels+5*i+3]+=48:n[5*e*this.channels+5*i+3]+=55;return n},_.prototype.noteon=function(t){return t>=this.channels?0:this.player.channel[t].noteon},_.prototype.currentsample=function(t){return t>=this.channels?0:"xm"==this.format||"it"==this.format?this.player.channel[t].instrument:this.player.channel[t].sample},_.prototype.currentpattlen=function(){return"mod"==this.format||"s3m"==this.format?64:this.player.patternlen[this.player.patterntable[this.player.position]]},_.prototype.createContext=function(){"undefined"!=typeof AudioContext?this.context=new AudioContext:this.context=new webkitAudioContext,this.samplerate=this.context.sampleRate,this.bufferlen=44100<this.samplerate?4096:2048,this.filterNode=this.context.createBiquadFilter(),this.amiga500?this.filterNode.frequency.value=6e3:this.filterNode.frequency.value=22050,this.lowpassNode=this.context.createBiquadFilter(),this.setfilter(this.filter),"function"==typeof this.context.createJavaScriptNode?this.mixerNode=this.context.createJavaScriptNode(this.bufferlen,1,2):this.mixerNode=this.context.createScriptProcessor(this.bufferlen,1,2),(this.mixerNode.module=this).mixerNode.onaudioprocess=_.prototype.mix,this.mixerNode.connect(this.filterNode),this.filterNode.connect(this.lowpassNode),this.lowpassNode.connect(this.context.destination)},_.prototype.mix=function(e){var i=(e.srcElement||this).module;if(i.player&&0==i.delayfirst){i.player.repeat=i.repeat;for(var n=new Array(e.outputBuffer.getChannelData(0),e.outputBuffer.getChannelData(1)),s=e.outputBuffer.length,a=(i.player.mix(i.player,n,s),new Float32Array(2)),r=0;r<s;r++)a[0]=n[0][r],a[1]=n[1][r],i.separation&&(t=a[0],2==i.separation?(a[0]=.5*a[0]+.5*a[1],a[1]=.5*a[1]+.5*t):(a[0]=.65*a[0]+.35*a[1],a[1]=.65*a[1]+.35*t)),a[0]/=i.mixval,a[0]=.5*(Math.abs(a[0]+.975)-Math.abs(a[0]-.975)),a[1]/=i.mixval,a[1]=.5*(Math.abs(a[1]+.975)-Math.abs(a[1]-.975)),n[0][r]=a[0],n[1][r]=a[1];i.row=i.player.row,i.position=i.player.position,i.speed=i.player.speed,i.bpm=i.player.bpm,i.endofsong=i.player.endofsong,i.player.filter!=i.filter&&i.setfilter(i.player.filter),i.endofsong&&i.playing&&i.stop(),0<i.delayfirst&&i.delayfirst--;for(var o=i.delayload=0;o<i.player.channels;o++)i.chvu[o]=.25*i.chvu[o]+.75*i.player.chvu[o],i.player.chvu[o]=0}};var Tt=[.2,,10,.12,.01,.05,,1.2,,,-491,.02,,,119,.7,,.93,.02,,-1430],x=(x=document.getElementById("c").getContext("2d",{willReadFrequently:!0}),window.zyxplay=window.zyxplay||{},window.zyxplay.context=x);x.imageSmoothingEnabled=!1,x.setTransform(1,0,0,1,0,0),(async()=>{{let t;for(t=0;t<26;t++)l["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)l["Digit"+t]=l["Numpad"+t]=""+t;window.addEventListener("keydown",X),window.addEventListener("keyup",K)}await n("song1",xt,bt),await n("explosion",H,Ct),await n("shoot",H,At),await n("shoot2",H,Ht),await n("typing",H,St),await n("powerup",H,Mt),await n("hit",H,Ot),await n("transition",H,Et),await n("engineSlowdown",H,Lt),await n("bigExplosion",H,It),await n("laser",H,Tt),await o("spritesheet.png"),await o("spritesheet16.png");var t=u({draw(t){var e=new Path2D("M42.125 56V47.7188H52.375V38.875H42.125V31.6562H52.375V22.8125H42.125V14.5312H58.1562L66.4688 22.8125V31.25L62.3125 35.4062L66.4688 39.5625V47.7188L58.1562 56H42.125ZM26.125 56V14.5312H39.9375V56H26.125ZM72.875 56V14.5312H86.6875V56H72.875ZM88.875 56V47.7188H95.7188V42.4688H108.25V56H88.875ZM113.5 56V47.1562H117.656V23.3438H113.5V14.5312H135.625V23.3438H131.469V47.1562H135.625V56H113.5ZM167.375 56L142.25 14.5312H156.844L182.062 56H167.375ZM182.062 52.0625L170.031 32.25V14.5312H182.062V52.0625ZM142.25 56V18.4688L154.281 38.1875V56H142.25ZM204.75 56V47.7188H215V22.8125H204.75V14.5312H220.531L228.844 22.8125V47.7188L220.531 56H204.75ZM188.75 56V14.5312H202.562V56H188.75ZM40.4062 111V69.5312H54.2188V88.0625H66.9688V96.2188H54.2188V111H40.4062ZM63.6562 83.2812V77.8125H56.4062V69.5312H77.4688V83.2812H63.6562ZM83.5312 111V69.5312H97.3438V85.9688H110.562V93.9688H97.3438V111H83.5312ZM108.125 81.5312V77.5625H99.5312V69.5312H121.125V81.5312H108.125ZM99.5312 111V102.719H107.312V98.5625H121.125V111H99.5312ZM156.812 111L155.062 106.469H141.5L144.375 98.25H151.875L140.781 69.5312H154.25L170.781 111H156.812ZM124.469 111L139.281 71.4062L145.406 87.875L137.812 111H124.469ZM190.469 98.5625V90.5312H200.844V77.8125H190.469V69.5312H206.25L214.562 77.8125V90.25L208.125 96.6875L215.969 111H201.219L195.344 98.5625H190.469ZM174.469 111V69.5312H188.281V111H174.469Z"),i=(t.fillStyle="white",t.fill(e),t.globalCompositeOperation="source-in",t.createLinearGradient(0,20,0,80));i.addColorStop(0,"rgb(255, 255, 255, 1)"),i.addColorStop(.21,"rgb(0, 255, 255, 1)"),i.addColorStop(1,"rgb(0, 0, 255, 1)"),t.fillStyle=i,t.fillRect(0,0,256,240),t.globalCompositeOperation="source-over",t.strokeStyle="white",t.lineWidth=5,t.stroke(e),t.strokeStyle="black",t.lineWidth=2,t.stroke(e)}}),t=(await t.generate(256,240),await o("title.png",t.image),u({draw(t){t.save(),t.translate(0,-100);var e=new Path2D("M42 166L33.7188 157.719V132.812L42 124.531H47.5312V157.719H59.375V166H42ZM60 136.969V132.812H49.7188V124.531H66.5625L73.8125 132.812V136.969H60ZM61.5625 166V151.219H54.8438V143H73.8125V166H61.5625ZM109.5 166L107.75 161.469H94.1875L97.0625 153.25H104.562L93.4688 124.531H106.938L123.469 166H109.5ZM77.1562 166L91.9688 126.406L98.0938 142.875L90.5 166H77.1562ZM151.781 166L127.188 124.531H141.875L153 142.969L161.75 127.969V148.844L151.781 166ZM163.781 166V124.531H177.594V166H163.781ZM127.156 166V128.375L140.062 150.031V166H127.156ZM184.281 166V124.531H198.094V140.969H211.312V148.969H198.094V166H184.281ZM208.875 136.531V132.562H200.281V124.531H221.875V136.531H208.875ZM200.281 166V157.719H208.062V153.562H221.875V166H200.281ZM61.5 221V212.562H66.7812V187.938H61.5V179.531H72.2188L80.5938 187.812V212.719L72.2188 221H61.5ZM48.6875 221L40.2812 212.719V187.812L48.6875 179.531H59.3125V187.938H54.125V212.562H59.3125V221H48.6875ZM97.7188 221L82.7188 179.531H96.8125L111.156 221H97.7188ZM112.844 219.75L106.625 201.5L113.312 179.531H127.188L112.844 219.75ZM130.625 221V179.531H144.438V195.969H157.656V203.969H144.438V221H130.625ZM155.219 191.531V187.562H146.625V179.531H168.219V191.531H155.219ZM146.625 221V212.719H154.406V208.562H168.219V221H146.625ZM190.625 208.562V200.531H201V187.812H190.625V179.531H206.406L214.719 187.812V200.25L208.281 206.688L216.125 221H201.375L195.5 208.562H190.625ZM174.625 221V179.531H188.438V221H174.625Z"),i=(t.fillStyle="white",t.fill(e),t.restore(),t.globalCompositeOperation="source-in",t.createLinearGradient(0,20,0,120));i.addColorStop(0,"rgb(255, 255, 255, 1)"),i.addColorStop(.31,"rgb(255, 255, 0, 1)"),i.addColorStop(.71,"rgb(172, 124 ,0, 1)"),i.addColorStop(1,"rgb(248, 56 ,0, 1)"),t.fillStyle=i,t.fillRect(0,0,256,240),t.globalCompositeOperation="source-over",t.save(),t.translate(0,-100),t.strokeStyle="white",t.lineWidth=5,t.stroke(e),t.strokeStyle="black",t.lineWidth=2,t.stroke(e),t.restore()}})),t=(await t.generate(256,240),await o("gameover.png",t.image),await(async()=>{const e=new Image;return e.src="data:image/svg+xml,"+encodeURIComponent(`
    <svg width="200" height="144" viewBox="0 0 200 144" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M142.301 99.9813C158.007 76.187 151.45 44.1656 127.656 28.4595C103.862 12.7534 71.8401 19.3102 56.134 43.1046C40.4279 66.8989 46.9848 98.9202 70.7792 114.627C94.5734 130.333 126.595 123.775 142.301 99.9813Z" fill="#E5B883"/>
    <path d="M142.301 99.9813C158.007 76.187 151.45 44.1656 127.656 28.4595C103.862 12.7534 71.8401 19.3102 56.134 43.1046C40.4279 66.8989 46.9848 98.9202 70.7792 114.627C94.5734 130.333 126.595 123.775 142.301 99.9813Z" fill="#E5B883"/>
    <path opacity="0.41" d="M81.7066 89.9633C71.4796 91.0997 61.7398 91.9113 51.9998 92.3983C55.7334 100.839 61.5773 107.982 68.8823 113.339C83.33 117.073 100.05 118.047 105.407 111.391C98.427 111.229 91.1219 110.417 84.6285 107.496C89.6609 109.443 107.842 108.794 111.414 104.411C109.952 104.249 108.654 103.761 107.193 103.599C116.77 101.976 140.309 101.489 145.827 92.723C140.146 92.0736 134.627 96.2947 129.432 93.21C134.302 90.1257 141.607 89.9633 148.263 88.6647C149.074 86.5544 149.562 84.2818 150.048 82.009C134.79 85.2557 117.907 96.7814 104.108 90.775C110.439 87.6907 120.017 89.4763 124.887 83.47C118.231 82.1714 110.115 87.2037 103.459 89.1517C93.0698 92.0736 80.7326 95.8071 70.0187 94.9959C73.5899 94.1838 78.9469 92.3983 81.7066 89.9633Z" fill="#AC2024"/>
    <path opacity="0.41" d="M50.5374 54.4124C50.375 54.7371 50.375 55.0618 50.2127 55.3864C57.193 53.9254 66.6083 48.2438 73.751 46.1335C83.8156 43.3737 93.5552 44.0232 103.783 43.2114C98.2629 43.5361 93.8806 47.1075 89.1725 49.3801C95.3407 50.3541 101.835 47.1075 107.678 45.3218C118.068 42.0751 128.781 38.6661 137.548 36.8805C136.736 36.0688 135.924 35.2572 135.112 34.4455C119.529 33.1469 104.107 34.1209 88.3609 35.7442C72.4523 37.3675 63.5239 48.2438 50.5374 54.4124Z" fill="#AC2024"/>
    <path opacity="0.41" d="M48.5897 81.6844C54.9207 81.3597 64.9853 77.4637 68.719 76.9767C73.7512 76.1651 79.7576 75.5157 85.6015 75.5157C87.5496 76.1651 89.8222 76.4897 91.6078 76.4897C92.7441 76.4897 93.8807 76.3274 94.8542 76.1651C95.1796 76.1651 95.5041 76.3274 95.9908 76.3274L95.0164 76.1651C102.322 75.1911 109.627 72.2691 116.12 69.5094C126.185 65.4511 139.009 63.1785 149.073 57.8215C148.911 57.0098 148.587 56.3605 148.424 55.7112C135.6 61.3929 122.614 66.1004 109.139 70.3211C104.594 71.7821 96.8029 75.6781 91.1208 75.3534L88.5235 74.8664C75.3746 69.5095 95.8285 59.7695 97.1274 68.2108C96.153 65.6135 88.5235 67.5615 90.3092 72.2691C94.6919 71.9445 101.51 70.6458 103.621 66.4251C97.9385 63.6655 85.7639 58.9579 81.2185 66.1005C79.1082 69.3472 80.0822 71.9445 82.0302 73.7301C71.8032 73.8924 57.8427 73.7301 48.1027 78.4377C48.2651 79.4117 48.4274 80.2234 48.5897 81.1974C48.4274 81.1974 48.4274 81.3597 48.5897 81.6844Z" fill="#AC2024"/>
    <path opacity="0.82" d="M65.3105 37.0428C64.0119 37.3675 61.9015 37.8546 59.4666 38.5039C57.0315 41.4258 54.9212 44.5101 53.2979 47.9191C56.7069 46.4581 59.9536 44.8348 60.9276 44.3478C67.7456 40.9388 75.3751 37.3675 83.0048 35.2572C93.8807 32.3352 104.919 33.7962 115.796 32.1729C112.225 30.5496 106.543 31.3612 103.458 29.4133C110.115 25.0302 120.503 29.0886 129.594 30.0626C126.672 27.9523 123.588 26.1665 120.179 24.7056C114.985 24.7056 110.115 25.1926 106.38 25.5172C93.7184 26.3289 82.1931 30.5496 65.3105 37.0428Z" fill="#FFEACC"/>
    <path opacity="0.82" d="M115.957 72.756C119.528 72.756 123.1 71.782 126.671 72.269C119.042 78.6 104.594 79.2493 95.0164 79.8986C80.2442 81.0349 64.1732 82.9829 49.7256 86.8788C49.7256 86.8788 49.7256 86.8788 49.7256 87.0412C66.2836 87.3658 84.6272 80.7103 101.347 82.4959C99.3996 86.5542 92.7438 87.2035 89.0101 89.9632C96.6397 93.5346 111.25 83.6322 118.555 80.7103C128.295 76.8142 140.632 73.8923 150.697 68.6977C150.534 67.2366 150.372 65.6133 150.21 63.99C138.684 66.9119 125.373 67.7236 115.957 72.756Z" fill="#FFEACC"/>
    <path opacity="0.82" d="M121.64 51.8151C119.692 58.3083 111.9 56.8473 107.193 59.2824C111.576 60.7434 116.283 57.0097 120.504 57.8213C119.205 60.9057 115.147 62.6913 112.549 65.2886C120.179 64.3147 127.321 60.4187 133.815 56.685C137.224 54.737 141.769 52.6267 146.152 50.1918C145.341 48.406 144.367 46.7827 143.392 45.1594C139.01 45.3218 134.464 45.1594 130.243 45.9711C123.588 47.1074 117.095 48.5685 110.601 50.3541C100.212 53.1137 89.9851 53.4384 79.9205 55.8734C81.5438 56.0357 83.0049 57.0097 84.4659 57.3343C77.8102 65.7756 54.272 61.555 47.6163 69.0223C47.6163 69.5093 47.6163 70.1587 47.6163 70.6457C72.4532 66.9119 96.6406 53.6007 121.64 51.8151Z" fill="#FFEACC"/>
    <path opacity="0.82" d="M125.535 109.768C120.827 109.443 108.653 114.962 105.893 118.533C112.548 121.455 137.223 108.956 139.495 102.3C133.651 101.165 118.879 107.008 113.847 110.742C115.146 111.229 115.957 110.742 117.58 110.579L125.535 109.768Z" fill="#FFEACC"/>
    <path opacity="0.23" d="M89.9848 20.8097C61.9012 25.842 43.233 52.7892 48.4277 80.8727C48.7523 82.1714 48.9147 83.47 49.4017 84.931C50.8626 86.2296 52.4859 87.366 54.2717 88.5024C72.1282 99.3782 91.4457 95.1581 107.192 82.8207C118.88 73.5677 127.483 59.4448 127.159 44.1856C126.834 33.9587 122.776 27.303 116.607 22.9201C108.166 19.998 99.075 19.1864 89.9848 20.8097Z" fill="#FFEACC"/>
    <path opacity="0.28" d="M82.1927 28.6017C61.4142 28.1147 49.7263 62.5292 66.4464 74.5418C103.945 101.489 123.1 15.2904 82.1927 28.6017Z" fill="#FFEACC"/>
    <path opacity="0.21" d="M150.048 62.3667C148.1 51.8151 143.23 42.5621 136.249 35.5818C136.411 36.2311 136.411 36.7181 136.574 37.3674C137.71 46.6204 136.574 56.3603 133.165 65.2886C122.289 93.8592 92.7441 108.793 63.5244 102.462C61.5763 101.976 58.979 101.165 56.2194 100.19C67.258 116.91 87.5496 126.325 108.49 122.592C136.411 117.398 155.08 90.4501 150.048 62.3667Z" fill="#AC2024"/>
    <path opacity="0.28" d="M150.048 62.3668C149.074 57.3345 147.613 52.7892 145.34 48.4062C143.717 54.8995 143.23 61.8798 142.255 68.3732C140.47 79.8988 135.762 85.5803 126.834 93.21C115.471 102.95 100.698 111.716 85.2771 111.716C78.6215 111.716 72.1282 109.93 65.6349 110.904C70.6672 115.124 76.5112 118.534 82.6798 120.644C88.6861 120.807 94.3674 120.32 97.2895 119.994C123.1 117.235 141.282 101.651 150.21 79.7364C151.022 74.0547 151.022 68.2108 150.048 62.3668Z" fill="#AC2024"/>
    <path opacity="0.74" d="M126.509 27.7899C128.296 28.9263 130.081 30.2249 131.704 31.5236C156.541 27.7899 175.047 30.7119 178.456 40.2895C183.65 54.8994 151.833 79.5739 107.354 95.4825C62.8751 111.391 22.6168 112.528 17.4221 97.9179C14.0132 88.3399 26.6751 74.217 48.5899 61.2304C48.9146 59.2825 49.5639 57.3344 50.0509 55.3864C16.6104 72.9184 -4.00573 93.2099 0.701911 106.683C7.03287 124.702 56.7066 123.241 111.575 103.761C166.443 84.1193 205.728 53.7631 199.234 35.7442C194.527 22.1083 164.657 19.6733 126.509 27.7899Z" fill="#FFE4CC"/>
    <path opacity="0.74" d="M106.867 94.3459C149.399 79.087 179.755 55.5488 174.56 41.9129C171.476 33.4716 155.567 30.8743 133.977 33.4716C135.438 34.7703 136.899 36.2313 138.198 37.8546C148.912 38.0169 156.379 40.452 158.327 45.4842C162.547 56.5228 137.873 75.678 103.296 88.0153C68.7195 100.515 37.3893 101.489 33.331 90.4503C31.2207 84.6063 36.74 76.8144 47.6163 68.6977C47.7786 67.0744 47.9409 65.2888 48.1033 63.6655C28.461 75.678 17.2601 88.5023 20.5067 97.268C25.7014 111.067 64.3366 109.768 106.867 94.3459Z" fill="#EDCBAE"/>
    </svg>
  `),new Promise(t=>{e.onload=()=>{t(u({draw(t){t.drawImage(e,0,0)}}))}})})());await t.generate(256,240),await o("saturn.png",t.image);let e=await m();function i(t,e={}){var i,n;switch(i=["change-scene"],n=Object.keys(r).reduce((t,e)=>(i.includes(e)&&(t[e]=r[e]),t),{}),r=n,t){case"menu":s.load("./menu.xm"),a=function(){P(["enter"],()=>{z("change-scene","game")}),P(["c"],()=>{z("change-scene","credits",{reset:!1})}),J(["esc"]);const t=it(90),e=F({x:128,y:48,anchor:{x:.5,y:.5},width:256,height:100,scaleX:.01,scaleY:.01,image:p["title.png"],update(){this.scaleX=this.scaleY=V(0,1,this.frame/80),this.advance()},draw(){var t,e;this.frame<2||(t=this["context"],80<this.frame&&this.frame<200&&(t.save(),t.globalAlpha=1-(this.frame-80)/120,e=1+(this.frame-80)/10*.05,t.translate(128,50),t.scale(e,e),t.translate(-128,-50),t.drawImage(this.image,0,0),t.restore()),t.drawImage(this.image,0,0))}}),i=F({x:0,y:72,anchor:{x:.5,y:.5},width:30,height:200,ttl:1/0,dx:5,limit:1e3*k(1,2),update(){this.x>this.limit&&(this.x=0,this.limit=1e3*k(1,2)),this.advance()},draw(){var t=this["context"];t.save(),t.globalCompositeOperation="source-atop",t.globalAlpha=.5,t.fillStyle="white",t.rotate(Math.PI/4),t.fillRect(-10,0,5,this.height),t.fillRect(0,0,this.width,this.height),t.fillRect(40,0,10,this.height),t.restore()}});var n=F({x:128,y:256,anchor:{x:.5,y:.5},width:8,height:8,image:p["spritesheet.png"],sprite:4,dy:-.5,spawn(){this.x=k(0,256),this.y=256,this.dy=-k(.5,1.5),this.sprite=Math.floor(k(3,9))},update(){this.y<-8&&(this.y=-8,T(()=>this.spawn(),k(1e3,2e3))),this.advance()},draw(){var t=this["context"];t.save(),t.drawImage(this.image,8*this.sprite,0,8,8,0,0,8,8),t.restore()}}),s=F({x:224,y:376,anchor:{x:.5,y:.5},width:256,height:240,image:p["saturn.png"],dy:-.7,update(){this.y<240&&(this.dy=0),this.advance()},draw(){var t=this["context"];t.save(),t.drawImage(this.image,0,0,256,240),t.restore()}});const a=D({x:128,y:120,text:"DIRECTORS CUT EDITION",align:"center",color:"lightblue"}),r=D({x:128,y:144,text:"HI SCORE: 0",align:"center",color:"green",colorIndex:0,update(){this.frame%40==0&&(this.colorIndex++,5<this.colorIndex)&&(this.colorIndex=0),this.color=["red","yellow","white","green","lightblue","lightgreen"][this.colorIndex];var t=this.color?`font-${this.color}.png`:"font.png";this.spritesheet=p[t],this.advance()}}),o=(D({x:128,y:128,text:"A GAME BY\nMARCO FERNANDES",lineHeight:16,color:"white",align:"center"}),D({x:128,y:168,text:"ARROWS OR WASD TO MOVE\nSPACE TO SHOOT",lineHeight:16,align:"center"}));var h=D({x:128,y:208,text:"ENTER TO START",color:"lightgreen",align:"center"}),l=(r.text="HIGH SCORE: "+(localStorage.getItem("hiscore")||0),D({x:256,y:228,text:"GAME BY MARCO FERNANDES @ GRAPHICS BY KENNEY.NL @ MUSIC: START SCREEN BY DEPP @ GAME BY JUKEBOX @ GAME OVER BY DEPP @ SOUND EFFECTS ZAPSPLAT.COM @ GREETINGS TO STEVEN LAMBERT, KONTRAJS IS THE BEST! FRANK FORCE, ZZFX FTW!1!! ANDRZEJ MAZUR, MR. JS13K!. @@@ THANKS FOR PLAYING!",color:"yellow",align:"lef",dx:-.5,update(){this.x<8*-this.text.length&&(this.x=256),this.advance()}}));const c=j({frame:0,children:[t,s,n,h,l],update(){40<this.frame&&this.frame<180&&this.frame%20==0&&t.decreaseVel(2),this.frame++}});return T(()=>{c.add(e),c.add(i),U(Z.engineSlowdown)},100),T(()=>{c.add(a)},2500),T(()=>{c.add(r)},3e3),T(()=>{c.add(o)},3500),c}();break;case"game":s.load("./music-2.xm"),a=wt();break;case"game-over":s.load("./game-over.xm"),a=function({score:t=0,previous:e=localStorage.getItem("hiScore")||0}={}){P(["enter"],()=>{z("change-scene","menu")}),N("explosion",(e,i,n,s,a)=>{U(Z.explosion);for(let t=0;t<n;t++)r.get({x:e,y:i,dx:k(-s/2,s/2),dy:k(-s/2,s/2),color:a,ttl:30*s})});var i=it(1);const r=G({create:W,maxSize:400}),n=F({x:128,y:48,anchor:{x:.5,y:.5},width:256,height:100,scaleX:.01,scaleY:.01,image:p["gameover.png"],update(){this.scaleX=this.scaleY=V(0,1,this.frame/200),this.advance()},draw(){var t;this.frame<2||(t=this["context"],t.drawImage(this.image,0,0))}}),s=(D({x:128,y:32,text:"GAME OVER",align:"center",color:"red",scaleX:2,scaleY:4}),D({x:128,y:128,text:"YOUR SCORE:",color:"white",align:"center"})),a=D({x:128,y:144,text:""+t,color:"white",align:"center",scaleX:2,scaleY:2}),o=D({x:128,y:180,text:"NEW HIGH SCORE!",color:"yellow",align:"center"}),h=j({frame:0,children:[i,D({x:128,y:224,text:"ENTER TO CONTINUE",color:"lightgreen",align:"center"}),r]});return T(()=>{h.add(n)},1e3),T(()=>{h.add(s)},2e3),T(()=>{h.add(a)},2500),e<t&&T(()=>{h.add(o),z("explosion",128,180,60,4,"yellow")},3e3),h}(e)}}await e.generate(378,9),await o("font-white.png",e.image),await(e=await m("yellow")).generate(378,9),await o("font-yellow.png",e.image),await(e=await m("red")).generate(378,9),await o("font-red.png",e.image),await(e=await m("green")).generate(378,9),await o("font-green.png",e.image),await(e=await m("lightgreen")).generate(378,9),await o("font-lightgreen.png",e.image),await(e=await m("gray")).generate(378,9),await o("font-gray.png",e.image),await(e=await m("lightblue")).generate(378,9),await o("font-lightblue.png",e.image),P("m",()=>{s.playing?s.stop():s.play()});const s=new _;s.setrepeat(!0),s.onReady=()=>s.play(),N("change-scene",(t,e)=>i(t,e)),N("song-end",()=>console.log("song-end"));let a=function(){P(["enter"],()=>{z("change-scene","menu")});const t=D({x:128,y:120,text:"LOADING",color:"lightgreen",align:"center"});return T(async()=>{t.text="PRESS ENTER TO CONTINUE"},1e3),j({id:"loading",frame:0,children:[t]})}();(function({update:t,render:e}){let i=0,n,s,a;const r=h();function o(){if(requestAnimationFrame(o),s=performance.now(),a=s-n,n=s,!(1e3<a)){for(i+=a;i>=1e3/60;)t(1/60),i-=1e3/60;r.clearRect(0,0,r.canvas.width,r.canvas.height),e()}}return{start(){n=performance.now(),requestAnimationFrame(o)}}})({update(t){a.update(t)},render(){a.render()}}).start()})()}();
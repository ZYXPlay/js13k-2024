(function(){function qa(a){const b=document.createElementNS("http://www.w3.org/2000/svg","svg"),c=document.createElementNS("http://www.w3.org/2000/svg","path");b.appendChild(c);c.setAttribute("d",a);c.setAttribute("fill","none");c.setAttribute("stroke","black");c.setAttribute("stroke-width","2");c.setAttribute("id","path");return c}function ra(a){let {x:b=0,y:c=0,width:d,height:e}=a;b-=.5*d;c-=.5*e;0>d&&(b+=d,d*=-1);0>e&&(c+=e,e*=-1);return{x:b,y:c,width:d,height:e}}function q(a,b,...c){return setTimeout(a,
b,...c)}function E(a=0,b=1){return Math.random()*(b-a)+a}function Ea({update:a,C:b}){function c(){requestAnimationFrame(c);r=performance.now();p=r-f;f=r;if(!(1E3<p)){for(d+=p;d>=e;)a(k),d-=e;t.clearRect(0,0,t.canvas.width,t.canvas.height);b()}}let d=0,e=1E3/60,k=1/60,f,r,p;const t=window.T.context;return{start(){f=performance.now();requestAnimationFrame(c)}}}function u(a,b){S[a]=S[a]||[];S[a].push(b)}function Fa(a=[]){S=Object.keys(S).reduce((b,c)=>{a.includes(c)&&(b[c]=S[c]);return b},{})}function h(a,
...b){(S[a]||[]).map(c=>c(...b))}function sa(a,b){return(new URL(a,b)).href}function ea(a){window.ya||(window.ya={Ja:sa,Ha:G});return new Promise((b,c)=>{let d,e;if(G[a])return b(G[a]);d=new Image;d.onload=()=>{e=sa(a,window.location.href);G[e]=G[a]=d;b(d)};d.onerror=()=>{c()};d.src=a})}function A(a){return new Ga(a)}function ta(a){return new Ha(a)}function ua(a=()=>{},b){a.za&&b.preventDefault();a(b)}function Ia(a){let b=V[a.code],c=fa[b];ha[b]=!0;ua(c,a)}function Ja(a){let b=V[a.code],c=ia[b];ha[b]=
!1;ua(c,a)}function Ka(){let a;for(a=0;26>a;a++)V["Key"+String.fromCharCode(a+65)]=String.fromCharCode(a+97);for(a=0;10>a;a++)V["Digit"+a]=V["Numpad"+a]=""+a;window.addEventListener("keydown",Ia);window.addEventListener("keyup",Ja)}function W(a){return!![].concat(a).some(b=>ha[b])}function X(a,b,{Da:c="keydown",preventDefault:d=!0}={}){let e="keydown"==c?fa:ia;b.za=d;[].concat(a).map(k=>e[k]=b)}function La(a,{Da:b="keydown"}={}){let c="keydown"==b?fa:ia;[].concat(a).map(d=>delete c[d])}function I(a){return new Ma(a)}
function ja(a=1){const b=I({create:ka,m:241});b.Ia=function(c){this.o.forEach(d=>{d.dy*=c})};b.ta=function(){this.o.forEach(c=>{c.dy/=2})};b.Ka=a;for(let c=0;240>c;c++){const d=E(1,3)*a,e=Math.floor(d/a*50)+50;b.get({x:Math.floor(E(0,256)),y:c,width:1,height:1,dy:d/4,color:`rgb(${e}, ${e}, ${e})`,update(){this.advance();240<this.y&&(this.y=0)}})}b.B=()=>!0;return b}function Na(a){return new Oa(a)}function va(a,b){let c=[],d=b.x+b.width/2;var e=b.y+b.height/2;b=a.y<e;e=a.y+a.height>=e;a.x<d&&(b&&c.push(0),
e&&c.push(2));a.x+a.width>=d&&(b&&c.push(1),e&&c.push(3));return c}function Pa(a){return new wa(a)}function Qa(a){return new Ra(a)}function la(a,b){a.B()&&b.forEach(c=>{var d;if(d="enemy"!==a.name||"enemy"!==c.name)if(d=c.B()&&!a.j&&!c.j){d=ra(c);let e=ra(a);d=d.x<e.x+e.width&&d.x+d.width>e.x&&d.y<e.y+e.height&&d.y+d.height>e.y}d&&("ship-bullet"!=a.name||c.j||(a.g=0,c.S(1)),"ship"!=a.name||"asteroid"!=c.name&&"boss"!=c.name||(a.F(),a.g=0,c.S(5)),"ship"==a.name&&"enemy"==c.name&&(c.F(),c.g=0,a.S(50)),
"ship"==a.name&&"enemy-bullet"==c.name&&(c.g=0,a.S(10)),"ship"!=a.name||"powerup"!=c.name||c.la||(c.F(),a.Ea(c)))})}function Sa(a){return new Ta(a)}function ma(a){a=na[a];let b=Math.max(...Object.keys(a[0]),...Object.keys(a[1])),c=a[0][b];c??=a[1][b];return b+=c[1]/1E3*60*c[0]}function Ua(a=0,b=0,c=0,d=!1){const e=na[b],k=ma(b);if(e[0][a]){const f=e[0][a];h("spawn-enemy",f[0],f[1],{l:f[2],rotate:f[3],loop:f[4],h:f[5],Ca:f[6],V:f[7],path:qa(f[8])})}e[1][a]&&h("spawn-asteroid",...e[1][a]);e[2][a]&&
h("spawn-powerup",...e[2][a]);e[3][a]&&h("set-dialog",...e[3][a]);0===e[4].length&&a>=k&&0===c&&h("next-level",b+1>=xa?0:b+1);0<e[4].length&&d&&0===c&&h("spawn-boss",...e[4])}function Va(){X(["esc"],()=>{h("change-scene","menu")});X(["p"],()=>{h("pause")});La(["enter"]);const a=new Wa({x:120,y:248}),b=ja(20),c=new Xa(void 0);X(["enter"],()=>c.Ga());let d=0,e=0,k=0,f=!0,r=!1,p=ma(d);const t=I({create:ta,m:400}),J=I({create:ka,m:40}),K=I({create:ka,m:400}),v=I({create:Na,m:10}),C=I({create:Pa,m:50}),
L=I({create:Qa,m:4}),O=I({create:Sa,m:4}),F=A({text:"SCORE 00000",x:8,y:8}),U=A({x:224,y:8,text:"@@@",color:"red"}),M=A({x:128,y:120,text:"LEVEL 1",align:"center",color:"lightgreen"}),aa=new N({x:192,y:8,width:24,height:8,anchor:{x:0,y:0},v(){const g=this.context,l=0<=a.h?a.h/5:0;g.strokeStyle="white";g.lineWidth=2;g.strokeRect(0,0,this.width,this.height);g.fillStyle="green";25>a.h&&(g.fillStyle="red");g.fillRect(2,2,l,this.height-4)}});u("hit",()=>{P(...[2.3,,330,,.06,.17,2,3.7,,,,,.05,.4,2,.5,.13,
.89,.05,.17])});u("explosion",(g,l,m,w,n)=>{P(...[,,45,.03,.21,.6,4,.9,2,-3,,,,.2,,.9,,.45,.26]);for(let y=0;y<m;y++)0==y%2&&t.get({x:g,y:l,dx:E(-1,1)/2,dy:E(-1,1)/2,color:null,g:30}),t.get({x:g,y:l,dx:E(-w/2,w/2),dy:E(-w/2,w/2),color:n,g:30*w})});u("ship-fire",(g,l,m)=>{P(...[.9,,413,,.05,.01,1,3.8,-3,-13.4,,,,,,,.11,.65,.07,,237]);J.get({name:"ship-bullet",x:g,y:l,width:2,height:4,dy:-4,dx:m,color:null,l:17,g:100,update(){this.advance();0>this.y&&(this.g=0)}})});u("enemy-fire",(g,l)=>{P(...[.9,
,413,,.05,.01,1,3.8,-3,-13.4,,,,,,,.11,.65,.07,,237]);const m=a.x-4-g,w=a.y-4-l,n=Math.hypot(m,w)/1;K.get({name:"enemy-bullet",x:g+4,y:l+4,dx:m/n,dy:w/n,width:2,height:2,color:"red",g:200})});u("boss-fire",(g,l)=>{P(...[.9,,413,,.05,.01,1,3.8,-3,-13.4,,,,,,,.11,.65,.07,,237]);for(let m=0;12>m;m++)K.get({name:"enemy-bullet",x:g,y:l,dx:1*Math.cos(30*m*Math.PI/180),dy:1*Math.sin(30*m*Math.PI/180),width:2,height:2,color:"red",g:400})});u("score",g=>{a.J+=g});u("spawn-boss",(g,l,m,w,n,y,Q,R,D,x)=>{r=!1;
g=L.get({l:g,h:l,V:m,rotate:!1,loop:!0,j:!0,Y:"pink",sa:D,ra:n,path:qa(w)});h("spawn-enemy",y,0,{l:Q,h:2,V:x,Ca:R,parent:g,path:null})});u("spawn-enemy",(g,l,m)=>{const w=1<(e+1)/(d+1)?Math.floor((e+1)/(d+1)*m.h*.2):0;for(let n=0;n<g;n++)q(y=>{C.get({...m,qa:y*Math.PI/180,h:m.h+w})},n*l,360/g*n)});u("spawn-asteroid",(g,l,m,w,n)=>{const y=1<(e+1)/(d+1)?Math.floor((e+1)/(d+1)*2):0;let Q=0;for(let R=0;R<g;R++)Q>m.length-1&&(Q=0),q((D,x)=>{v.get({x:m[x],y:-8,dx:w[x],dy:n[x],h:10+y})},R*l,R,Q),Q++});u("spawn-powerup",
(g,l,m)=>{O.get({type:g,x:l,y:-8,dy:m})});u("set-dialog",(g,l)=>{c.start({D:l,ba:g})});u("next-level",g=>{d=g;e++;k=0;f=!1;p=ma(g)});u("boss-die",()=>{h("score",200);d++;d>=xa&&(d=0);h("next-level",d)});u("game-over",()=>{const g=localStorage.getItem("hiScore")||0;a.J>g&&localStorage.setItem("hiScore",a.J);h("change-scene","game-over",{J:a.J,Fa:g})});const T=new ba(void 0),z=new ba(void 0),B=new ba(void 0);return new oa({children:[b,F,U,J,K,a,C,L,v,O,t,aa,c,M],update(){this.paused=!1;if(c.ha&&c.ba)c.update(),
this.paused=!0;else{40>k&&(M.text=`LEVEL ${e+1}`,M.g=100);var g=C.size+v.size;k===p&&(r=!0);Ua(k,d,g,r);0>=a.ia?h("game-over"):(J.A().forEach(l=>{T.clear();T.add(l,v.A(),C.A(),L.A());la(l,T.get(l))}),z.clear(),z.add(a,v.A(),C.A(),K.A(),L.A(),O.A()),la(a,z.get(a)),B.clear(),B.add(v.A()),v.A().forEach(l=>{la(l,B.get(l))}),F.text=`SCORE ${a.J}`,U.text="@@@".slice(0,a.ia),f&&40<k&&140>k&&0===k%20&&b.ta(),k++)}}})}function ya(){X(["enter"],()=>{h("change-scene","game")});const a=ja(20),b=A({x:128,y:32,
text:"MICRO SHOOTER",align:"center",color:"red",s:2,H:4}),c=A({x:128,y:88,text:"JS13K 2024 EDITION",align:"center",color:"yellow"}),d=A({x:128,y:128,text:"A GAME BY\nMARCO FERNANDES",lineHeight:16,color:"white",align:"center"}),e=A({x:128,y:176,text:"ARROWS OR WASD TO MOVE\nSPACE TO SHOOT",lineHeight:16,align:"center"}),k=A({x:128,y:224,text:"ENTER TO START",color:"lightgreen",align:"center"}),f=new oa({frame:0,children:[a,k],update(){40<this.frame&&140>this.frame&&0===this.frame%20&&a.ta();this.frame++}});
q(()=>{f.add(b)},1E3);q(()=>{f.add(c)},2E3);q(()=>{f.add(d)},3E3);q(()=>{f.add(e)},4E3);return f}function Ya({J:a=0,Fa:b=localStorage.getItem("hiScore")||0}={}){X(["enter"],()=>{h("change-scene","menu")});u("explosion",(J,K,v,C,L)=>{P(...[,,45,.03,.21,.6,4,.9,2,-3,,,,.2,,.9,,.45,.26]);for(let O=0;O<v;O++)d.get({x:J,y:K,dx:E(-C/2,C/2),dy:E(-C/2,C/2),color:L,g:30*C})});const c=ja(1),d=I({create:ta,m:400}),e=A({x:128,y:32,text:"GAME OVER",align:"center",color:"red",s:2,H:4}),k=A({x:128,y:80,text:"YOUR SCORE:",
color:"white",align:"center"}),f=A({x:128,y:96,text:`${a}`,color:"white",align:"center",s:2,H:2}),r=A({x:128,y:128,text:"NEW HIGH SCORE!",color:"yellow",align:"center"}),p=A({x:128,y:224,text:"ENTER TO CONTINUE",color:"lightgreen",align:"center"}),t=new oa({frame:0,children:[c,p,d]});q(()=>{t.add(e);h("explosion",128,48,100,6,"red")},1E3);q(()=>{t.add(k)},2E3);q(()=>{t.add(f)},2500);a>b&&q(()=>{t.add(r);h("explosion",128,132,60,4,"yellow")},3E3);return t}let S={},G={};class N{constructor(a){this.i(a)}i(a=
{}){Object.assign(this,{name:"",x:0,y:0,width:8,height:8,rotation:0,s:1,H:1,anchor:{x:0,y:0},color:"white",dx:0,dy:0,U:0,R:0,g:Infinity,frame:0,l:0,context:window.T.context,u:[G["spritesheet.png"],8,8],h:20,W:!1,M:a.update,ga:a.C,pa:a.v,...a})}S(a){h("hit");this.h-=a;this.W=!0;0>=this.h&&this.F&&this.F();q(()=>this.W=!1,100)}advance(){this.x+=this.dx;this.y+=this.dy;this.dx+=this.U;this.dy+=this.R;this.g--;this.frame++}update(){this.M?this.M():this.advance()}C(){if(this.ga)return this.ga();const a=
this.context,b=this.x,c=this.y,d=this.anchor,e=this.rotation,k=this.s,f=this.H,r=this.width,p=this.height;a.save();a.translate(b,c);e&&a.rotate(e);k&&f&&a.scale(k,f);a.translate(-r*d.x,-p*d.y);this.v();a.restore()}v(){if(this.pa)return this.pa();const a=this.context,b=this.color,c=this.width,d=this.height;this.W&&(a.save(),a.translate(0,-1));this.color?(a.fillStyle=b,a.fillRect(0,0,c,d)):a.drawImage(this.u[0],this.l*this.u[1],0,c,d,0,0,c,d);this.W&&(a.globalCompositeOperation="source-atop",a.fillStyle=
"white",a.fillRect(0,0,c,d),a.globalCompositeOperation="source-over",a.restore())}B(){return 0<this.g}}const ka=a=>new N(a);class oa{constructor(a){this.i(a)}i(a={}){const b=Object.keys(a).reduce((c,d)=>{"function"!==typeof a[d]&&(c[d]=a[d]);return c},{});Object.assign(this,{id:"scene",context:window.T.context,M:a.update,ga:a.C,children:[],paused:!1,...b})}add(a){this.children.push(a)}pause(){this.paused=!0}resume(){this.paused=!1}update(a){this.paused||(this.children.forEach(b=>{if(!b.B)return b.update(a);
b.B()&&b.update(a)}),this.M&&this.M())}C(){this.context.save();this.M&&this.M();this.children.forEach(a=>{if(!a.B)return a.C();a.B()&&a.C()});this.context.restore()}}class Ga extends N{constructor(a={}){super({name:"text",x:0,y:0,text:"",color:"white",align:"left",lineHeight:8,scale:1,u:G["font.png"],...a})}v(){const a=this.text.split("\n"),b=this.context,c=this.align,d=this.lineHeight,e=this.color;b.save();a.forEach(k=>{b.save();"center"===c&&b.translate(8*-k.length/2,0);"right"===c&&b.translate(8*
-k.length,0);for(let r=0;r<k.length;r++){var f=k.charCodeAt(r);let p=0;65<=f&&90>=f?p=f-65:null;48<=f&&57>=f?p=f-22:null;32===f&&(p=-1);46===f&&(p=36);44===f&&(p=37);63===f&&(p=38);33===f&&(p=39);58===f&&(p=40);64===f&&(p=41);-1!==p&&(f=8*r,b.drawImage(this.u,8*p,0,8,8,f,0,8,8),b.globalCompositeOperation="source-atop",b.fillStyle=e||"white",b.fillRect(f,0,8,8),b.globalCompositeOperation="source-over")}b.restore();b.translate(0,d)});b.restore()}}class Ha extends N{constructor(a){super({name:"explosion-particle",
color:"white",anchor:{x:.5,y:.5},...a})}update(){!this.color&&30>this.g&&(this.s=this.H=this.g/30);this.color&&60>this.g&&(this.s=this.H=this.g/60);this.advance()}v(){!this.color&&this.context.drawImage(this.u[0],128,0,8,8,0,0,8,8);this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,1,1))}}let fa={},ia={},ha={},V={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};class Wa extends N{i(a){super.i({name:"ship",
ca:!0,y:248,j:!1,Ba:!1,h:100,ia:3,J:0,N:0,G:!1,anchor:{x:.5,y:.5},l:1,...a});this.wa()}Ea(a){"shield"===a.type&&(this.h+=50,100<this.h&&(this.h=100));"fire"===a.type&&(this.N++,3<this.N&&(this.N=3))}Z(){this.G||(this.G=!0,h("ship-fire",this.x-1,this.y-8,E(-.3,.3)),0<this.N&&h("ship-fire",this.x-1,this.y-8,E(-.5,.5)),1<this.N&&q(()=>{h("ship-fire",this.x-1,this.y-8,E(-.3,.3));h("ship-fire",this.x-1,this.y-8,E(-.5,.5))},100),2<this.N&&q(()=>{h("ship-fire",this.x-1,this.y-8,-2);h("ship-fire",this.x-
1,this.y-8,2)},400),q(()=>{this.G=!1},200))}F(){h("explosion",this.x,this.y-4,60,4,"white");this.Ba=!0;this.g=0;this.ia--;this.j=!0;this.U=this.dx=0;this.x=128;q(()=>{this.wa()},1E3)}wa(){this.ca=this.j=!0;this.g=Infinity;this.y=248;this.frame=0;this.h=100;this.N=0;q(()=>{this.j=this.ca=!1},1E3)}update(){this.R=this.U=0;this.dx*=.96;this.dy*=.96;this.l=1;W(["d","arrowright"])&&5>this.dx&&(this.U=.2,this.l=2);W(["a","arrowleft"])&&-5<this.dx&&(this.U=-.2,this.l=0);this.ca||(W(["s","arrowdown"])&&5>
this.dy&&(this.R=.2),W(["w","arrowup"])&&-5<this.dy&&(this.R=-.2));!this.G&&W("space")&&this.Z();this.ca&&(this.R=-.03,this.s=this.H=Math.min(Math.max(1,2-this.frame/60),2));0>=this.h&&this.F();this.advance();4>this.x&&(this.x=4,this.dx=0);252<this.x&&(this.x=252,this.dx=0);4>this.y&&(this.y=4,this.dy=0);236<this.y&&(this.y=236,this.dy=0)}v(){const a=this.context,b=this.width,c=this.height;a.drawImage(this.u[0],this.u[1]*this.l,0,b,c,0,0,b,c);let d=1;0>this.R&&(d=5>this.frame%10?2:3);a.fillStyle=
"#FFaa33";a.fillRect(3,7,2,d);a.fillStyle="#FF6633";a.fillRect(5>this.frame%10?3:4,7+d,1,d);this.W&&(a.globalCompositeOperation="source-atop",a.fillStyle="white",a.fillRect(0,0,b,c),a.globalCompositeOperation="source-over")}}class Ma{constructor({create:a,m:b=1024}={}){let c;if(!(a&&(c=a({id:""}))&&c.update&&c.i&&c.B&&c.C))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this.oa=a;this.o=[a({id:""})];this.size=0;this.m=
b}get(a={}){if(this.size==this.o.length){if(this.size==this.m)return;for(var b=0;b<this.size&&this.o.length<this.m;b++)this.o.push(this.oa())}b=this.o[this.size];this.size++;b.i(a);return b}A(){return this.o.slice(0,this.size)}clear(){this.size=this.o.length=0;this.o.push(this.oa())}update(a){let b,c=!1;for(let d=this.size;d--;)b=this.o[d],b.update(a),b.B()||(c=!0,this.size--);c&&this.o.sort((d,e)=>e.B()-d.B())}C(){for(let a=this.size;a--;)this.o[a].C()}}let pa=new AudioContext,P=(a=1,b=.05,c=220,
d=0,e=0,k=.1,f=0,r=1,p=0,t=0,J=0,K=0,v=0,C=0,L=0,O=0,F=0,U=1,M=0,aa=0,T=0)=>{let z=Math,B=2*z.PI,g=p*=500*B/44100/44100,l=c*=(1-b+2*b*z.random(b=[]))*B/44100,m=0,w=0,n=0,y=1,Q=0,R=0,D=0,x=0>T?-1:1;var H=B*x*T*2/44100,Y=z.cos(H);let Z=z.sin;var ca=Z(H)/4;H=1+ca;let Za=-2*Y/H;ca=(1-ca)/H;let za=(1+x*Y)/2/H;Y=-(x+Y)/H;let Aa=0,Ba=0,Ca=0,Da=0;d=44100*d+9;M*=44100;e*=44100;k*=44100;F*=44100;t*=500*B/44100**3;L*=B/44100;J*=B/44100;K*=44100;v=44100*v|0;a*=.3;for(x=d+M+e+k+F|0;n<x;b[n++]=D*a)++R%(100*O|0)||
(D=f?1<f?2<f?3<f?Z(m**3):z.max(z.min(z.tan(m),1),-1):1-(2*m/B%2+2)%2:1-4*z.abs(z.round(m/B)-m/B):Z(m),D=(v?1-aa+aa*Z(B*n/v):1)*(0>D?-1:1)*z.abs(D)**r*(n<d?n/d:n<d+M?1-(n-d)/M*(1-U):n<d+M+e?U:n<x-F?(x-n-F)/k*U:0),D=F?D/2+(F>n?0:(n<x-F?1:(x-n)/F)*b[n-F|0]/2/a):D,T?D=Da=za*Aa+Y*(Aa=Ba)+za*(Ba=D)-ca*Ca-Za*(Ca=Da):0),H=(c+=p+=t)*z.cos(L*w++),m+=H+H*C*Z(n**5),y&&++y>K&&(c+=J,l+=J,y=0),!v||++Q%v||(c=l,p=g,y=y||1);a=pa.createBuffer(1,x,44100);a.getChannelData(0).set(b);c=pa.createBufferSource();c.buffer=
a;c.connect(pa.destination);c.start()};class Oa extends N{i(a){super.i({name:"asteroid",u:[G["spritesheet16.png"],16,16],l:2,width:16,height:16,color:null,anchor:{x:.5,y:.5},h:10,...a})}F(){h("explosion",this.x,this.y,50,4,"white");h("score",10);this.g=0}update(){this.rotation=this.frame/(10/this.dy);this.advance();0>this.x||264<this.x||248<this.y&&(this.g=0)}}class ba{constructor({$:a=3,aa:b=25,I:c}={}){this.$=a;this.aa=b;a=window.T.context.canvas;this.I=c||{x:0,y:0,width:a.width,height:a.height};
this.X=!1;this.fa=0;this.P=[];this.L=[]}clear(){this.L.map(a=>{a.clear()});this.X=!1;this.P.length=0}get(a){let b=new Set;for(;this.L.length&&this.X;)return va(a,this.I).map(c=>{this.L[c].get(a).map(d=>b.add(d))}),Array.from(b);return this.P.filter(c=>c!==a)}add(...a){a.flat().map(b=>{this.X?this.na(b):(this.P.push(b),this.P.length>this.aa&&this.fa<this.$&&(this.Aa(),this.P.map(c=>this.na(c)),this.P.length=0))})}na(a){va(a,this.I).map(b=>{this.L[b].add(a)})}Aa(){var a;this.X=!0;if(!this.L.length){var b=
this.I.width/2|0;var c=this.I.height/2|0;for(a=0;4>a;a++)this.L[a]=new ba({I:{x:this.I.x+(1==a%2?b:0),y:this.I.y+(2<=a?c:0),width:b,height:c},$:this.$,aa:this.aa}),this.L[a].fa=this.fa+1}}}class wa extends N{i(a){a={name:"enemy",l:3,color:null,anchor:{x:.5,y:.5},h:1,frame:0,loop:!0,ua:!0,Y:"white",V:200,...a};super.i(a);this.path&&(this.g=Math.floor(a.path.getTotalLength()));this.loop&&(this.g=Infinity)}Z(){h("enemy-fire",this.x-4,this.y-4,this.rotation,3)}F(){h("explosion",this.x,this.y,30,3,this.Y);
h("score",10);this.g=0}update(){this.rotation=180*Math.PI/180;if(this.path){const a=this.path.getPointAtLength(this.frame),b=this.path.getPointAtLength(this.frame+1);this.x=Math.floor(a.x);this.y=Math.floor(a.y);this.rotate&&(this.rotation=90*Math.PI/180+Math.atan2(b.y-a.y,b.x-a.x))}else this.x=this.parent.x+Math.cos(this.frame/this.parent.sa+this.qa)*this.parent.ra,this.y=this.parent.y+Math.sin(this.frame/this.parent.sa+this.qa)*this.parent.ra;this.ua&&(this.s=this.H=Math.min(Math.max(0,(this.frame+
1)/100),1));!this.loop&&100>this.g&&(this.s=this.H=Math.min(Math.max(0,this.g/100),1));1>this.s&&(this.j=!0);1<=this.s&&(this.j=!1);1==this.s&&0===this.frame%this.V&&this.Z();this.path&&this.frame>=this.path.getTotalLength()&&this.loop&&(this.frame=0,this.ua=!1);this.frame++;this.g--}}class Ra extends wa{i(a){super.i({name:"boss",u:[G["spritesheet16.png"],16,16],l:0,width:16,height:16,color:null,h:10,Y:"white",V:200,G:!1,loop:!1,j:!0,ja:!1,ea:[],...a});this.va=this.h}S(a){super.S(a);this.ja=!0;q(()=>
{this.ja=!1},1E3)}Z(){this.G=!0;this.j=!1;this.ea[0]=q(()=>{h("boss-fire",this.x,this.y,this.rotation,3)},400);this.ea[1]=q(()=>{h("boss-fire",this.x,this.y,this.rotation,3)},800);this.ea[2]=q(()=>{h("boss-fire",this.x,this.y,this.rotation,3)},1200);q(()=>{this.G=!1;this.j=!0},1600)}F(){h("explosion",this.x,this.y,30,3,this.Y);h("score",10);this.g=0;this.ea.map(a=>clearTimeout(a));h("boss-die")}update(){!this.G&&super.update();!this.G&&(this.j=!0)}v(){super.v();if(this.ja){var a=this.context,b=20*
this.h/this.va;a.save();a.translate(this.width/2,this.height/2);a.rotate(-this.rotation);a.fillStyle="white";a.fillRect(-12,-16,24,6);a.fillStyle="black";a.fillRect(-11,-15,22,4);a.fillStyle="green";this.h<this.va/4&&(a.fillStyle="red");a.fillRect(-10,-14,b,2);a.restore()}}}class Xa extends N{i(a){a={name:"dialog",x:-16,y:200,xa:[10,11,12,13,14],text:A({text:"",x:16,y:8,align:"left"}),K:0,D:[],O:0,da:0,frame:0,anchor:{x:0,y:0},ma:!1,ha:!1,ka:!1,ba:!0,...a};super.i(a)}Ga(){0==this.D.length||this.O>
this.D.length||(this.K=this.D[this.O].length)}start(a){this.ka=!1;setTimeout(()=>{this.ha=!0;this.D=["",...a.D];this.frame=0;this.ba=a.ba},1E3);this.dx=2}stop(){this.ka=!0;this.text.text="        ";this.ha=!1;setTimeout(()=>{this.D=[];this.frame=this.K=this.O=0},1E3);this.dx=-2}update(){8<this.x&&(this.dx=0,this.x=8);-16>this.y&&(this.dx=0,this.x=-16);if(0!=this.D.length){this.ma=!1;var a=this.D[this.O]+"      ";" "!==a[this.K]&&(this.ma=!0);0==this.frame%5&&(this.K++," "!==a[this.K]&&P(...[1.5,,
261,.01,.02,.08,1,1.5,-.5,,,-.5,,,,,.9,.05]));this.O<this.D.length&&(this.text.text=a.slice(0,this.K));this.frame++;this.K>=a.length&&(this.O++,this.K=this.frame=0);this.O>=this.D.length&&!this.ka&&this.stop();this.ma&&0==this.frame%5&&this.da++;this.da>=this.xa.length&&(this.da=0);super.update()}}v(){const a=this.context,b=this.u;a.fillStyle="white";a.fillRect(-2,-2,12,12);a.drawImage(b[0],8*this.xa[this.da],0,8,8,0,0,8,8);a.translate(16,0);this.text.v()}}class Ta extends N{i(a){super.i({name:"powerup",
type:"fire",width:16,height:16,la:!1,g:600,anchor:{x:.5,y:.5},u:[G["font.png"],8,8],...a})}F(){this.la=!0;this.g=10;this.frame=0;P(...[1.5,,1E3,,.1,.1,1,1.5,,,,,,,,.1,.5,.1])}v(){const a=this.context,b=this.type,c=this.la,d=this.frame;let e,k;"shield"===b&&(e="yellow",k=18);"fire"===b&&(e="lightblue",k=15);a.strokeStyle=e;a.lineWidth=2;10>d%20&&!c&&a.strokeRect(0,0,16,16);a.fillStyle=e;a.fillRect(3,3,10,10);a.drawImage(this.u[0],8*k,0,8,8,4,4,8,8);c&&(a.globalAlpha=1-this.frame/10,a.strokeRect(-this.frame,
-this.frame,16+2*this.frame,16+2*this.frame),a.globalAlpha=1)}}const na=[[{500:[1,1E3,6,!1,!1,1,0,130,"M287 13-21 61l293 46-293 31 293 48-290 52"]},{},{500:["fire",128,.6]},{500:[!1,["A FULL WAVE IS IMINENT","    "]]},[0,10,250,"M127 120V43c0-77 99 8 99 77 0 70-35 102-99 102S22 181 22 120s32-84 84-84 85 32 85 84c0 53-28 62-64 62-35 0-68-18-68-62 0-43 25-47 47-47 21 0 48 24 48 47 0 24-7 28-27 28s0-14 0-28Z",30,8,3,0,30,250]],[{2E3:[3,1E3,3,!0,!1,1,0,200,"M223-33v238c0 42-61 41-61 0V41c0-44-64-44-64 0v164c0 43-71 33-71 0V-27"],
1E3:[5,1500,6,!1,!1,1,0,130,"M287 13-21 61l293 46-293 31 293 48-290 52"]},{},{500:["fire",128,.6],550:["shield",140,.3]},{},[0,10,200,"M127 120V43c0-77 99 8 99 77 0 70-35 102-99 102S22 181 22 120s32-84 84-84 85 32 85 84c0 53-28 62-64 62-35 0-68-18-68-62 0-43 25-47 47-47 21 0 48 24 48 47 0 24-7 28-27 28s0-14 0-28Z",40,32,9,1,60,250]]],xa=na.length,da=function(a){window.T=window.T||{};return window.T.context=a}(document.getElementById("c").getContext("2d"));da.imageSmoothingEnabled=!1;da.setTransform(1,
0,0,1,0,0);da.filter="url(#remove-alpha)";(async()=>{Ka();await ea("font.png");await ea("spritesheet.png");await ea("spritesheet16.png");u("change-scene",(b,c)=>{Fa(["change-scene"]);da.filter="url(#remove-alpha)";switch(b){case "game":a=Va();break;case "menu":a=ya();break;case "game-over":console.log("game-over",c),a=Ya(c)}});let a=ya();Ea({update(b){a.update(b)},C(){a.C()}}).start()})()})();

(function(){function ta(a){const b=document.createElementNS("http://www.w3.org/2000/svg","svg"),c=document.createElementNS("http://www.w3.org/2000/svg","path");b.appendChild(c);c.setAttribute("d",a);c.setAttribute("fill","none");c.setAttribute("stroke","black");c.setAttribute("stroke-width","2");c.setAttribute("id","path");return c}function ua(a){let {x:b=0,y:c=0,width:d,height:e}=a;b-=.5*d;c-=.5*e;0>d&&(b+=d,d*=-1);0>e&&(c+=e,e*=-1);return{x:b,y:c,width:d,height:e}}function q(a,b,...c){return setTimeout(a,
b,...c)}function G(a=0,b=1){return Math.random()*(b-a)+a}function Ga({update:a,o:b}){function c(){requestAnimationFrame(c);p=performance.now();l=p-f;f=p;if(!(1E3<l)){for(d+=l;d>=e;)a(k),d-=e;t.clearRect(0,0,t.canvas.width,t.canvas.height);b()}}let d=0,e=1E3/60,k=1/60,f,p,l;const t=window.U.context;return{start(){f=performance.now();requestAnimationFrame(c)}}}function w(a,b){Y[a]=Y[a]||[];Y[a].push(b)}function Ha(a=[]){Y=Object.keys(Y).reduce((b,c)=>{a.includes(c)&&(b[c]=Y[c]);return b},{})}function h(a,
...b){(Y[a]||[]).map(c=>c(...b))}function va(a,b){return(new URL(a,b)).href}function wa(){window.Ca||(window.Ca={Pa:va,La:R,d:D})}function W(a,b,c){wa();if(D[a])return D[a];D[a]=b(...c)}function ja(a){wa();return new Promise((b,c)=>{let d,e;if(R[a])return b(R[a]);d=new Image;d.onload=()=>{e=va(a,window.location.href);R[e]=R[a]=d;b(d)};d.onerror=()=>{c()};d.src=a})}function H(a){return new Ia(a)}function xa(a){return new Ja(a)}function ya(a=()=>{},b){a.Da&&b.preventDefault();a(b)}function Ka(a){let b=
da[a.code],c=ka[b];la[b]=!0;ya(c,a)}function La(a){let b=da[a.code],c=ma[b];la[b]=!1;ya(c,a)}function Ma(){let a;for(a=0;26>a;a++)da["Key"+String.fromCharCode(a+65)]=String.fromCharCode(a+97);for(a=0;10>a;a++)da["Digit"+a]=da["Numpad"+a]=""+a;window.addEventListener("keydown",Ka);window.addEventListener("keyup",La)}function ea(a){return!![].concat(a).some(b=>la[b])}function aa(a,b,{Ha:c="keydown",preventDefault:d=!0}={}){let e="keydown"==c?ka:ma;b.Da=d;[].concat(a).map(k=>e[k]=b)}function za(a,{Ha:b=
"keydown"}={}){let c="keydown"==b?ka:ma;[].concat(a).map(d=>delete c[d])}function S(a){return new Na(a)}function na(a=1){const b=S({create:oa,s:241});b.Ma=function(c){this.u.forEach(d=>{d.dy*=c})};b.va=function(){this.u.forEach(c=>{c.dy/=2})};b.Qa=a;for(let c=0;240>c;c++){const d=G(1,3)*a,e=Math.floor(d/a*50)+50;b.get({x:Math.floor(G(0,256)),y:c,width:1,height:1,dy:d/4,color:`rgb(${e}, ${e}, ${e})`,update(){this.advance();240<this.y&&(this.y=0)}})}b.F=()=>!0;return b}function Oa(a){return new Pa(a)}
function Aa(a,b){let c=[],d=b.x+b.width/2;var e=b.y+b.height/2;b=a.y<e;e=a.y+a.height>=e;a.x<d&&(b&&c.push(0),e&&c.push(2));a.x+a.width>=d&&(b&&c.push(1),e&&c.push(3));return c}function Qa(a){return new Ba(a)}function Ra(a){return new Sa(a)}function pa(a,b){a.F()&&b.forEach(c=>{var d;if(d="enemy"!==a.name||"enemy"!==c.name)if(d=c.F()&&!a.m&&!c.m){d=ua(c);let e=ua(a);d=d.x<e.x+e.width&&d.x+d.width>e.x&&d.y<e.y+e.height&&d.y+d.height>e.y}d&&("ship-bullet"!=a.name||c.m||(a.g=0,c.T(1)),"ship"!=a.name||
"asteroid"!=c.name&&"boss"!=c.name||(a.G(),a.g=0,c.T(5)),"ship"==a.name&&"enemy"==c.name&&(c.G(),c.g=0,a.T(50)),"ship"==a.name&&"enemy-bullet"==c.name&&(c.g=0,a.T(10)),"ship"!=a.name||"powerup"!=c.name||c.na||(c.G(),a.Ia(c)))})}function Ta(a){return new Ua(a)}function qa(a){a=ra[a];let b=Math.max(...Object.keys(a[0]),...Object.keys(a[1])),c=a[0][b];c??=a[1][b];return b+=c[1]/1E3*60*c[0]}function Va(a=0,b=0,c=0,d=!1){const e=ra[b],k=qa(b);if(e[0][a]){const f=e[0][a];h("spawn-enemy",f[0],f[1],{l:f[2],
rotate:f[3],loop:f[4],h:f[5],Ga:f[6],W:f[7],path:ta(f[8])})}e[1][a]&&h("spawn-asteroid",...e[1][a]);e[2][a]&&h("spawn-powerup",...e[2][a]);e[3][a]&&h("set-dialog",...e[3][a]);0===e[4].length&&a>=k&&0===c&&h("next-level",b+1>=Ca?0:b+1);0<e[4].length&&d&&0===c&&h("spawn-boss",...e[4])}function Wa(){aa(["esc"],()=>{h("change-scene","menu")});aa(["p"],()=>{h("pause")});aa(["m"],()=>{ba.ka?ba.stop():ba.start()});za(["enter"]);aa(["enter"],()=>c.Ka());ba.set("song1");ba.start();const a=new Xa({x:120,y:248}),
b=na(20),c=new Da(void 0),d=new Da(void 0);let e=0,k=0,f=3<k?Math.floor(.5*k):0,p=0,l=!0,t=!1,C=qa(e),K=!1;const E=S({create:xa,s:400}),y=S({create:oa,s:40}),F=S({create:oa,s:400}),z=S({create:Oa,s:10}),v=S({create:Qa,s:50}),N=S({create:Ra,s:4}),L=S({create:Ta,s:4}),T=H({text:"SCORE 00000",x:8,y:8}),A=H({x:224,y:8,text:"@@@",color:"red"}),U=H({x:128,y:120,text:"LEVEL 1",align:"center",color:"lightgreen"}),Z=new O({x:192,y:8,width:24,height:8,anchor:{x:0,y:0},j(){const g=this.context,m=0<=a.h?a.h/
5:0;g.strokeStyle="white";g.lineWidth=2;g.strokeRect(0,0,this.width,this.height);g.fillStyle="green";25>a.h&&(g.fillStyle="red");g.fillRect(2,2,m,this.height-4)}}),Q=new O({x:0,y:0,active:!1,K:384,update(){},j(){const g=this.context;g.save();g.beginPath();g.strokeStyle="white";g.lineWidth=3;g.arc(a.x,a.y,this.K,0,2*Math.PI,!0);g.clip();g.stroke()},start(){P(D.transition);this.K=384;this.active=!0},end(){P(D.transition);this.active=!1},update(){this.active&&60<this.K&&(this.K-=2);!this.active&&384>
this.K&&(this.K+=1);this.advance()},o(){this.j()}}),I=new O({x:0,y:0,update(){},j(){this.context.restore()},o(){this.j()}});w("hit",()=>{P(D.hit)});w("explosion",(g,m,n,u,B)=>{P(D.explosion);for(let M=0;M<n;M++)0==M%2&&E.get({x:g,y:m,dx:G(-1,1)/2,dy:G(-1,1)/2,color:null,g:30}),E.get({x:g,y:m,dx:G(-u/2,u/2),dy:G(-u/2,u/2),color:B,g:30*u})});w("ship-fire",(g,m,n)=>{P(D.shoot);y.get({name:"ship-bullet",x:g,y:m,width:2,height:4,dy:-4,dx:n,color:null,l:17,g:100,update(){this.advance();0>this.y&&(this.g=
0)}})});w("ship-die",()=>{h("spawn-powerup","fire",128,.6)});w("enemy-fire",(g,m)=>{P(D.shoot);const n=a.x-4-g,u=a.y-4-m,B=Math.hypot(n,u)/1;F.get({name:"enemy-bullet",x:g+4,y:m+4,dx:n/B,dy:u/B,width:2,height:2,color:"red",g:300})});w("boss-fire",(g,m)=>{P(D.shoot2);for(let n=0;12>n;n++)F.get({name:"enemy-bullet",x:g,y:m,dx:1*Math.cos(30*n*Math.PI/180),dy:1*Math.sin(30*n*Math.PI/180),width:2,height:2,color:"red",g:400})});w("score",g=>{a.L+=Math.floor(g+2*f)});w("spawn-boss",(g,m,n,u,B,M,ca,Ea,fa,
Ya)=>{t=!1;g=N.get({l:g,h:m,W:n,rotate:!1,loop:!0,m:!0,aa:"pink",ua:fa,ta:B,path:ta(u)});h("spawn-enemy",M,0,{l:ca,h:2,W:Ya,Ga:Ea,parent:g,path:null})});w("spawn-enemy",(g,m,n)=>{g+=f;for(let u=0;u<g;u++){const B=Math.min(Math.max(1,n.l/4),2);q(M=>{v.get({...n,speed:B,sa:M*Math.PI/180,h:n.h+f})},u*m,360/g*u)}});w("spawn-asteroid",(g,m,n,u,B)=>{13===g&&(Q.start(),q(()=>Q.end(),15E3));let M=0;for(let ca=0;ca<g;ca++)M>n.length-1&&(M=0),q((Ea,fa)=>{z.get({x:n[fa],y:-8,dx:u[fa],dy:B[fa],h:10+f})},ca*m,
ca,M),M++});w("spawn-powerup",(g,m,n)=>{"shield"===g&&K||L.get({type:g,x:m,y:-8,dy:n})});w("set-dialog",(g,m)=>{g?d.start({B:m,Z:!0}):c.start({B:m,Z:!1})});w("next-level",g=>{t=!1;e=g;k++;p=0;l=!1;C=qa(g);f=3<k?Math.floor(.25*k):0;h("score",100);12===k&&h("level-13");25===k&&h("level-26")});w("boss-die",()=>{h("score",200);e++;e>=Ca&&(e=0);h("next-level",e)});w("game-over",()=>{const g=localStorage.getItem("hiScore")||0;a.L>g&&localStorage.setItem("hiScore",a.L);h("change-scene","game-over",{L:a.L,
Ja:g})});w("level-13",()=>{h("set-dialog",!0,["LETS MAKE THIS","INSTERESTING.","NOW WITH ONE LIFE ONLY"]);a.Y=1;a.h=100});w("level-26",()=>{h("set-dialog",!0,["HEY! YOU ARE GOOD AT THIS!","NOW ONE HIT AND YOU DIE!","AND NO SHIELD POWERUPS."]);a.Y=1;a.h=10;K=!0});const V=new ha(void 0),r=new ha(void 0),J=new ha(void 0);return new sa({children:[Q,b,y,F,a,v,N,z,L,E,I,c,d,Z,U,T,A],ya:!1,update(){this.paused=!1;if(d.ja&&d.Z)d.update(),this.paused=!0;else{40>p&&(U.text=`LEVEL ${k+1}`,U.g=100);var g=v.size+
z.size;p===C&&(t=!0);Va(p,e,g,t);0>=a.Y&&!this.ya?(this.ya=!0,q(()=>h("game-over"),1E3)):(y.D().forEach(m=>{V.clear();V.add(m,z.D(),v.D(),N.D());pa(m,V.get(m))}),r.clear(),r.add(a,z.D(),v.D(),F.D(),N.D(),L.D()),pa(a,r.get(a)),J.clear(),J.add(z.D()),z.D().forEach(m=>{pa(m,J.get(m))}),T.text=`SCORE ${a.L}`,A.text="@@@".slice(0,a.Y),l&&40<p&&140>p&&0===p%20&&b.va(),p++)}}})}function Fa(){aa(["enter"],()=>{h("change-scene","game")});za(["esc"]);const a=na(20),b=H({x:128,y:32,text:"MICRO SHOOTER",align:"center",
color:"red",v:2,I:4}),c=H({x:128,y:88,text:"JS13K 2024 EDITION",align:"center",color:"yellow"}),d=H({x:128,y:128,text:"A GAME BY\nMARCO FERNANDES",lineHeight:16,color:"white",align:"center"}),e=H({x:128,y:176,text:"ARROWS OR WASD TO MOVE\nSPACE TO SHOOT",lineHeight:16,align:"center"}),k=H({x:128,y:224,text:"ENTER TO START",color:"lightgreen",align:"center"}),f=new sa({frame:0,children:[a,k],update(){40<this.frame&&140>this.frame&&0===this.frame%20&&a.va();this.frame++}});q(()=>{f.add(b)},1E3);q(()=>
{f.add(c)},2E3);q(()=>{f.add(d)},3E3);q(()=>{f.add(e)},4E3);return f}function Za({L:a=0,Ja:b=localStorage.getItem("hiScore")||0}={}){aa(["enter"],()=>{h("change-scene","menu")});w("explosion",(C,K,E,y,F)=>{P(D.explosion);for(let z=0;z<E;z++)d.get({x:C,y:K,dx:G(-y/2,y/2),dy:G(-y/2,y/2),color:F,g:30*y})});const c=na(1),d=S({create:xa,s:400}),e=H({x:128,y:32,text:"GAME OVER",align:"center",color:"red",v:2,I:4}),k=H({x:128,y:80,text:"YOUR SCORE:",color:"white",align:"center"}),f=H({x:128,y:96,text:`${a}`,
color:"white",align:"center",v:2,I:2}),p=H({x:128,y:128,text:"NEW HIGH SCORE!",color:"yellow",align:"center"}),l=H({x:128,y:224,text:"ENTER TO CONTINUE",color:"lightgreen",align:"center"}),t=new sa({frame:0,children:[c,l,d]});q(()=>{t.add(e);h("explosion",128,48,100,6,"red")},1E3);q(()=>{t.add(k)},2E3);q(()=>{t.add(f)},2500);a>b&&q(()=>{t.add(p);h("explosion",128,132,60,4,"yellow")},3E3);return t}let Y={},R={},D={};class O{constructor(a){this.i(a)}i(a={}){Object.assign(this,{name:"",x:0,y:0,width:8,
height:8,rotation:0,v:1,I:1,anchor:{x:0,y:0},color:"white",dx:0,dy:0,V:0,S:0,g:Infinity,frame:0,l:0,context:window.U.context,A:[R["spritesheet.png"],8,8],h:20,X:!1,O:a.update,ia:a.o,ra:a.j,...a})}T(a){h("hit");this.h-=a;this.X=!0;0>=this.h&&this.G&&this.G();q(()=>this.X=!1,100)}advance(){this.x+=this.dx;this.y+=this.dy;this.dx+=this.V;this.dy+=this.S;this.g--;this.frame++}update(){this.O?this.O():this.advance()}o(){if(this.ia)return this.ia();const a=this.context,b=this.x,c=this.y,d=this.anchor,e=
this.rotation,k=this.v,f=this.I,p=this.width,l=this.height;a.save();a.translate(b,c);e&&a.rotate(e);k&&f&&a.scale(k,f);a.translate(-p*d.x,-l*d.y);this.j();a.restore()}j(){if(this.ra)return this.ra();const a=this.context,b=this.color,c=this.width,d=this.height;this.X&&(a.save(),a.translate(0,-1));this.color?(a.fillStyle=b,a.fillRect(0,0,c,d)):a.drawImage(this.A[0],this.l*this.A[1],0,c,d,0,0,c,d);this.X&&(a.globalCompositeOperation="source-atop",a.fillStyle="white",a.fillRect(0,0,c,d),a.globalCompositeOperation=
"source-over",a.restore())}F(){return 0<this.g}}const oa=a=>new O(a);class sa{constructor(a){this.i(a)}i(a={}){const b=Object.keys(a).reduce((c,d)=>{"function"!==typeof a[d]&&(c[d]=a[d]);return c},{});Object.assign(this,{id:"scene",context:window.U.context,O:a.update,ia:a.o,children:[],paused:!1,...b})}add(a){this.children.push(a)}pause(){this.paused=!0}resume(){this.paused=!1}update(a){this.paused||(this.children.forEach(b=>{if(!b.F)return b.update(a);b.F()&&b.update(a)}),this.O&&this.O())}o(){this.context.save();
this.O&&this.O();this.children.forEach(a=>{if(!a.F)return a.o();a.F()&&a.o()});this.context.restore()}}class Ia extends O{constructor(a={}){super({name:"text",x:0,y:0,text:"",color:"white",align:"left",lineHeight:8,scale:1,A:R["font.png"],...a})}j(){const a=this.text.split("\n"),b=this.context,c=this.align,d=this.lineHeight,e=this.color;b.save();a.forEach(k=>{b.save();"center"===c&&b.translate(8*-k.length/2,0);"right"===c&&b.translate(8*-k.length,0);for(let p=0;p<k.length;p++){var f=k.charCodeAt(p);
let l=0;65<=f&&90>=f?l=f-65:null;48<=f&&57>=f?l=f-22:null;32===f&&(l=-1);46===f&&(l=36);44===f&&(l=37);63===f&&(l=38);33===f&&(l=39);58===f&&(l=40);64===f&&(l=41);-1!==l&&(f=8*p,b.drawImage(this.A,8*l,0,8,8,f,0,8,8),b.globalCompositeOperation="source-atop",b.fillStyle=e||"white",b.fillRect(f,0,8,8),b.globalCompositeOperation="source-over")}b.restore();b.translate(0,d)});b.restore()}}class Ja extends O{constructor(a){super({name:"explosion-particle",color:"white",anchor:{x:.5,y:.5},...a})}update(){!this.color&&
30>this.g&&(this.v=this.I=this.g/30);this.color&&60>this.g&&(this.v=this.I=this.g/60);this.advance()}j(){!this.color&&this.context.drawImage(this.A[0],128,0,8,8,0,0,8,8);this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,1,1))}}let ka={},ma={},la={},da={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};const P=(...a)=>{let b=ia.createBufferSource(),c=ia.createBuffer(a.length,a[0].length,44100);a.map((d,
e)=>c.getChannelData(e).set(d));b.buffer=c;b.connect(ia.destination);b.start();return b},X=(a=1,b=.05,c=220,d=0,e=0,k=.1,f=0,p=1,l=0,t=0,C=0,K=0,E=0,y=0,F=0,z=0,v=0,N=1,L=0,T=0)=>{let A=2*Math.PI,U=l*=500*A/194481E4,Z=(0<F?1:-1)*A/4;b=c*=(1+2*b*Math.random()-b)*A/44100;let Q=[],I=0,V=0,r=0,J=1,g=0,m=0,n=0,u,B;d=99+44100*d;L*=44100;e*=44100;k*=44100;v*=44100;t*=500*A/44100**3;F*=A/44100;C*=A/44100;K*=44100;E=44100*E|0;for(B=d+L+e+k+v|0;r<B;Q[r++]=n)++m%(100*z|0)||(n=f?1<f?2<f?3<f?Math.sin((I%A)**3):
Math.max(Math.min(Math.tan(I),1),-1):1-(2*I/A%2+2)%2:1-4*Math.abs(Math.round(I/A)-I/A):Math.sin(I),n=(E?1-T+T*Math.sin(2*Math.PI*r/E):1)*(0<n?1:-1)*Math.abs(n)**p*a*.3*(r<d?r/d:r<d+L?1-(r-d)/L*(1-N):r<d+L+e?N:r<B-v?(B-r-v)/k*N:0),n=v?n/2+(v>r?0:(r<B-v?1:(B-r)/v)*Q[r-v|0]/2):n),u=(c+=l+=t)*Math.sin(V*F-Z),I+=u-u*y*(1-1E9*(Math.sin(r)+1)%2),V+=u-u*y*(1-1E9*(Math.sin(r)**2+1)%2),J&&++J>K&&(c+=C,b+=C,J=0),!E||++g%E||(c=b,l=U,J=J||1);return Q},ia=new (window.AudioContext||webkitAudioContext);class Xa extends O{i(a){super.i({name:"ship",
ea:!0,y:248,m:!1,Fa:!1,h:100,Y:3,L:0,C:0,H:!1,wa:null,anchor:{x:.5,y:.5},l:1,...a});this.Aa()}Ia(a){P(D.powerup);"shield"===a.type&&(this.h+=50,100<this.h&&(this.h=100));"fire"===a.type&&(this.C++,4<this.C&&(this.C=4),clearTimeout(this.wa),this.wa=q(()=>{4===this.C&&(this.C=3)},3E4))}ba(){this.H||(this.H=!0,h("ship-fire",this.x-1,this.y-8,G(-.3,.3)),0<this.C&&h("ship-fire",this.x-1,this.y-8,G(-.5,.5)),1<this.C&&q(()=>{h("ship-fire",this.x-1,this.y-8,G(-.3,.3));h("ship-fire",this.x-1,this.y-8,G(-.5,
.5))},100),2<this.C&&q(()=>{h("ship-fire",this.x-1,this.y-8,-2);h("ship-fire",this.x-1,this.y-8,2)},400),3<this.C&&q(()=>{h("ship-fire",this.x-16,this.y-4,G(-.1,.1));h("ship-fire",this.x+14,this.y-4,G(-.1,.1))},200),q(()=>{this.H=!1},200))}G(){h("ship-die");h("explosion",this.x,this.y-4,60,4,"white");this.Fa=!0;this.g=0;this.Y--;this.m=!0;this.V=this.dx=0;this.x=128;q(()=>{this.Aa()},1E3)}Aa(){this.ea=this.m=!0;this.g=Infinity;this.y=248;this.frame=0;this.h=100;this.C=0;q(()=>{this.m=this.ea=!1},
1E3)}update(){this.S=this.V=0;this.dx*=.96;this.dy*=.96;this.l=1;ea(["d","arrowright"])&&5>this.dx&&(this.V=.2,this.l=2);ea(["a","arrowleft"])&&-5<this.dx&&(this.V=-.2,this.l=0);this.ea||(ea(["s","arrowdown"])&&5>this.dy&&(this.S=.2),ea(["w","arrowup"])&&-5<this.dy&&(this.S=-.2));!this.H&&ea("space")&&this.ba();this.ea&&(this.S=-.03,this.v=this.I=Math.min(Math.max(1,2-this.frame/60),2));0>=this.h&&this.G();this.advance();4>this.x&&(this.x=4,this.dx=0);252<this.x&&(this.x=252,this.dx=0);4>this.y&&
(this.y=4,this.dy=0);236<this.y&&(this.y=236,this.dy=0)}j(){const a=this.context,b=this.width,c=this.height;a.drawImage(this.A[0],this.A[1]*this.l,0,b,c,0,0,b,c);let d=1;0>this.S&&(d=5>this.frame%10?2:3);a.fillStyle="#FFaa33";a.fillRect(3,7,2,d);a.fillStyle="#FF6633";a.fillRect(5>this.frame%10?3:4,7+d,1,d);4===this.C&&(a.fillStyle="#FFF",a.fillRect(18,4,2,2),a.fillRect(-12,4,2,2));this.X&&(a.globalCompositeOperation="source-atop",a.fillStyle="red",a.fillRect(0,0,b,c),a.globalCompositeOperation="source-over")}}
class Na{constructor({create:a,s:b=1024}={}){let c;if(!(a&&(c=a({id:""}))&&c.update&&c.i&&c.F&&c.o))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this.qa=a;this.u=[a({id:""})];this.size=0;this.s=b}get(a={}){if(this.size==this.u.length){if(this.size==this.s)return;for(var b=0;b<this.size&&this.u.length<this.s;b++)this.u.push(this.qa())}b=this.u[this.size];this.size++;b.i(a);return b}D(){return this.u.slice(0,this.size)}clear(){this.size=
this.u.length=0;this.u.push(this.qa())}update(a){let b,c=!1;for(let d=this.size;d--;)b=this.u[d],b.update(a),b.F()||(c=!0,this.size--);c&&this.u.sort((d,e)=>e.F()-d.F())}o(){for(let a=this.size;a--;)this.u[a].o()}}class Pa extends O{i(a){super.i({name:"asteroid",A:[R["spritesheet16.png"],16,16],l:2,width:16,height:16,color:null,anchor:{x:.5,y:.5},h:10,...a})}G(){h("explosion",this.x,this.y,50,4,"white");h("score",10);this.g=0}update(){this.rotation=this.frame/(10/this.dy);this.advance();0>this.x||
264<this.x||248<this.y&&(this.g=0)}}class ha{constructor({ca:a=3,da:b=25,J:c}={}){this.ca=a;this.da=b;a=window.U.context.canvas;this.J=c||{x:0,y:0,width:a.width,height:a.height};this.$=!1;this.ha=0;this.R=[];this.N=[]}clear(){this.N.map(a=>{a.clear()});this.$=!1;this.R.length=0}get(a){let b=new Set;for(;this.N.length&&this.$;)return Aa(a,this.J).map(c=>{this.N[c].get(a).map(d=>b.add(d))}),Array.from(b);return this.R.filter(c=>c!==a)}add(...a){a.flat().map(b=>{this.$?this.pa(b):(this.R.push(b),this.R.length>
this.da&&this.ha<this.ca&&(this.Ea(),this.R.map(c=>this.pa(c)),this.R.length=0))})}pa(a){Aa(a,this.J).map(b=>{this.N[b].add(a)})}Ea(){var a;this.$=!0;if(!this.N.length){var b=this.J.width/2|0;var c=this.J.height/2|0;for(a=0;4>a;a++)this.N[a]=new ha({J:{x:this.J.x+(1==a%2?b:0),y:this.J.y+(2<=a?c:0),width:b,height:c},ca:this.ca,da:this.da}),this.N[a].ha=this.ha+1}}}class Ba extends O{i(a){a={name:"enemy",l:3,color:null,anchor:{x:.5,y:.5},h:1,frame:0,loop:!0,xa:!0,aa:"white",W:200,speed:1,...a};super.i(a);
this.path&&(this.g=Math.floor(a.path.getTotalLength()/this.speed));this.loop&&(this.g=Infinity)}ba(){h("enemy-fire",this.x-4,this.y-4,this.rotation,3)}G(){h("explosion",this.x,this.y,30,3,this.aa);h("score",10);this.g=0}update(){this.rotation=180*Math.PI/180;if(this.path){const a=this.path.getPointAtLength(this.frame*this.speed),b=this.path.getPointAtLength(this.frame*this.speed+1);this.x=Math.floor(a.x);this.y=Math.floor(a.y);this.rotate&&(this.rotation=90*Math.PI/180+Math.atan2(b.y-a.y,b.x-a.x))}else this.x=
this.parent.x+Math.cos(this.frame/this.parent.ua+this.sa)*this.parent.ta,this.y=this.parent.y+Math.sin(this.frame/this.parent.ua+this.sa)*this.parent.ta;this.xa&&(this.v=this.I=Math.min(Math.max(0,(this.frame*this.speed+1)/100),1));!this.loop&&100>this.g&&(this.v=this.I=Math.min(Math.max(0,this.g/100),1));1>this.v&&(this.m=!0);1<=this.v&&(this.m=!1);1==this.v&&0===this.frame%this.W&&this.ba();this.path&&this.frame*this.speed>=this.path.getTotalLength()&&this.loop&&(this.frame=0,this.xa=!1);this.frame++;
this.g--}}class Sa extends Ba{i(a){super.i({name:"boss",A:[R["spritesheet16.png"],16,16],l:0,width:16,height:16,color:null,h:10,aa:"white",W:200,H:!1,loop:!1,m:!0,la:!1,ga:[],...a});this.za=this.h}T(a){super.T(a);this.la=!0;q(()=>{this.la=!1},1E3)}ba(){this.H=!0;this.m=!1;this.ga[0]=q(()=>{h("boss-fire",this.x,this.y,this.rotation,3)},400);this.ga[1]=q(()=>{h("boss-fire",this.x,this.y,this.rotation,3)},800);this.ga[2]=q(()=>{h("boss-fire",this.x,this.y,this.rotation,3)},1200);q(()=>{this.H=!1;this.m=
!0},1600)}G(){h("explosion",this.x,this.y,30,3,this.aa);h("score",10);this.g=0;this.ga.map(a=>clearTimeout(a));h("boss-die")}update(){!this.H&&super.update();!this.H&&(this.m=!0)}j(){super.j();if(this.la){var a=this.context,b=20*this.h/this.za;a.save();a.translate(this.width/2,this.height/2);a.rotate(-this.rotation);a.fillStyle="white";a.fillRect(-12,-16,24,6);a.fillStyle="black";a.fillRect(-11,-15,22,4);a.fillStyle="green";this.h<this.za/4&&(a.fillStyle="red");a.fillRect(-10,-14,b,2);a.restore()}}}
class Da extends O{i(a){a={name:"dialog",x:-16,y:200,Ba:[10,11,12,13,14],text:H({text:"",x:16,y:8,align:"left"}),M:0,B:[],P:0,fa:0,frame:0,anchor:{x:0,y:0},oa:!1,ja:!1,ma:!1,Z:!0,...a};super.i(a)}Ka(){0==this.B.length||this.P>this.B.length||(this.M=this.B[this.P].length)}start(a){this.ma=!1;setTimeout(()=>{this.ja=!0;this.B=["",...a.B];this.frame=0;this.Z=a.Z},1E3);this.dx=2}stop(){this.ma=!0;this.text.text="        ";this.ja=!1;setTimeout(()=>{this.B=[];this.frame=this.M=this.P=0},1E3);this.dx=-2}update(){8<
this.x&&(this.dx=0,this.x=8);-16>this.y&&(this.dx=0,this.x=-16);if(0!=this.B.length){this.oa=!1;var a=this.B[this.P]+"      ";" "!==a[this.M]&&(this.oa=!0);0==this.frame%5&&(this.M++," "!==a[this.M]&&P(D.typing));this.P<this.B.length&&(this.text.text=a.slice(0,this.M));this.frame++;this.M>=a.length&&(this.P++,this.M=this.frame=0);this.P>=this.B.length&&!this.ma&&this.stop();this.oa&&0==this.frame%5&&this.fa++;this.fa>=this.Ba.length&&(this.fa=0);super.update()}}j(){const a=this.context,b=this.A;a.fillStyle=
"white";a.fillRect(-2,-2,12,12);a.drawImage(b[0],8*this.Ba[this.fa],0,8,8,0,0,8,8);a.translate(16,0);this.text.j()}}class Ua extends O{i(a){super.i({name:"powerup",type:"fire",width:16,height:16,na:!1,anchor:{x:.5,y:.5},A:[R["font.png"],8,8],...a})}G(){this.na=!0;this.g=10;this.frame=0}update(){248<this.y&&(this.g=0);super.update()}j(){const a=this.context,b=this.type,c=this.na,d=this.frame;let e,k;"shield"===b&&(e="yellow",k=18);"fire"===b&&(e="lightblue",k=15);a.strokeStyle=e;a.lineWidth=2;10>d%
20&&!c&&a.strokeRect(0,0,16,16);a.fillStyle=e;a.fillRect(3,3,10,10);a.drawImage(this.A[0],8*k,0,8,8,4,4,8,8);c&&(a.globalAlpha=1-this.frame/10,a.strokeRect(-this.frame,-this.frame,16+2*this.frame,16+2*this.frame),a.globalAlpha=1)}}var x={Oa:"M127 120V43c0-77 99 8 99 77 0 70-35 102-99 102S22 181 22 120s32-84 84-84 85 32 85 84c0 53-28 62-64 62-35 0-68-18-68-62 0-43 25-47 47-47 21 0 48 24 48 47 0 24-7 28-27 28s0-14 0-28Z",Sa:"M287 13-21 61l293 46-293 31 293 48-290 52",Ta:"m-21 13 308 48-293 46 293 31-293 48 291 52",
Ua:"m20 7 50 48-48 46 48 31-48 48 48 52",Va:"m237 7-50 48 48 46-48 31 48 48-48 52",Na:"M121 123S-30 40 24 24C78 6 168 7 233 24 298 40-40 214 24 227c63 12 159 12 209 0 51-12-112-104-112-104Z",w:"M223-33v238c0 42-61 41-61 0V41c0-44-64-44-64 0v164c0 43-71 33-71 0V-27",Ra:"M27-33v238c0 42 61 41 61 0V41c0-44 64-44 64 0v164c0 43 71 33 71 0V-27"};const ra=[[{500:[3,400,4,!0,!0,1,0,200,x.sandClock],1E3:[3,400,5,!0,!0,2,0,200,x.sandClock]},{},{1500:["fire",128,.6]},{100:[!1,["CAPTAIN","    ","WE DETECTED SOME ENEMY SCOUTS",
"BETTER DESTROY THEM"]],1E3:[!1,["TOO LATE!","THEY ARE COMING","WITH A FULL FLEET","    ","GOOD LUCK!"]]},[]],[{1E3:[3,1E3,3,!0,!1,1,0,200,x.zigzag],2E3:[5,1500,6,!1,!1,1,0,130,x.zigzagLeft]},{},{2500:["fire",128,.6],550:["shield",140,.3]},{100:[!1,["TOO LATE!","THEY ARE COMING","WITH A FULL FLEET","    ","GOOD LUCK!"]]},[0,10,50,"M127 120V43c0-77 99 8 99 77 0 70-35 102-99 102S22 181 22 120s32-84 84-84 85 32 85 84c0 53-28 62-64 62-35 0-68-18-68-62 0-43 25-47 47-47 21 0 48 24 48 47 0 24-7 28-27 28s0-14 0-28Z",
30,8,9,1,20,150]],[{},{1E3:[13,1E3,[20,200,120,180,60,220,180,40,120,60],[0,-.1,0,-.1,.1,-.1,0,.1,0,.1],[1,.5,.7,.5,.9,.5,1,.8,.4,.7]]},{1500:["fire",128,.6],2500:["shield",140,.3],3500:["fire",128,.6]},{100:[!1,"13 ASTEROIDS DETECTED;      ;OOOPSS...;HOPE THIS DOES NOT TRIGGER;YOUR TRISKAIDEKAPHOBIA...;         ".split(";")]},[0,10,100,"M127 120V43c0-77 99 8 99 77 0 70-35 102-99 102S22 181 22 120s32-84 84-84 85 32 85 84c0 53-28 62-64 62-35 0-68-18-68-62 0-43 25-47 47-47 21 0 48 24 48 47 0 24-7 28-27 28s0-14 0-28Z",
40,4,9,1,60,50]],[{800:[5,400,9,!0,!1,4,0,400,x.zigzag],810:[5,400,9,!0,!1,4,0,400,x.zigzagLeft],2E3:[5,400,7,!0,!1,4,0,400,x.w],2010:[5,400,7,!0,!1,4,0,400,x.wReversed]},{},{1500:["fire",128,.6]},{100:[!1,["THAT CONDITION STILL","AFFECTING YOUR","VISION, HUH!?","         "]]},[0,10,250,x.sandClock,30,8,8,0,10,50]],[{2500:[13,200,5,!0,!0,1,0,50,x.spiral]},{1E3:[13,1E3,[20,200,120,180,60,220,180,40,120,60],[0,-.1,0,-.1,.1,-.1,0,.1,0,.1],[1,.5,.7,.5,.9,.5,1,.8,.4,.7]]},{1500:["fire",128,.6]},{100:[!1,
"HERE COME MORE ASTEROIDS;12 PLUS 1, HEHE!;         ;ALSO 13 SHIPS;        ;OH MAN! NOT AGAIN!".split(";")]},[]],[{500:[10,400,3,!1,!1,2,0,200,x.zzLeft],800:[10,400,4,!1,!1,2,0,200,x.zzRight],1500:[10,400,3,!1,!1,2,0,200,x.zzLeft],1800:[10,400,4,!1,!1,2,0,200,x.zzRight],2500:[5,1E3,6,!1,!1,1,0,40,x.spiral]},{},{1500:["fire",128,.6]},{100:[!1,["HMMM... ZIGZAGERS?","    "]]},[]]],Ca=ra.length,ba={node:null,ka:!1,buffer:null,async set(a){const b=!!this.node;b&&await this.stop();this.buffer=D[a];b&&await this.start()},
async start(){this.node||(this.node=P(...this.buffer),this.node.loop=!0,await ia.resume(),this.ka=!0)},async stop(){this.node&&(this.node.stop(),this.node.disconnect(),this.node=null,this.ka=!1)}};var $a=zzfxM=(a,b,c,d=125)=>{let e,k,f,p,l,t,C,K,E,y,F,z,v,N,L=0,T=[],A=[],U=[],Z=0,Q=0,I=1,V={},r=44100/d*60>>2;for(;I;Z++)T=[I=K=z=0],c.map((J,g)=>{C=b[J][Z]||[0,0,0];I|=!!b[J][Z];N=z+(b[J][0].length-2-!K)*r;v=g==c.length-1;k=2;for(p=z;k<C.length+v;K=++k){l=C[k];E=k==C.length+v-1&&v||y!=(C[0]||0)|l|0;
for(f=0;f<r&&K;f++>r-99&&E?F+=(1>F)/99:0)t=(1-F)*T[L++]/2||0,A[p]=(A[p]||0)-t*Q+t,U[p]=(U[p++]||0)+t*Q+t;l&&(F=l%1,Q=C[1]||0,(l|=0)&&(T=V[[y=C[L=0]||0,l]]=V[[y,l]]||(e=[...a[y]],e[2]*=2**((l-12)/12),0<l?X(...e):[])))}z=N});return[A,U]},ab=[[[,0,77,,,.7,2,.41,,,,,,,,.06],[,0,43,.01,,.3,2,,,,,,,,,.02,.01],[,0,170,.003,,.008,,.97,-35,53,,,,,,.1],[.8,0,270,,,.12,3,1.65,-2,,,,,4.5,,.02],[,0,86,,,,,.7,,,,.5,,6.7,1,.05],[,0,41,,.05,.4,2,0,,,9,.01,,,,.08,.02],[,0,2200,,,.04,3,2,,,800,.02,,4.8,,.01,.1],[.3,
0,16,,,.3,3]],[[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,24,,,,,,,,,,,,,,,,,,,,,,,,22,,22,,22,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,
21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,24,,,,,,,,27,,,,,,,,,,,,,,,,27,,,,24,,,,24,,,,,,,,27,,,,,,,,,,,,,,,,24,,24,,24,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[6,1,,,34,34,34,,,,,,34,34,,,,,34,,,,34,34,,,,,34,,,,34,,,,34,34,34,,,,,,34,,,,,,34,
34,,,34,34,,,,,,,,,34,34],[4,1,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,23,23,35,23,23,36,23,23,35,23,23,36,23,23,35,35,23,23,35,23,23,35,23,23,36,23,23,35,23,23,36,36],[5,-1,21,,,19,,,21,,,,,,,,,,21,,,19,,,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,1,24,,,24,,,24,,,,,,,,,,24,,,24,,,24,,,,24.75,24.5,24.26,24.01,24.01,24.01,,,,,25,,,,,,,,25,,,,,
,,,25,,,,,,,,25,25,25,25],[4,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,24.75,24.5,24.26,24.01,24.01,24.01,24.01,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,23,,21,23,,35,,23,,21,23,,35,,35,,23,,21,23,,35,,21,23,,35,,21,23,,,],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,36,34,,33,34,34,36,31,36,34,,31,34,32,,33,36,34,,31,34,34,36,33,36,33,,31,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,
33,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,21,,19,21,,33,,21,,19,21,,33,,33,,21,,19,21,,33,,21,,19,21,,33,,33,,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29],[2,1,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,
,,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,],[6,1,,,36,,,,,,36,,36,,,,,,,,36,,,,,,36,,36,,,,,,,,36,,,,,,,,,,,,,,,,36,,,,,,36,,36,,,,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,25,,,25,,,,,,,,25,,,,,,,,25,25,25,25]],[[1,-1,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,19,19,31,19,19,31,19,19,31,19,19,31,19,19,31,31],[4,1,24,24,,24,24,,24,24,24,24,
,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,36,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,19,,19,19,31,19,19,31,19,,19,19,31,19,19,31],[2,1,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,
,25,,,,,,,,25,25,25,25,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,,,,,,34,,34,,,,,,,,34,,,,,,34,,34,,,,,,]]],[0,1,1,2,3,4,4]],bb=[,,45,.03,.21,.6,4,.9,2,-3,,,,.2,,.9,,.45,.26],cb=[.9,,413,,.05,.01,1,3.8,-3,-13.4,,,,,,,.11,.65,.07,,237],db=[1.5,,261,.01,.02,.08,1,1.5,-.5,,,-.5,,,,,.9,.05],eb=[1.6,,291,.01,.21,.35,,2.2,,,-136,.09,.03,,,.2,.2,.7,.28],fb=[,,468,.05,.62,.7,,.3,,,300,.05,.02,,,,.32,,.6],gb=[.8,,112,.03,.1,.2,3,3.6,18,-9,,,,,,,.03,.83,.12],hb=
[2.3,,330,,.06,.17,2,3.7,,,,,.05,.4,2,.5,.13,.89,.05,.17];x=function(a){window.U=window.U||{};return window.U.context=a}(document.getElementById("c").getContext("2d"));x.imageSmoothingEnabled=!1;x.setTransform(1,0,0,1,0,0);(async()=>{Ma();await W("song1",$a,ab);await W("explosion",X,bb);await W("shoot",X,cb);await W("shoot2",X,gb);await W("typing",X,db);await W("powerup",X,eb);await W("hit",X,hb);await W("transition",X,fb);await ja("font.png");await ja("spritesheet.png");await ja("spritesheet16.png");
w("change-scene",(b,c)=>{Ha(["change-scene"]);ba.stop();switch(b){case "game":a=Wa();break;case "menu":a=Fa();break;case "game-over":console.log("game-over",c),a=Za(c)}});let a=Fa();Ga({update(b){a.update(b)},o(){a.o()}}).start()})()})();

(function(){function Q(){return window.sa.context}function N(a){return a*Math.PI/180}function na(a){let {x:c=0,y:b=0,width:e,height:f}=a;c-=.5*e;b-=.5*f;0>e&&(c+=e,e*=-1);0>f&&(b+=f,f*=-1);return{x:c,y:b,width:e,height:f}}function Aa({update:a,A:c}){function b(){requestAnimationFrame(b);l=performance.now();C=l-r;r=l;if(!(1E3<C)){for(e+=C;e>=f;)a(p),e-=f;v.clearRect(0,0,v.canvas.width,v.canvas.height);c()}}let e=0,f=1E3/60,p=1/60,r,l,C;const v=Q();return{start(){r=performance.now();requestAnimationFrame(b)}}}
function oa(a=()=>{},c){a.Aa&&c.preventDefault();a(c)}function Ba(a){let c=U[a.code],b=da[c];ea[c]=!0;oa(b,a)}function Ca(a){let c=U[a.code],b=fa[c];ea[c]=!1;oa(b,a)}function V(a){return!![].concat(a).some(c=>ea[c])}function W(a,c,{Ha:b="keydown",preventDefault:e=!0}={}){let f="keydown"==b?da:fa;c.Aa=e;[].concat(a).map(p=>f[p]=c)}function pa(a,{Ha:c="keydown"}={}){let b="keydown"==c?da:fa;[].concat(a).map(e=>delete b[e])}function qa(a,c){return(new URL(a,c)).href}function ha(a){window.xa||(window.xa=
{Qa:qa,Oa:I});return new Promise((c,b)=>{let e,f;if(I[a])return c(I[a]);e=new Image;e.onload=()=>{f=qa(a,window.location.href);I[f]=I[a]=e;c(e)};e.onerror=()=>{b()};e.src=a})}function J({name:a="",x:c=-100,y:b=-100,dx:e=0,dy:f=0,T:p=0,H:r=0,width:l=10,height:C=10,L:v=1,M:x=1,rotation:B=0,anchor:n={x:.5,y:.5},g:D=Infinity,color:u="white",Y:O,update:y,A:L,j:K,image:M}={}){const F={Y(m={}){Object.assign(this,m);this.ua&&this.ua()},advance(){this.x+=this.dx;this.y+=this.dy;this.dx+=this.T;this.dy+=this.H},
C(){this.advance();this.frame++;this.g--},update(){this.X?this.X():this.C()},Ba(){const m=this.context;m.translate(this.x,this.y);this.rotation&&m.rotate(this.rotation);this.L&&this.M&&m.scale(this.L,this.M);m.translate(-this.width*n.x,-this.width*n.y);this.j()},A(){const m=this.context;m.save();this.W?(m.translate(this.x,this.y),this.W()):(this.Ba(),m.restore())},za(){const m=this.context;if(this.ca)return this.ca();m.fillStyle=this.color||"white";m.fillRect(0,0,this.width,this.height)},j(){this.ca?
this.ca():this.za()},Z(){return 0<this.g},...arguments[0]};F.Y({name:a,x:c,y:b,dx:e,dy:f,T:p,H:r,width:l,height:C,L:v,M:x,rotation:B,anchor:n,g:D,color:u,frame:0,context:Q(),ua:O,X:y,W:L,ca:K,image:M});return F}function X(a,c){R[a]=R[a]||[];R[a].push(c)}function Da(a=[]){R=Object.keys(R).reduce((c,b)=>{a.includes(b)&&(c[b]=R[b]);return c},{})}function w(a,...c){(R[a]||[]).map(b=>b(...c))}function Ea(a={}){const c="pink orange white purple red cyan green yellow pink orange".split(" ");return J({name:"enemy",
x:-80,y:-80,image:I["spritesheet.png"],na:I["spritesheet16.png"],m:4,s:0,u:0,frame:0,L:.1,M:.1,h:2,pa:2,l:!0,I:!1,parent:a.parent,da:a.da||0,v:!1,ka:30,la:40,D:0,...a,U(b){this.h-=b;this.u=1;0>=this.h&&!this.I&&this.o();P(...[2.3,,330,,.06,.17,2,3.7,,,,,.05,.4,2,.5,.13,.89,.05,.17])},o(){this.B&&this.B.$++;this.parent&&this.parent.Da++;this.I=this.l=!0;this.g=10},update(){var b=this.path.getPointAtLength(this.frame);const e=this.path.getPointAtLength(this.frame+1);this.x=Math.floor(b.x);this.y=Math.floor(b.y);
this.parent&&(this.x=this.parent.x+Math.cos(this.frame/this.parent.la+this.da)*this.parent.ka,this.y=this.parent.y+Math.sin(this.frame/this.parent.la+this.da)*this.parent.ka);4<this.u&&(this.u=0);this.rotate&&(this.rotation=N(90)+Math.atan2(e.y-b.y,e.x-b.x));!this.rotate&&(this.rotation=N(180));this.frame>=this.path.getTotalLength()&&(this.frame=0,!this.loop&&(this.B&&this.B.$++,this.g=0));b=Math.min(Math.max(0,this.frame/50),1);50>this.frame&&(b=this.frame/50);this.frame>this.path.getTotalLength()-
50&&(b=(this.path.getTotalLength()-this.frame)/50);50==this.frame&&(this.l=!1);this.L=this.M=b;2!==this.D&&.995<Math.random()&&w("enemy-fire",this,this.D);2!==this.D||20!=this.s&&40!=this.s&&60!=this.s||w("enemy-fire",this,this.D);300<this.s&&(this.s=0);0<this.u&&this.u++;50<this.frame&&this.s++;this.v&&10<this.s&&70>this.s?this.l=!1:this.v&&(this.l=!0);2===this.D&&(10>this.s||70<this.s)&&this.C();2!==this.D&&this.C();0>=this.g&&this.I&&w("explosion",this.x,this.y,this.v?60:20,this.v?10:5,c[this.m])},
j(){const b=this.context;1<this.frame&&!this.v&&b.drawImage(this.image,8*this.m,0,8,8,0,0,8,8);1<this.frame&&this.v&&b.drawImage(this.na,16*this.m,0,16,16,0,0,16,16);if(1<this.frame&&this.v){const e=20*this.h/this.pa;b.save();b.translate(this.width/2,this.height/2);b.rotate(-this.rotation);b.fillStyle="white";b.fillRect(-12,-16,24,6);b.fillStyle="black";b.fillRect(-11,-15,22,4);b.fillStyle="green";this.h<this.pa/4&&(b.fillStyle="red");b.fillRect(-10,-14,e,2);b.restore()}this.u&&(b.globalCompositeOperation=
"source-atop",b.fillStyle="white",b.fillRect(0,0,this.v?16:8,this.v?16:8),b.globalCompositeOperation="source-over")}})}function Fa(a){const [c,b,e,f]=a;return{frame:c,Na:b,pause:e,G:f}}function Ga(a){const [c,b,e,f,p]=a;return{frame:c,x:b,speed:e,type:f,value:p}}function ra(a,c){const b=[];a.forEach(e=>{const [f,p,r,l,C,v,x,B,n,D="",u=[],O=[],y=[],L=[],K=[]]=e;e=b.push;var M=0<y.length?v:v+Math.floor(c/4),F;if(F=20!==r){F=document.createElementNS("http://www.w3.org/2000/svg","svg");const m=document.createElementNS("http://www.w3.org/2000/svg",
"path");F.appendChild(m);m.setAttribute("d",D);m.setAttribute("fill","none");m.setAttribute("stroke","black");m.setAttribute("stroke-width","2");m.setAttribute("id","path");F=m}e.call(b,{frame:f,Pa:p,m:r,rotate:l,h:C,total:M,interval:x,loop:B,D:n,path:F,Ea:u.map(Fa),Ia:O.map(Ga),count:0,ea:!1,$:0,children:y,Ma:L,Fa:K})});return{wa:b}}function S({create:a,F:c=10}){return{i:[a({x:-100,y:-100})],F:c,size:0,ya:a,get(b={}){if(this.size==this.i.length){if(this.size==this.F)return;for(var e=0;e<this.size&&
this.i.length<this.F;e++)this.i.push(this.ya())}e=this.i[this.size];this.size++;e.Y(b);return e},update(){let b,e=!1;for(let f=this.size;f--;)b=this.i[f],b.update(),b.Z()||(e=!0,this.size--);e&&this.i.sort((f,p)=>p.Z()-f.Z())},A(){for(let b=this.size;b--;)this.i[b].A()},K(){return this.i.slice(0,this.size)}}}function ia({i:a=[],update:c,A:b}){const e={...arguments[0],Y(f={}){Object.assign(this,f)},update(){this.X?this.X():this.i.forEach(f=>f.update())},A(){this.W&&this.W();this.i.forEach(f=>f.A())}};
e.Y({i:a,context:Q(),X:c,W:b});return e}function Ha(){const a=Q();return J({name:"ship",x:a.canvas.width/2,y:a.canvas.height+16,image:I["spritesheet.png"],m:1,s:0,J:0,u:0,l:!0,I:!1,ha:!0,h:100,aa:3,O:0,U(c){this.l||(this.h-=c,this.u=1,0>=this.h&&this.o(),P(...[2.3,,330,,.06,.17,2,3.7,,,,,.05,.4,2,.5,.13,.89,.05,.17]))},o(){this.I||(this.I=this.l=!0,this.aa--,this.g=5,0>=this.aa&&w("game-over"))},La(){this.x=a.canvas.width/2;this.y=a.canvas.height+32;this.M=this.L=2;this.h=100;this.J=0;this.l=!0;this.I=
!1;this.ha=!0;this.g=Infinity;this.dy=this.H=this.frame=0},Ga(){this.J++;3<this.J&&(this.J=3)},Ja(){this.h=100},update(){this.H=this.T=0;this.dx*=.96;this.dy*=.96;this.m=1;V(["d","arrowright"])&&5>this.dx&&(this.T=.2,this.m=2);V(["a","arrowleft"])&&-5<this.dx&&(this.T=-.2,this.m=0);V("space")&&0===this.s%(15/(1<this.J?2:1))&&(0==this.J?w("ship-fire",this.x-1):1==this.J?(w("ship-fire",this.x-2,1),w("ship-fire",this.x+2,1)):2==this.J?(w("ship-fire",this.x-3,1),setTimeout(()=>w("ship-fire",this.x-1,
2),200),w("ship-fire",this.x+3,1)):3==this.J&&(w("ship-fire",this.x-2,1),setTimeout(()=>w("ship-fire",this.x+2,1),300),setTimeout(()=>w("ship-fire",this.x-4,2),200),setTimeout(()=>w("ship-fire",this.x+4,2),100)));this.ha||(V(["s","arrowdown"])&&5>this.dy&&(this.H=.2),V(["w","arrowup"])&&-5<this.dy&&(this.H=-.2));100>this.frame&&(this.H=-.03,this.L=this.M=2-this.frame/100);0>=this.aa&&(this.T=0,this.H=0,this.dx=0,this.dy=0);4<this.u&&(this.u=0);this.C();this.x>a.canvas.width&&(this.x=a.canvas.width);
0>this.x&&(this.x=0);0<this.aa&&!this.ha&&this.y>a.canvas.height&&(this.y=a.canvas.height);0>this.y&&(this.y=0);0>=this.h&&this.o();0>=this.g&&(w("explosion",this.x,this.y,30,6,"white"),this.La());100==this.frame&&(this.l=!1,this.ha=!1);this.s++;0<this.u&&this.u++},j(){const c=this.context;c.drawImage(this.image,8*this.m,0,8,8,0,0,8,8);100>this.frame&&this.l&&10>this.frame%20&&(c.globalCompositeOperation="source-atop",c.fillStyle="white",c.fillRect(0,0,8,8),c.globalCompositeOperation="source-over");
this.u&&(c.globalCompositeOperation="source-atop",c.fillStyle="white",c.fillRect(0,0,8,8),c.globalCompositeOperation="source-over");let b=1;0>this.H&&(b=5>this.frame%10?2:3);c.fillStyle="#FFaa33";c.fillRect(3,7,2,b);c.fillStyle="#FF6633";c.fillRect(5>this.frame%10?3:4,7+b,1,b)}})}function G({x:a=0,y:c=0,text:b="",color:e="white",align:f="left",lineHeight:p=8,scale:r=1}){const l=Q(),C=8*b.split("\n").reduce((v,x)=>v.length>x.length?v:x).length;return J({x:a,y:c,width:C,height:8,anchor:{x:0,y:0},text:b,
L:r,M:r,j(){const v=I["font.png"],x=this.text.split("\n");l.save();x.forEach(B=>{l.save();"center"===f&&l.translate(8*-B.length/2,0);"right"===f&&l.translate(8*-B.length,0);for(let D=0;D<B.length;D++){var n=B.charCodeAt(D);let u=0;65<=n&&90>=n?u=n-65:null;48<=n&&57>=n?u=n-22:null;32===n&&(u=-1);46===n&&(u=36);44===n&&(u=37);63===n&&(u=38);33===n&&(u=39);58===n&&(u=40);64===n&&(u=41);-1!==u&&(n=8*D,l.drawImage(v,8*u,0,8,8,n,0,8,8),l.globalCompositeOperation="source-atop",l.fillStyle=e||"white",l.fillRect(n,
0,8,8),l.globalCompositeOperation="source-over")}l.restore();l.translate(0,p)});l.restore()}})}function sa(a,c){let b=[],e=c.x+c.width/2;var f=c.y+c.height/2;c=a.y<f;f=a.y+a.height>=f;a.x<e&&(c&&b.push(0),f&&b.push(2));a.x+a.width>=e&&(c&&b.push(1),f&&b.push(3));return b}function ja(){function a(e){const f=2*Math.random()+.1,p=96*f;b.get({id:"star",x:Math.random()*c.canvas.width,y:e,dx:0,dy:f,width:1,height:1,g:240/f,update(){this.advance();this.y>c.canvas.height&&(this.g=0)},j(){const r=this.context;
r.fillStyle=`rgb(${p}, ${p}, ${p})`;r.fillRect(0,0,this.width,this.height)}})}const c=Q(),b=S({create:J,F:300});for(let e=0;e<c.canvas.height;e+=2)a(e);return{update(){a(-1);b.update()},A(){b.A()}}}function ta(){return J({name:"dialog",x:8,y:248,image:I["spritesheet.png"],va:[10,11,12,13,14],text:G({text:"",x:16,y:8,align:"left"}),P:0,G:[],V:0,ia:0,frame:0,anchor:{x:0,y:0},ra:!1,oa:!1,qa:!1,Ka(){this.P=this.G[this.V].length},start(a){W(["space"],()=>this.Ka());this.qa=!1;setTimeout(()=>{this.oa=!0;
this.G=["",...a.G];this.frame=0},2E3);this.dy=-2},stop(){pa(["space"]);this.qa=!0;this.text.text="        ";this.oa=!1;setTimeout(()=>{this.G=[];this.frame=this.P=this.V=0},1E3);this.dy=2},update(){200>this.y&&(this.dy=0,this.y=200);248<this.y&&(this.dy=0,this.y=248);if(0!=this.G.length){this.ra=!1;var a=this.G[this.V]+"      ";" "!==a[this.P]&&(this.ra=!0);0==this.frame%5&&(this.P++," "!==a[this.P]&&P(...[1.5,,261,.01,.02,.08,1,1.5,-.5,,,-.5,,,,,.9,.05]));this.V<this.G.length&&(this.text.text=a.slice(0,
this.P));this.frame++;this.P>=a.length&&(this.V++,this.P=this.frame=0);this.V>=this.G.length&&!this.qa&&this.stop();this.ra&&0==this.frame%5&&this.ia++;this.ia>=this.va.length&&(this.ia=0);this.C()}},j(){const a=this.context,c=this.image;a.fillStyle="white";a.fillRect(-2,-2,12,12);a.drawImage(c,8*this.va[this.ia],0,8,8,0,0,8,8);a.translate(16,0);this.text.j()}})}function Ia(){return J({x:0,y:0,dx:0,dy:0,width:2,height:2,g:400,frame:0,o(){this.g=0;this.y=this.x=-100},update(){this.C();if(240<this.y||
0>this.y||256<this.x||0>this.x)this.g=0},j(){const a=this.context;a.fillStyle="red";a.fillRect(0,0,this.width,this.width)}})}function Ja(){return J({name:"asteroid",x:0,y:-16,image:I["spritesheet.png"],na:I["spritesheet16.png"],m:2,frame:0,L:1,M:1,width:16,height:16,angle:0,speed:1,rotation:0,rotate:!1,g:0,frame:0,ma:!1,h:20,U(){this.ma=!0;this.h--;setTimeout(()=>{this.ma=!1},200)},o(){w("explosion",this.x,this.y,20,10,"white");this.g=0;this.B&&this.B.$++},update(){this.rotation+=.1;0>=this.h&&this.o();
this.C();(260<this.y||-16>this.x||266<this.x)&&(this.g=0,this.B&&this.B.$++)},j(){const a=this.context;a.drawImage(this.na,32,0,16,16,0,0,16,16);this.ma&&(a.globalCompositeOperation="source-atop",a.fillStyle="white",a.fillRect(0,0,16,16),a.globalCompositeOperation="source-over")}})}function Ka(){function a(k,g){0!==k.length&&(g.Da=0,g.ka=30,g.la=100,g.v=!0,g.width=16,g.height=16,k.forEach(h=>{for(let d=0;d<h[3];d++)n.get({m:h[0],rotate:h[1],g:Infinity,l:!0,I:!1,h:h[2]+Math.floor(p/4),frame:0,v:!1,
parent:g,loop:g.loop,path:g.path,da:N(360/h[3]*d),D:h[4],B:g.B})}))}function c(k,g){k.forEach(h=>{void 0!==g&&g===h.frame&&v.start(h)})}function b(k,g){const h=[["powerup-fire","green",5],["powerup-shield","yellow",18]];k.forEach(d=>{if(void 0!==d.frame&&g===d.frame){const q=h[d.type];O.get({name:q[0],x:d.x,y:-8,width:8,height:8,color:q[1],dy:d.speed,image:I["font.png"],value:d.value,g:Infinity,o(){l.O+=this.value;0===d.type&&P(...[1.6,,291,.01,.21,.35,,2.2,,,-136,.09,.03,,,.2,.2,.7,.28]);1===d.type&&
P(...[.5,,375,.03,.07,.08,1,2.7,,,302,.05,.05,,,,,.93,.01,,607]);this.g=0},update(){this.C();240<this.y&&(this.g=0)},j(){const z=this.context;10>this.frame%20&&(z.fillStyle=this.color,z.fillRect(-3,-3,this.width+6,this.height+6),z.fillStyle="black",z.fillRect(-2,-2,this.width+4,this.height+4));z.fillStyle=this.color;z.fillRect(-1,-1,this.width+2,this.height+2);z.drawImage(this.image,8*q[2],0,8,8,0,0,8,8)}})}})}function e(k,g,h=!0){k.wa.forEach(d=>{var q=g-d.frame;const z=d.frame+d.total*d.interval;
g>=d.frame&&g<z&&d.count<d.total&&0===q%d.interval&&(q=1<p/r?Math.floor(p/r*d.h*.2):0,20===d.m?D.get({x:d.Ma[d.count],y:-8,dx:d.Fa[d.count],dy:1,m:2,g:Infinity,h:d.h+q,B:d}):(q=n.get({x:-100,y:-100,path:d.path,rotate:d.rotate,loop:d.loop,g:Infinity,l:!0,I:!1,h:d.h+q,pa:d.h+q,frame:0,m:d.m,parent:null,v:!1,D:d.D,s:0,B:d}),a(d.children||[],q)),d.ea=!1,d.count+=1);b(d.Ia,g);h&&c(d.Ea,g);d.ea||d.count!==d.total||d.$!==d.total||(d.ea=!0)})}function f(k,g){k.Z()&&!k.l&&g.forEach(h=>{var d;if(d="enemy"!==
k.name||"enemy"!==h.name)if(d=h.Z()&&!k.l&&!h.l){d=na(h);let q=na(k);d=d.x<q.x+q.width&&d.x+d.width>q.x&&d.y<q.y+q.height&&d.y+d.height>q.y}d&&(h.name.includes("powerup-")||h.v||"ship-bullet"===k.name||h.o(),"ship"==k.name&&"enemy"==h.name?k.U(50):"ship"==k.name&&"asteroid"==h.name?(k.o(),h.o()):"ship"==k.name&&"powerup-fire"==h.name?(k.Ga(h.value),h.o()):"ship"==k.name&&"powerup-shield"==h.name?(k.Ja(h.value),h.o()):"ship"==k.name?k.U(10):"ship-bullet"==k.name&&"asteroid"==h.name&&(k.g=0,h.U(1)),
"enemy"==k.name&&(k.U(1),l.O+=10))})}W(["esc"],()=>{w("change-scene","menu")});let p=1,r=1;const l=Ha(),C=ja(),v=ta({x:8,y:224}),x=S({create:J,F:100}),B=S({create:Ia,F:100}),n=S({create:Ea,F:100}),D=S({create:Ja,F:10}),u=S({create:J,F:300}),O=S({create:J,F:10}),y=G({x:8,y:8,text:"SCORE 0"}),L=G({x:224,y:8,text:"@@@",color:"red"}),K=G({x:8,y:224,text:"",color:"yellow"}),M=G({x:128,y:120,text:`LEVEL ${p}`,color:"lightgreen",align:"center"}),F=J({x:192,y:8,width:24,height:8,anchor:{x:0,y:0},j(){const k=
this.context,g=0<=l.h?l.h/5:0;k.strokeStyle="white";k.strokeRect(0,0,this.width,this.height);k.fillStyle="green";25>l.h&&(k.fillStyle="red");k.fillRect(2,2,g,this.height-4)}});X("ship-fire",(k,g=0)=>{x.get({name:"ship-bullet",x:k,y:l.y-4,dx:(1-2*Math.random())/(4-g),dy:-5,width:2,height:3,g:80,o(){this.g=0;this.y=this.x=-100},j(){const h=this.context;h.fillStyle="white";h.fillRect(0,0,this.width,1);h.fillStyle="yellow";h.fillRect(0,1,this.width,1);h.fillStyle="red";h.fillRect(0,2,this.width,1)}});
P(...[.9,,413,,.05,.01,1,3.8,-3,-13.4,,,,,,,.11,.65,.07,,237])});X("enemy-fire",({x:k,y:g},h=0)=>{var d=l.x-4-k,q=l.y-g;const z=Math.hypot(d,q)/1;if(2===h)for(h=0;12>h;h++)d=1*Math.cos(N(30*h)),q=1*Math.sin(N(30*h)),B.get({name:"enemy-bullet",x:k,y:g,dx:d,dy:q,frame:0,g:400});else B.get({name:"enemy-bullet",x:k+4,y:g+4,dx:0==h?0:d/z,dy:0==h?1.5:q/z,frame:0,g:400});P(...[.3,,222,.02,.04,.09,3,.3,11,10,,,,,15,,,.53,.17])});X("explosion",(k,g,h=50,d=3,q="white")=>{for(let z=0;z<h;z++){let T=360*Math.random(),
A=d,E=Math.random()*A+A;u.get({name:"particle",x:k,y:g,dx:Math.cos(N(T))*E/10,dy:Math.sin(N(T))*E/10,width:1,height:1,g:30*A,color:q,update(){const t=256/30*A*(this.g/30);"white"==q&&(this.color=`rgb(${t},${t},${t})`);"red"==q&&(this.color=`rgb(${t},0,0)`);this.C()},j(){const t=this.context;t.fillStyle=this.color;t.fillRect(0,0,this.width,this.height)}});u.get({name:"particle",x:k,y:g,dx:Math.cos(N(T))*E/20,dy:Math.sin(N(T))*E/20,width:2,height:2,g:10*A/2,update(){const t=256/(A/2)*(this.g/10);this.color=
`rgb(${t},${t},${t})`;this.C()},j(){const t=this.context;t.fillStyle=this.color;t.beginPath();t.arc(0,0,2,0,2*Math.PI);t.fill()}})}P(...[,,45,.03,.21,.6,4,.9,2,-3,,,,.2,,.9,,.45,.26])});X("game-over",()=>{setTimeout(()=>w("change-scene","game-over",{O:l.O}),2E3)});const m=new ba,H=new ba,Y=new ba;return ia({i:[C,l,O,x,B,D,n,u,y,L,F,v],level:ra(ka[r-1],1),frame:0,update(){if(v.oa)v.update();else{e(this.level,this.frame,p==r);M.update();m.clear();m.add(l,D.K(),n.K(),B.K(),O.K());f(l,m.get(l));H.clear();
n.K().forEach(g=>{H.add(g,x.K());f(g,H.get(g))});Y.clear();x.K().forEach(g=>{Y.add(g,D.K());f(g,Y.get(g))});var k=this.level.wa.filter(g=>!g.ea).length;0===k&&0===n.K().length&&(p++,r++,r>La&&(r=1),this.level=ra(ka[r-1],p),this.frame=0,M.text=`LEVEL ${p}`,P(...[,,264,.07,.29,.06,1,3.7,,-30,-148,.07,.08,,,,,.76,.22,,-1240]));y.text=`SCORE ${l.O}`;L.text="@@@".slice(0,l.aa);K.text=`${(this.frame+"").padStart(8,"0")} ${(k+"").padStart(2,"0")}`;this.frame++;this.i.forEach(g=>g.update())}},A(){100>this.frame&&
M.A()}})}function ua(){W(["enter"],()=>{w("change-scene","game")});var a=localStorage.getItem("hiscore")||0;const c=ja(),b=G({text:"MICRO SHOOTER",x:128,y:48,align:"center",scale:2,color:"red"}),e=G({text:"JS13K 2024 EDITION",x:128,y:96,align:"center"});a=G({text:`HIGH SCORE ${a}`,x:128,y:120,align:"center",color:"yellow"});const f=G({text:"PRESS ENTER TO START",x:128,y:144,align:"center",color:"lightgreen"}),p=G({text:"ARROWS TO MOVE\nSPACE TO SHOOT",x:128,y:192,align:"center"});return ia({i:[c,
b,e,a,f,p]})}function Ma(a){a=a.O;const c=localStorage.getItem("hiscore")||0;W(["enter"],()=>{w("change-scene","menu")});var b=ja(),e=G({text:"GAME OVER",x:128,y:48,align:"center",scale:2,color:"red"});const f=G({text:`SCORE ${a}`,x:128,y:96,align:"center"}),p=G({text:"PRESS ENTER TO CONTINUE",x:128,y:144,align:"center",color:"lightgreen"}),r=ta({x:8,y:224});b=ia({i:[b,e,f,p,r]});e=["GOOD BYE CAPTAIN @        ","THE ENEMY HAS WON","BUT... HEY!     ","THIS IS JUST A GAME"];a>c?e.push("YOU HAVE A NEW HIGH SCORE!"):
e.push("TRY TO BEAT YOUR HIGH SCORE!");r.start({G:e});a>c&&(localStorage.setItem("hiscore",a),a=G({text:`NEW HIGH SCORE ${a}`,x:128,y:120,align:"center",color:"yellow"}),b.i.push(a));return b}function Na(){const a=Q();a.filter="url(#remove-alpha)"===a.filter?"none":"url(#remove-alpha)"}let da={},fa={},ea={},U={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"},I={},R={},la=new AudioContext,P=(a=1,c=.05,b=220,e=0,f=0,p=.1,
r=0,l=1,C=0,v=0,x=0,B=0,n=0,D=0,u=0,O=0,y=0,L=1,K=0,M=0,F=0)=>{let m=Math,H=2*m.PI,Y=C*=500*H/44100/44100,k=b*=(1-c+2*c*m.random(c=[]))*H/44100,g=0,h=0,d=0,q=1,z=0,T=0,A=0,E=0>F?-1:1;var t=H*E*F*2/44100,Z=m.cos(t);let aa=m.sin;var ca=aa(t)/4;t=1+ca;let Oa=-2*Z/t;ca=(1-ca)/t;let va=(1+E*Z)/2/t;Z=-(E+Z)/t;let wa=0,xa=0,ya=0,za=0;e=44100*e+9;K*=44100;f*=44100;p*=44100;y*=44100;v*=500*H/44100**3;u*=H/44100;x*=H/44100;B*=44100;n=44100*n|0;a*=.3;for(E=e+K+f+p+y|0;d<E;c[d++]=A*a)++T%(100*O|0)||(A=r?1<r?
2<r?3<r?aa(g**3):m.max(m.min(m.tan(g),1),-1):1-(2*g/H%2+2)%2:1-4*m.abs(m.round(g/H)-g/H):aa(g),A=(n?1-M+M*aa(H*d/n):1)*(0>A?-1:1)*m.abs(A)**l*(d<e?d/e:d<e+K?1-(d-e)/K*(1-L):d<e+K+f?L:d<E-y?(E-d-y)/p*L:0),A=y?A/2+(y>d?0:(d<E-y?1:(E-d)/y)*c[d-y|0]/2/a):A,F?A=za=va*wa+Z*(wa=xa)+va*(xa=A)-ca*ya-Oa*(ya=za):0),t=(b+=C+=v)*m.cos(u*h++),g+=t+t*D*aa(d**5),q&&++q>B&&(b+=x,k+=x,q=0),!n||++z%n||(b=k,C=Y,q=q||1);a=la.createBuffer(1,E,44100);a.getChannelData(0).set(c);b=la.createBufferSource();b.buffer=a;b.connect(la.destination);
b.start()};const ka=[[[100,!1,20,!1,10,10,130,!1,0,"",[],[],[],[40,200,120,180,60,220,180,40,120,60],[1,-1,0,-1,1,-1,0,1,0,1]],[1300,!1,4,!1,1,2,330,!1,0,"M1 1s162 189 172 199c11 10 30 35 59 24 29-12 9-54 0-65L120 37S99 11 71 15c-27 3-46 47-46 47S4 106 4 126s-3 67 11 77c15 10 55 41 79 9L247 1",[],[[410,120,1,0,10],[730,200,1,1,10]]],[1500,!0,5,!0,2,3,60,!1,0,"M223-33v238c0 42-61 41-61 0V41c0-44-64-44-64 0v164c0 43-71 33-71 0V-27",[],[]]],[[100,!0,5,!0,2,3,60,!1,0,"M287 12.5L-21 60.5L272 106.5L-21 137.5L272 185.5L-18.5 237.5",
[],[]],[400,!1,0,!1,10,1,50,!0,2,"M131 57s-56 130 0 129c57 0 99-32 69-67s-33-85-69-75-71 38-71 75c1 37 25 52 64 51 39 0 61-22 60-51-1-30-21-46-47-47-25-1-56 17-56 47 0 29 12 32 43 29s39-11 39-29-6-25-26-25-32 4-36 25c-3 20 9 18 23 11 13-7 17-11 17-11",[[99,0,!0,["SOMETHING BIG IS COMING"]]],[[200,120,.5,0,10],[400,200,.5,1,10],[1600,200,.5,0,10],[2900,120,.5,0,10]],[[8,!1,1,16,0]]],[1E3,!1,0,!1,5,1,50,!0,2,"M244 12H22c-14 0-11 9 0 9h214c17 0 17 10 0 10H22C4 31 8 43 22 43h214c20 0 19 15 0 15H22C6 58 6 71 22 71h244",
[],[],[[5,!1,1,4,1]]]],[[100,!1,4,!1,1,2,330,!1,0,"M1 1s162 189 172 199c11 10 30 35 59 24 29-12 9-54 0-65L120 37S99 11 71 15c-27 3-46 47-46 47S4 106 4 126s-3 67 11 77c15 10 55 41 79 9L247 1",[],[[410,120,1,0,10],[730,200,1,1,10]]],[400,!0,5,!0,2,3,60,!1,0,"M113.696 117.212C128.254 117.212 156.71 108.752 154.725 91.832C152.74 74.9117 136.196 52.5529 113.696 52.5529C91.1957 52.5529 64.7252 64.0345 54.7988 79.7461C44.8723 95.4577 38.9165 134.737 54.7988 152.261C70.6811 169.786 80.6075 172.807 105.755 172.203C130.902 171.599 155.387 160.117 170.607 149.24C185.828 138.363 203.034 112.378 202.372 91.832C201.71 71.286 207.004 45.9058 189.798 28.3813C172.593 10.8567 149.431 -0.625112 98.4751 1.18777C47.5194 3.00065 40.9017 23.5468 30.3135 38.0498C19.7253 52.5529 2.51948 78.5374 1.19596 112.378C-0.127568 146.219 5.16655 173.412 19.7253 189.728C34.2841 206.044 72.0046 225.381 98.4751 225.985C124.946 226.59 177.887 208.461 194.431 194.562C210.975 180.663 232.813 157.7 238.107 128.09C243.401 98.4791 244.725 70.6818 232.813 52.5529C220.901 34.424 207.666 18.7631 165.313 10.9072C122.96 3.05134 87.8869 18.1082 70.6811 31.4026C53.4752 44.697 19.7253 83.3718 19.7253 112.378C19.7253 141.384 25.6812 165.556 54.7988 186.102C83.9163 206.648 148.107 193.353 167.96 180.663C187.813 167.973 214.284 149.24 218.916 117.212C223.548 85.1847 199.725 59.2001 173.916 46.5099C148.107 33.8198 105.755 33.2155 83.9163 46.5099C62.0781 59.8043 40.24 93.0406 56.7841 128.09C73.3281 163.139 99.1369 163.139 115.681 156.492C132.225 149.844 167.96 141.384 173.916 112.378C179.872 83.3718 177.887 66.4517 142.151 59.2001C106.416 51.9485 79.284 62.2217 79.284 93.6449C79.284 125.068 98.4751 117.212 98.4751 117.212",
[],[]],[600,!0,6,!0,4,3,200,!1,0,"M241 228V23c0-29-40-29-40 0v186c0 36-30 25-37 0S140 7 116 7 82 168 77 206c-5 37-38 29-38 0V33C39-11 1-7 1 33v195",[],[]],[800,!0,7,!1,4,3,20,!1,0,"M235 1H13c-14 0-11 9 0 9h214c17 0 17 10 0 10H13c-18 0-14 12 0 12h214c20 0 19 15 0 15H13c-16 0-16 13 0 13h244",[],[]]],[[200,!1,0,!1,20,1,50,!0,2,"M131 57s-56 130 0 129c57 0 99-32 69-67s-33-85-69-75-71 38-71 75c1 37 25 52 64 51 39 0 61-22 60-51-1-30-21-46-47-47-25-1-56 17-56 47 0 29 12 32 43 29s39-11 39-29-6-25-26-25-32 4-36 25c-3 20 9 18 23 11 13-7 17-11 17-11",
[[50,0,!0,["REMEMBER","THE BIG SHIP CAN ONLY BE HIT","WHEN SHOOTING"]]],[[200,120,.5,0,10],[400,200,.5,1,10],[1600,200,.5,0,10],[2900,120,.5,0,10]],[[8,!0,2,8,1]]]]],La=ka.length;class ba{constructor({fa:a=3,ga:c=25,N:b}={}){this.fa=a;this.ga=c;a=Q().canvas;this.N=b||{x:0,y:0,width:a.width,height:a.height};this.ba=!1;this.ja=0;this.S=[];this.R=[]}clear(){this.R.map(a=>{a.clear()});this.ba=!1;this.S.length=0}get(a){let c=new Set;for(;this.R.length&&this.ba;)return sa(a,this.N).map(b=>{this.R[b].get(a).map(e=>
c.add(e))}),Array.from(c);return this.S.filter(b=>b!==a)}add(...a){a.flat().map(c=>{this.ba?this.ta(c):(this.S.push(c),this.S.length>this.ga&&this.ja<this.fa&&(this.Ca(),this.S.map(b=>this.ta(b)),this.S.length=0))})}ta(a){sa(a,this.N).map(c=>{this.R[c].add(a)})}Ca(){var a;this.ba=!0;if(!this.R.length){var c=this.N.width/2|0;var b=this.N.height/2|0;for(a=0;4>a;a++)this.R[a]=new ba({N:{x:this.N.x+(1==a%2?c:0),y:this.N.y+(2<=a?b:0),width:c,height:b},fa:this.fa,ga:this.ga}),this.R[a].ja=this.ja+1}}}const ma=
function(a){window.sa=window.sa||{};return window.sa.context=a}(document.getElementById("c").getContext("2d"));ma.imageSmoothingEnabled=!1;ma.setTransform(1,0,0,1,0,0);ma.filter="url(#remove-alpha)";(function(){let a;for(a=0;26>a;a++)U["Key"+String.fromCharCode(a+65)]=String.fromCharCode(a+97);for(a=0;10>a;a++)U["Digit"+a]=U["Numpad"+a]=""+a;window.addEventListener("keydown",Ba);window.addEventListener("keyup",Ca)})();(async()=>{await ha("font.png");await ha("spritesheet.png");await ha("spritesheet16.png");
W("e",Na);X("change-scene",(c,b)=>{pa(["enter","esc"]);Da(["change-scene"]);"game"===c&&(a=Ka());"menu"===c&&(a=ua());"game-over"===c&&(a=Ma(b))});let a=ua();Aa({update(){a.update()},A(){a.A()}}).start()})()})();
